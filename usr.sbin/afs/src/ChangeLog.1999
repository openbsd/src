1999-12-31  Love  <lha@s3.kth.se>

	* arlad/reconnect.c (*): try to handle the case that find_first_fs
	failes

1999-12-31  Assar Westerlund  <assar@sics.se>

	* arlad/messages.c: add debug prints of the fids to the messages

	* arlad/inter.c (getrights): static-ize
	* arlad/fcache.c (sum_node): static-ize
	* arlad/inter.c (cm_getattr): make sure we have a parent before
 	doing bulk status

	* tests/Makefile.in (run-tests): make it work with makes that run
 	all the commands in the same shell
	(clean): add run-tests

	* arlad/messages.c: remove some double fcache_release:s

1999-12-31  Love  <lha@s3.kth.se>

	* arlad/fcache.c (creating_nodes): remove variable
	(unlink_lru_entry): make it more presistant and not fail

1999-12-30  Love  <lha@s3.kth.se>

	* arlad/messages.c (*): disable prio-stuff

	* arlad/fcache.h (FCacheEntry): added cleanergen and changed type
	of priority
	(fcache_need_bytes,fcache_need_nodes): new prototypes

	* arlad/fcache.c (current_vnodes): counter of currently created
	vnodes
	(needbytes): how many bytes the cleaner needs to clean away
	(fprioritylevel): make it a bool
	(creating_nodes): if the create_nodes is running
	(create_nodes): merge in create_node() and create_new_entries() and
	make create_nodes add new entires to the list instead of operating
v	on the list, also mak create_nodes a thread sleeping until we need
	more nodes.
	(cleaner_working): tells if the cleaner is working
	(cleaner): make it a state machine that is waken up each time there
	is a shortage of nodes or bytes, this repleaces
	emergency_remove_data() and emergency_remove_nodes().
	(fcache_wakeup_cleaner) how to wake up the cleaner
	(fcache_need_bytes): wakeup the cleaner to get more bytes
	(fcache_need_nodes): wakeup the cleaner to get more nodes
	(emergency_remove_data): remove
	(emergency_remove_nodes): remove
	(unlink_lur_entry): call fcache_need_nodes()
	(find_free_entry): print warning to ADEBWARN
	(fcache_recover_state): assert find_free_entry never failes
	(fcache_reinit): disable increseing of nodes
	(fcache_unused): never signal lru_list since we never clean out the node
	(read_data): use new fcache_need_bytes(), more verbose debugging

1999-12-29  Love  <lha@s3.kth.se>

	* xfs/linux/xfs_message.c (xfs_message_installnode): remember to
	dput the dentry when its inserted without a already existing
	dcache-entry.
	(gc_vnode): more debugging

	* xfs/solaris/Makefile.in (xfs): added magic glue to avoid that
	the solaris module is name xfs
	(load,mount): new target

	* xfs/linux/xfs_node.c: remove #ifdef HAVE_GET_EMPTY_INODE

	* configure.in (linux): no get_empty_inode test

	* cf/linux-func-get-empty-inode.m4: no more

	* doc/oddities.texi: note importance that . and .. need to be
	first, also tell about dirent.reclen

	* doc/debugging.texi: note that you can cat the /proc/kmsg file on
	linux since klogd sucks performancewise and it loosses message

1999-12-28  Love  <lha@s3.kth.se>

	* lib/ko/ko_locl.h: no strmatch.h

	* include/Makefile.in: no strmatch or strsplit

1999-12-28  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/Makefile.in (vnode_if.c): not used.  remove
	(vnode_if.h): handle vnode_if.sh and vnode_if.pl
	* configure.in (freebsd): try to handle running vnode_if.pl or
 	vnode_if.sh

	* tests/large-dir2.c: don't check for directory being 2048 bytes
 	long
	* tests/large-dir.c: don't check for directory being 2048 bytes
 	long

	* arlad/bsd-subr.c (dir_remove_name): using a too large d_reclen
 	is bad because readdir() can't cope with it being larger than the
 	buffer size that's being used by opendir/readdir.  so let's take
 	DIRBLKSIZ (defaulting to 1024) as a conservative estimate

	* xfs/bsd/xfs_message.c (xfs_message_version): try to figure out
 	if we don't have a getfh syscall installed.  new and improved.
  	now more #ifdef's.

	* configure.in (nosys, sys_nosys): test for under bsd

1999-12-25  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs/xfs_vnodeops.h: handle VOP_LOCK with [1,3] arguments
 	and bail out else.

	* xfs/bsd/xfs_message.c (xfs_message_version): test for getfh
 	actually being filled in.  In FreeBSD 3 and 4 before kern/15452
 	was applied, it might not be filled in at run-time if there's no
 	NFS.
	
	* configure.in (freebsd): do the test for vnode_if.sh the same way
 	as in xfs/bsd/Makefile.in
	(AC_BSD_FUNC_LOCKSTATUS): use

	* xfs/bsd/bin/Makefile.in: segregate programs and scripts.  use
 	INSTALL_SCRIPT for installing scripts.

	* tests/build-emacs-j: cater for people with broken shells

	* xfs/bsd/xfs_vnodeops-bsd.c (cleanup_cnp): new function for
 	cleaning up a componentname.  also reset HASBUF after free-ing,
 	this is needed by fbsd-current.

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_link): conditionalize calls to
 	VOP_ABORTOP (doesn't exist in fbsd-current)
	(xfs_islocked): handle one and two-argument lockstatus

	* xfs/bsd/Makefile.in (vnode_if.h): try to handle vnode_if.src in
 	fbsd-current with different arguments

1999-12-16  Love  <lha@s3.kth.se>

	* Release 0.29.2 (in the arla-0-29-2-branch)

1999-12-16  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c (do_read_attr): always set ret_conn so it's not
	left unitialized

1999-12-16  Love  <lha@s3.kth.se>

	* arlad/messages.c (xfs_message_rename): set old_entry to NULL

1999-12-14  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs/xfs_node.h (xfs_do_vget): use {1,2,3}_ARGUMENT_VGET.
	* cf/bsd-vget.m4: <sys/cdefs.h> conditionalize check for 1, 2, or
 	3 arguments verify that at least one of them actually works
	* cf/bsd-vop-lock.m4: conditionalize <sys/cdefs.h>

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhopen): do copy-in.  never call
 	fhopen or sys_fhopen.  if this function was called, that's because
 	someone didn't want the ordinary fhopen function.
	* xfs/bsd/xfs_syscalls-common.c (fhopen_call): adapt to new
 	xfs_fhopen

	* configure.in (osf): move test_KERNEL_CFLAGS
	* configure.in (AC_CHECK_KERNEL_FUNCS): remove sys_fhopen.  not
 	used anymore.
	* configure.in (freebsd[34]): handle current version of
 	vnode_if.sh and check that we actually got a vnode_if.h generated
	* configure.in: junk freebsd2: we don't support in anyway

1999-12-14  Love  <lha@s3.kth.se>

	* arlad/.gdbinit (lwp_ps_internal): pritty-printing and added
	intelism

	* configure.in: testing for readline in editline, by Tino Schwarze
	<tino.schwarze@informatik.tu-chemnitz.de>

1999-12-13  Love  <lha@s3.kth.se>

	* milko/lib/ropa/Makefile,milko/appl/perf/Makefile

	* configure.in (AC_OUTPUT): Added

	* Release 0.29.1 (in the arla-0-29-1-branch)

	* arlad/messages.c (VenusFid_cmp): really compare the to fids

1999-12-11  Love  <lha@s3.kth.se>

	* lwp/plwp.c (Debug): disable hardwired debugging..

	* Makefile.in (SUBDIRS): do test too

	* tests/compare-inum-mp: remove right mountpoint

	* tests/Makefile.in: echo-n

1999-12-08  Assar Westerlund  <assar@sics.se>

	* arlad/bsd-subr.c (write_dirent): handle DIRENT_SIZE

	* arlad/arla_local.h: <dirent.h>: needs _KERNEL, otherwise we
 	don't get DIRENT_SIZE

	* configure.in: re-do editline/readline stuff

	* arlad/sunos-subr.c (dir_remove_name): do a proper reclen
 	overflow check

	* arlad/solaris-subr.c (dir_remove_name): do a proper reclen
 	overflow check

	* arlad/irix-subr.c (dir_remove_name): do a proper reclen overflow
 	check

	* arlad/hpux-subr.c (dir_remove_name): do a proper reclen overflow
 	check

	* arlad/aix-subr.c (dir_remove_name): do a proper reclen overflow
 	check

	* arlad/bsd-subr.c (dir_remove_name): handle last_dp == NULL (this
 	might happen for the first entry and even through we should never
 	remove `.' (which is always the first entry) it seems better not
 	to rely on this)

	* arlad/bsd-subr.c (dir_remove_name): do a proper check for
 	overflow `d_reclen'

	* arlad/messages.c (xfs_message_create): be more careful before
 	releasing fcache entries

1999-12-08  Love  <lha@s3.kth.se>

	* conf/CellServDB: updated rhic

	* Release 0.29

1999-12-08  Assar Westerlund  <assar@sics.se>

	* configure.in: add missing ;; in case, from hin@stacken.kth.se

1999-12-06  Love  <lha@s3.kth.se>

	* arlad/fcache.c (create_directory): don't update used bytes, its
	done in adir_mkdir().

Sun Dec  5 05:50:15 1999  Magnus Ahltorp  <map@stacken.kth.se>

	* configure.in: Make all --with-sys-guessing in one place. Use
 	$SYS/include as the include directory for linux.

1999-12-05  Love  <lha@s3.kth.se>

	* arlad/reconnect.c (reconnect_create): fetch parent fid volume if
	there is none.

	* arlad/fcache.c (fcache_get_attr_bulk): don't care about nodes
	without names, version 3.with brain
	* arlad/fcache.c (fcache_get_attr_bulk): don't care about nodes
	without names, version 2.

	* arlad/inter.c (cm_lookup): no more mp_traversal

	* arlad/fcache.h (*): no more mp_traversal

	* arlad/fcache.c (fcache_get_attr_bulk): don't care about nodes
	without names

1999-12-05  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/Makefile.in (install): support installing in /modules

	* configure.in (AC_CHECK_KERNEL_VFSSW): remove, it's not used
	anyways.

	* cf/linux-func-get-empty-inode.m4: set CFLAGS to
	test_KERNEL_CFLAGS

	* cf/linux-func-full-name-hash-8bit.m4: set CFLAGS to
	test_KERNEL_CFLAGS

	* cf/have-linux-kernel-type.m4: call AC_TRY_COMPILE_KERNEL so that
	we use the right flags.

	* cf/check-kernel-vfssw.m4: not used. remove

	* lib/bufdir/fdir.c: use typedef for function point to
	fdir_readdir
	* lib/bufdir/fdir.h: use typedef for function point to
	fdir_readdir

	* configure.in: support KERNEL_CFLAGS being set in the shell.
	support --with-sys on linux check for sys/dir.h and don't check
	for sys/dir.h and dirent.h being compatible (we only include one
	of them anyways)
	
	* arlad/inter.c (cm_lookup): look in the volume entry to find the
	parent of ..
	* arlad/fcache.c (get_root_of_volume): store parent fid in the
	volume entry
	* arlad/volcache.h (volcacheentry): add `parent' (the .. of this
	volume)

	* arlad/messages.h (VenusFid_cmp): add prototype
	* arlad/messages.c (VenusFid_cmp): const-ify

	* arlad/volcache.h (volcacheentry): rename fid fields
	* arlad/volcache.c (recycle_entry): don't care about finding the
	root vnode

	* arlad/*-subr.c: use common subr functions
	* arlad/subr.c: new file
	* arlad/Makefile.in (arlad_OBJS): add subr.o
	(SRCS): add subr.c

1999-12-03  Assar Westerlund  <assar@sics.se>

	* configure.in: redo the tests for readline/editline.  now it
 	should only test for the functions that are needed.  and if should
 	fail if any does not exist.

	* tests/build-emacs-j: new test

	* tests/run-tests.in (ARLA_TESTS): do `build-emacs' before
 	`untar-emacs'.  add `build-emacs-j'

	* lib/ko/kocell.c (readdb): love-complete skipping of white-space
	* lib/ko/kocell.c (readdb): also try to remove trailing white
 	space
	* lib/ko/kocell.c (readdb): change the format to be "IP-address([#
 	\t]+hostname)?"

1999-12-02  Assar Westerlund  <assar@sics.se>

	* arlad/bsd-subr.c (write_dirent): check for volume == NULL
	
1999-12-01  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c: add a magic cookie and version number to the
	dump file.

	* arlad/fcache.h: add a magic cookie and version number to the
	dump file.

	* arlad/volcache.h: add a magic cookie and version number to the
	dump file.

	* arlad/bsd-subr.c: simplify include-mess
	(write_dirent): use `volume->mp'

	* arlad/volcache.c: set `li'
	(volcache_free): add at tail of lrulist

	* arlad/volcache.h (volcacheentry): add a list pointer into
	lrulist

	* arlad/fcache.c: don't use realfid any longer.  store the
	information in the volume instead
	(fcache_realfid): new function

	* arlad/fcache.h (FCacheEntry): delete `realfid' (this information
	is now stored in the volume entry instead)
	(fcache_realfid): new function

	* ydr/output.c (generate_server_switch): make ExecuteRequest of
	the type that rx expects it to be.
	* rx/rx.h (rx_service): correct type for `executeRequestProc'
	* rx/rx.c (rx_NewService): correct type for `serviceProc'
	* arlad/cmcb.c (cmcb_init): remove bad cast
	(RXAFSCB_CallBack): print warning when we can't find the host the sent
	us the callback
	
	* arlad/arla_local.h: don't include both dirent.h and sys/dir.h,
	but just in that order of preference
	
	* arlad/afsdir_check.c (check): printf format correctness
	
1999-12-01  Love  <lha@s3.kth.se>

	* arlad/messages.c (xfs_message_mkdir): avoid to set datausedp to
	later when we know that the node will be installed

	* arlad/messages.c (xfs_message_mkdir): do some locking of the
	parent

	* lib/ko/kocell.c (readdb): pass over isspace() in hostnames, if
	there is no hostname, replace with ip-address.

	* arlad/fcache.c (fcache_get_attr_bulk): check if we want to do
	bulkstatus, check the return value of find_first_fs()

	* arlad/messages.c (*): try to set datausedp later when the node
	is passed down to the kernel

1999-11-30  Assar Westerlund  <assar@sics.se>

	* xfs/*/xfs_message.c: make installattr not finding the node non-fatal

1999-11-28  Assar Westerlund  <assar@sics.se>

	* arlad/inter.c (cm_lookup): don't get provoked into doing
 	bulk-status on "." or ".."

	* arlad/messages.c (xfs_message_inactivenode): reset datausedp and
 	attrusedp also.

	* xfs/bsd/xfs_vnodeops-osf.c: update to changing reality

	* xfs/bsd/xfs_message.c (xfs_message_installattr): sanity-check
 	tokens
	(*): print handle in lots of the debug messages

	* xfs/bsd/xfs_node-bsd.c: better and more consistent debug
 	messages

1999-11-27  Love  <lha@s3.kth.se>

	* xfs/linux/xfs_syscalls.c (sys_afs_int): handle the case where
	the dentry set
	(xfs_debug_print): XDEBNODE:enable printing of node and childs

	* arlad/afsdir_check.c (*): add verbose and help

1999-11-27  Assar Westerlund  <assar@sics.se>

	* appl/afsutils/klog.c (randfilename): use
	krb_get_default_tkt_root if existing

	* appl/afsutils/klog.h: add (with gcc attributes) prototypes for
	die et al

	* configure.in: test for krb_get_default_tkt_root bsd: test for
	cdevsw_add (it might disappear any day now in fbsd)
	* configure.in (linux): test for inode_operations.get_block

	* xfs/linux/xfs/xfs_locl.h: add <linux/smp_lock.h> define LINUX2_3
 	based on patches from <yasushi@cs.washington.edu>

	* xfs/linux/xfs_inodeops.c (xfs_d_validate): add new flag argument
 	inode_operations has added a `get_block' operation
	(xfs_readpage): lock and unlock kernel under 2.3

	* xfs/linux/xfs_dev.c (xfs_print_sleep_queue): handle new type of
 	wait_queue in 2.3

	* arlad/fcache.c (fcache_get_attr_bulk): check for `prefered_name'
 	being NULL.  set tokens to be the tokens of the entry masking out
 	data if the data hasn't been installed in the kernel.

	* xfs/bsd/xfs/xfs_common.h (xfs_devtoname_r): add prototype

	* xfs/bsd/xfs_node-bsd.c (xfs_dnlc_lookup): try to handle the
 	locking protocol correctly for "." and ".."

	* xfs/bsd/xfs_dev-common.c: use xfs_devtoname_r

	* xfs/bsd/xfs_dev-bsd.c: use xfs_devtoname_r

	* xfs/bsd/xfs_common-bsd.c (xfs_devtoname_r): new function to
 	print the name of a `dev_t'

	* configure.in (bsd): test for snprintf and devtoname in the
 	kernel

1999-11-26  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_vnodeops-common.c (xfs_symlink_common): don't rele
 	in modern FreeBSD

	* xfs/bsd/xfs_dev-common.c (xfs_message_rpc): also mask SIGVTALRM

	* include/stds.h (int16, u_int16): define.  From Derrick J
 	Brashear <shadow@dementia.org>

	* conf/CellServDB: update for MIT cells

1999-11-26  Love  <lha@s3.kth.se>

	* arlad/messages.c (*): try to set datausedp when data is
	installed, also remeber to set tokens to some (in)sane value.

	* arlad/inter.c: (cm_getattr): remove datatokens it data isn't
	used
	
	* arlad/fcache.c (fcache_get_attr_bulk): update tokens more
	forcefully (even new nodes can have data)

	* arlad/fcache.c (fcache_get_attr_bulk): update tokens

	* arlad/fcache.c (xfs_message_install_node_attr): union of
	install{node,attr} for bulkstat
	(bulkstat_help_func): don't exclude nodes we have attributes for,
	we need them too in kernel, this should be made more beautifully,
	it should be installed, but not bulkstat:ed
	(fcache_get_attr_bulk): just install nodes when they don't exist
	in kernel, install attributes otherwise

	* arlad/messages.c (xfs_message_remove): install the nodes in
	right order

	* xfs/linux/xfs_message.c (xfs_message_installnode): invalid
	childs when XFS_INVALID_DNLC is set.

1999-11-23  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_wrap-bsd.c: adapt to fbsd -current:
	
	s/remove_dev/destroy_dev/ DEV_MODULE now only takes three
	arguments
	
	* xfs/bsd/xfs/xfs_dev.h (xfs_devioctl): simplify prototype by not
	caring for old FreeBSD

	* xfs/bsd/xfs/xfs_common.h (MALLOC_DECLARE): use if defined
	* xfs/bsd/xfs_common-bsd.c (MALLOC_DEFINE): use if defined
	
1999-11-22  Love  <lha@s3.kth.se>

	* xfs/bsd/xfs_message.c (xfs_message_gc_nodes): remove comment
	about osf

	* arlad/xfs.h: export xfs_send_message_{,v}multiple{,list}()

	* arlad/xfs.c (send_count): removed since we don't use writev any
	longer, need to add some logarithmic stuff instead
	(add_new_msg): new function, add a msg to a ``struct write_buf''
	(send_msg): new function, send of a ``struct write_buf''
	(xfs_send_message_vmultiple): rewrite in terms of add_new_msg and
	send_msg
	(xfs_send_message_multiple): new function
	(xfs_send_message_multiple_list): new function, send of a list of
	message of same size.
	(xfs_send_message_wakeup_vmultiple): reimpement in terms of
	xfs_send_message_vmultiple and write

	* arlad/reconnect.c (*): use new adir_lookup

	* arlad/messages.c (xfs_message_getdata): set datausedp when
	getting dir
	(fcacheentry2xfsnode): export

	* arlad/inter.c (cm_getattr): implement bulkstat
	(cm_lookup): use new adir_lookup and implement bulkstat

	* arlad/fcache.h (FCacheEntry): add hits

	* arlad/fcache.c (fcache_counter): add some counters
	(emergency_remove_data): implement some more intelligent removing of data
	(emergency_remove_node): implement some more intelligent removing of nodes
	(unlink_lru_entry): increse number of nodes we emergency remove
	(fcache_get/fcache_recover_state): init hits to 0
	(update_attr_entry): break out common code
	(do_read_attr): use update_attr_entry
	(bulkstat_help_func): helper function for fcache_get_attr_bulk and fdir_readdir
	(fcache_get_attr_bulk): implement bulkstat

	* arlad/adir.h (adir_lookup): changed signature

	* arlad/adir.c (adir_lookup): enable too pass back the entry of
	``dir''

1999-11-21  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_cachedlookup): cast pointer to
	correct type
	* xfs/bsd/xfs_vnodeops-common.c (xfs_symlink_common): simplify
	ifdef
	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_mkdir): vput should also be
	called on NetBSD
	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_link): try to DTRT when failing
 	when errors early
	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_create): on {Net,Open}BSD dvp
	should not be returned locked

	* appl/afsutils/klog.c (get_afs_id): use
 	arlalib_get_viceid_servers

	* appl/lib/arlalib.c (arlalib_get_viceid): new function

1999-11-20  Assar Westerlund  <assar@sics.se>

	* Release 0.28

1999-11-20  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_vnodeops-common.c: remove vn_share_lock and
 	vn_unshare_lock (and all calls).  they're not actually used for
 	doing anything.

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_lookup): don't unlock parent
 	when returning EJUSTRETURN
	(xfs_lock, xfs_unlock): print flags when DEBUG

1999-11-17  Assar Westerlund  <assar@sics.se>

	* rx/rx_rdwr.c (rx_ReadProc, rx_WriteProc): make generic and
 	pretty prototypes

	* rx/rx_clock.c (clock_ReInit): add dummy function when we're
 	without getitimer
	* configure.in: check for getitimer
	* rx/rx_clock.c: add fallback code for systems without getitimer
	
	* ydr/output.c (encode_enum): hopefully make the generated code be
 	more portable and correct without using any casts to and from int

	* lib/ko/ko_locl.h: conditionalize <sys/mman.h>
	* lib/bufdir/fbuf.c: conditionalize <sys/mman.h>
	* arlad/arla_local.h: conditionalize <sys/mman.h>

	* lwp/plwp.c (LWP_WaitProcess): make prototype compatible with the
 	lwp function

	* configure.in: test for `make_dev' in kernel

	* rx/rx.h: add some prototypes

1999-11-17  Love  <lha@s3.kth.se>

	* xfs/linux/xfs_node.c (free_xfs_node): be paranoid and reset
	tokens

	* xfs/linux/xfs_message.c (xfs_message_installattr): added some
	paranoid checks to try to catch readpage on NULL node
	(xfs_message_installdata): remove obsolete BSD comment
	(xfs_invalid_xnode): added comment about possible race then throwing node->data

1999-11-13  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_wrap-bsd.c: add calls to make_dev and remove_dev iff
 	the kernel has a make_dev
	(FreeBSD 4.x).

	* xfs/bsd/xfs/xfs_vnodeops.h (xfs_lookup_name): what function?

	* xfs/bsd/xfs_vnodeops-common.c (xfs_lookup_name): not used.
  	retire.

	* xfs/bsd/xfs_vnodeops-osf.c (xfs_symlink): adapt to changes in
 	xfs_symlink_common
	(xfs_create, xfs_mkdir): use xfs_lookup_common

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_create, xfs_mkdir): use
 	`xfs_lookup_common'

	* xfs/bsd/xfs_vnodeops-common.c (xfs_symlink_common): use
 	xfs_lookup_common

	* arlad/fcache.c (fcache_stale_entry): if the cell is unknown,
	loop over all the entries in the cache and nuke the ones with
	matching fid.  This is a kludge to solve the problem with
	multi-homed file servers.  The problem is that the callback break
	can come from a different IP address than the one we have been
	talking to and then we have no idea as to what cell that belongs
	to.  The real fix is to start using the 3.4 interfaces and be
	aware of multi-homed file servers.

	* xfs/bsd/xfs_node-bsd.c (xfs_dnlc_lookup): correct tbl_lookup
	call
	* xfs/bsd/xfs_vnodeops-common.c (vn_share_lock, vn_unshare_lock):
	disable
	(xfs_lookup_common): don't do any parent unlocking.  try to handle
	. and .. special cases.  we always get back a locked vnode from
	xfs_dnlc_lookup
	(xfs_create_common): more information in debug messages

	* xfs/bsd/xfs_node-bsd.c (tbl_lookup): make common
	(xfs_dnlc_lookup): always lock the node that is returned

1999-11-08  Love  <lha@s3.kth.se>

	* conf/CellServDB ({arla.,}e.kth.se): Put arla.e.kth.se after
	e.kth.se since libkafs seams to do first match.
	(psc.edu): update from info-afs
	(lsa.umich.edu): update from info-afs
	(math.lsa.umich.edu): update from info-afs

1999-11-07  Assar Westerlund  <assar@sics.se>
	
	* xfs/bsd/xfs_message.c (xfs_message_installnode,
 	xfs_message_installdata): do vget without locking and vrele
	(gc_vnode): unlock interlock if node is being used
	(xfs_message_gc_nodes): don't use dead next pointer

	* xfs/bsd/xfs_vfsops-common.c (xfs_root_common): don't tell vget
 	we already have an interlock.  we don't.

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_lookup): look at PDIRUNLOCK flag
 	to see if we should unlock
	(xfs_create): simplify
	(xfs_mkdir): simplify.  correct debug printf
	(xfs_inactive): remove FreeBSD 2-code

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhopen): the fhopen syscall can be
 	called fhopen or sys_fhopen.  handle both cases.

	* xfs/bsd/xfs_syscalls-common.c (fhget_call): we don't have any
 	memset on FreeBSD, use bzero instead

	* xfs/bsd/xfs_node-bsd.c (new_xfs_node): always do vget.  (this
 	will probably not work on fbsd2)
	(tbl_lookup): new version for NetBSD 1.4K or higher.  cache_lookup now
	returns with the resulting node locked, do the same thing in
 	tbl_lookup

	* configure.in (AC_CHECK_KERNEL_FUNCS): check for `sys_fhopen'

1999-11-03  Love  <lha@s3.kth.se>

	* configure.in (AC_OUTPUT): added milko/appl/bootstrap/Makefile

1999-11-03  Marcus Sundberg  <mackan@stacken.kth.se>

	* cf/linux-func-devfs-register-eleven-args.m4: new file

	* configure.in: use AC_LINUX_FUNC_DEVFS_REGISTER_ELEVEN_ARGS

	* xfs/linux/xfs_load.c (init_module): support recent devfs_register()

1999-11-02  Love  <lha@nutcracker.e.kth.se>

	* rxdef/cb.xg: removed #if 0 def's that have been moved to
	common.h removed \r in comment end mark.

	* rxdef/vldb.xg: added a comment about VLSF and VLF

1999-10-31  Assar Westerlund  <assar@sics.se>

	* arlad/inter.c (cm_symlink): create mount points with 0644

	* arlad/fcache.c (create_new_entries): handle `n == 0'
	(fcache_reinit): don't fail when setting it to the same number as
	nodes that's already there

1999-10-30  Assar Westerlund  <assar@sics.se>

	* configure.in: don't export RXKAD_LIBS use new
 	AC_FIND_FUNC_NO_LIBS2 for checking for kafs/krbafs

	* cf/find-func-no-libs.m4: add yet another argument to allow
 	specify linker flags that will be added _before_ the library when
 	trying to link

	* cf/find-func-no-libs2.m4: add yet another argument to allow
 	specify linker flags that will be added _before_ the library when
 	trying to link

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_lock, xfs_unlock): handle the
 	case of three-argument lockmgr's

	* xfs/bsd/xfs_vnodeops-common.c (xfs_loopup_common): remove
 	lockparent stuff

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_lookup): move the BSD-specific
 	lockparent stuff here from xfs_lookup_common

	* xfs/bsd/xfs/xfs_locl.h: move syscall argument macros here from
 	xfs_syscalls.h

	* xfs/bsd/xfs/xfs_syscalls.h: move syscall argument stuff to
 	xfs_locl.h

	* xfs/bsd/xfs_vfsops-osf.c: add some struct to xfs_fhandle_t make
 	debug printfs less informative by not printing unexisting
 	variables

 	* xfs/bsd/xfs-message.c (xfs_message_gc_nodes): add osf version

	* xfs/bsd/xfs/xfs_locl.h (u_int16_t): add for osf
	(xfs_setgroups_args): add a hard-coded defintion of this struct for
	osf.  It's not defined anywhere and hopefully it will not be
 	changed.

1999-10-26  Love  <lha@s3.kth.se>

	* rxdef/common.h: Added SS_FSYNC flag, given to StoreData and
	friends when we are supposed to fsync.

1999-10-23  Love  <lha@s3.kth.se>

	* appl/afsmgr/afsaclmgr.in: A acl manager written i guile-gtk.

1999-10-22  Love  <lha@s3.kth.se>

	* configure.in (AC_PATH_PROGS): Added check for guile-gtk
	(AC_OUTPUT): Added appl/afsmgr/Makefile

1999-10-22  Magnus Ahltorp  <map@stacken.kth.se>

	* lib/bufdir/fbuf.c, arlad/*.c: Don't close fd when fbuf is closed.

1999-10-22  Love  <lha@s3.kth.se>

	* appl/afsutils/klog.h: remove do_help prototype

	* appl/afsutils/klog.c (*): rewrote to use getarg

	* tests/ga-test.c (test_simple_strings): added simple test for
	arg_strings
	(*): print what test failed

1999-10-21  Love  <lha@s3.kth.se>

	* tests/ga-test.c (test_simple_integer, test_simple_string):
	swaped functionsname to reflect what the do.

	* appl/afsutils/unlog.c (save_tokens): remove variable as a
	cleanup from Chris Wing
	(getarg): made getarg work as expected (compat)

1999-10-20  Magnus Ahltorp  <map@stacken.kth.se>

	* arlad/fcache.[ch], arlad/dynroot.c, arlad/reconnect.c: Added
	length field to FCacheEntry

1999-10-19  Love  <lha@s3.kth.se>

	* tests/{ga-test.c,Makefile.in,run-tests.in}: added basic getarg
	tests suite.

Tue Oct 19 02:44:21 1999  Magnus Ahltorp  <map@stacken.kth.se>

	* xfs/linux/xfs_inodeops.c (xfs_read_file): read from page owned
 	by backing store

1999-10-19  Magnus Ahltorp  <map@stacken.kth.se>

	* lib/bufdir/fdir.c (update_fid_by_name): Don't corrupt directory
	entry

1999-10-17  Magnus Ahltorp  <map@stacken.kth.se>

	* xfs/linux/xfs_inodeops.c: xfs_readdir: Eliminated memory leak

1999-10-17  Assar Westerlund  <assar@sics.se>

	* tests/create-files.c (creat_files): remember O_WRONLY to open

	* configure.in (hpux): set KERNEL_INCLUDE

	* appl/fs/fs.c: revert last commit.  xfs_deb.h is needed here

1999-10-16  Magnus Ahltorp  <map@stacken.kth.se>

	* rxdef/pts.c, appl/pts/pts.c, milko/pts/pr.c,
	milko/pts/ptserver.c: Better names for pts constants

1999-10-15  Magnus Ahltorp <map@stacken.kth.se>

	* xfs/linux/xfs_syscalls.c: sys_afs_int: Check for NULL xnode
	
1999-10-15  Love  <lha@s3.kth.se>
	
	* rx/Makefile.in (install): create $(includedir)/rx

	* rx/rx.[ch]: a service returns a int32_t not a long

1999-10-13  Love  <lha@s3.kth.se>

	* tests/create-files.c(usage): updated.

	* tests/compare-inums: new style create-file

1999-10-13  Assar Westerlund  <assar@sics.se>

	* appl/udebug/Makefile.in (LIB_tgetent): add

	* xfs/bsd/xfs_wrap-bsd.c: use NODEV on FreeBSD 3

	* xfs/bsd/xfs_vnodeops-common.c: use xfs_vfs_vn_lock

	* xfs/bsd/xfs/xfs_vnodeops.h (xfs_vfs_vn_lock): new ugly macro for
 	calling vn_lock

Tue Oct 12 23:22:35 1999  Magnus Ahltorp  <map@stacken.kth.se>

	* arlad/fcache.c: Clear attrp when clearing length.

1999-10-12  Assar Westerlund  <assar@sics.se>

	* arlad/messages.c (xfs_message_getnode): reset data mask before
 	installing tokens

	* configure.in: use LIB_tgetent when testing for el_init

	* cf/find-func-no-libs.m4 (AC_FIND_FUNC_NO_LIBS): new argument
 	`extra libs'

	* cf/find-func-no-libs2.m4 (AC_FIND_FUNC_NO_LIBS2): new argument
 	`extra libs'

	* configure.in: use AC_BSD_FUNC_LOCKMGR

	* cf/bsd-func-lockmgr.m4: new test

1999-10-10  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_wrap-bsd.c: NODEV -> NOMAJ

	* xfs/bsd/xfs_vfsops-netbsd.c: use xfs_checkexp

	* xfs/bsd/xfs_vfsops-freebsd.c (xfs_vfsops): add `xfs_checkexp'
 	when appropriate

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_checkexp): new dummy function

	* configure.in: check for debuglockmgr

	* xfs/bsd/xfs/xfs_node.h (xfs_node): sort out when to use `struct
 	lock'

	* xfs/bsd/xfs_node-bsd.c (xfs_dnlc_lookup): try to handle the new
 	NetBSD version of cache_lookup that has a return value that's the
 	opposite of the traditional one (but actually more logical and
 	consistent with everything else).  The test for __NetBSD_Version__
 	>= 104110000 might not be optimal.

	* arlad/arla_local.h: fix for building on MacOS X

	* tests/create-files.c: support writing data into the files

1999-10-07  Love  <lha@s3.kth.se>

	* arlad/xfs.h (rcvfuncs): is extern.

	* configure.in (tgetent): check in ncurses too.

Wed Oct  6 01:51:12 1999  Magnus Ahltorp  <map@stacken.kth.se>

	* xfs/linux/xfs_inodeops.c: xfs_write_file: Check if cache file is
 	NULL

	* tests/read-write.c: Added.

	* xfs/linux/xfs_node.c: free_xfs_node: Cleanup.

	* xfs/linux/xfs_message.c: xfs_invalid_xnode: Move code around to
 	avoid scheduling between token clearing and DATA_FROM_XNODE
 	clearing. Cleanup.

	* xfs/linux/xfs_inodeops.c: xfs_readdir: Merge 2.0 and 2.2 code.
 	Cleanup. xfs_readpage: Correct spelling mistake.

1999-10-06  Assar Westerlund  <assar@sics.se>

 	* (xfs_lookup_common): use xfs_vfs_unlock

	* xfs/bsd/xfs/xfs_locl.h: add <sys/signalvar.h>

	* xfs/bsd/xfs_wrap-bsd.c (DEV_MODULE): set major number

	* xfs/bsd/xfs_node-bsd.c: handle the case of there being no
 	`cn_hash' in `struct componentname'

	* xfs/bsd/xfs_dev-common.c (xfs_message_rpc): handle another way
 	of setting signal masks
	(SIGADDSET, used in FreeBSD 4)

 	* xfs/bsd/xfs_dev-bsd.c (FreeBSD, cdevsw): conditionalize some
 	fields

 	* lwp/process.S (RCSID): undef to avoid conflicts and possibly use
 	an assembly version (ENTRY): conditionalize

	* configure.in (AC_CHECK_HEADERS): beautify.  add
 	<sys/signalvar.h>
	(struct cdevsw): test for lots of fields
	(struct componentname): check for cn_hash

	* xfs/bsd/xfs_vnodeops-common.c (xfs_lookup_common): try to
 	approximate the weird locking some more

	* xfs/bsd/xfs_node-bsd.c (xfs_getnewvnode): lockmgr or not
	(new_xfs_node): don't interlock

	* xfs/bsd/xfs_vnodeops-bsd.c: start using lockmgr for vop_lock,
 	vop_unlock, and vop_islocked

	* xfs/bsd/xfs_vfsops-freebsd.c (xfs_dead_vnodeop_entries): default
 	should be vop_defaultop

	* xfs/bsd/xfs_dev-bsd.c (FreeBSD): more conditional fields

	* configure.in: test for d_spare in cdevsw

	* configure.in: test for d_reset in `struct cdevsw'

	* xfs/linux/xfs/xfs_locl.h (xfs_iref): inline function for
 	incrementing the ref count

	* xfs/linux/xfs_syscalls.c (fhopen_call): always call DPUT. add
 	some comments

	* xfs/linux/xfs_inodeops.c (xfs_readpage): always call dput,
 	simplify a tiny bit use xfs_iref

	* xfs/linux/xfs_message.c (xfs_message_installnode): iput the
 	xnode instead of `dentry->d_inode'.  use `xfs_iref' for bumping
 	reference count

	* xfs/linux/xfs_node.c: add some comments
	(xfs_iget): don't call xfs_attr2inode, it's always done in
	new_xfs_node
	(xfs_node_find): simplify

1999-10-05  Love  <lha@s3.kth.se>

	* conf/CellServDB (northstar.dartmouth.edu): changed

	* appl/afsutils/sys.c (main): ask kernel if avaible.

	* arlad/fcache.c (throw_data, create_file): when truncating files
	to zero length, set status.Length == 0.

1999-10-05  Assar Westerlund  <assar@sics.se>

 	* xfs/bsd/xfs/xfs_node.h (xfs_node): start using `struct lock' iff
 	lockmgr

	* arlad/bsd-subr.c (write_dirent): check that the parent isn't the
 	same

1999-10-05  Love  <lha@s3.kth.se>

	* conf/CellServDB (urz.uni-magdeburg.de): changed db servers

	* arlad/cmcb.c: s,EOPNOTSUPP,RXGEN_OPCODE,

1999-10-04  Love  <lha@s3.kth.se>

	* appl/afsutils/sys.c: Added sys program.

Mon Oct  4 01:58:56 1999  Magnus Ahltorp  <map@stacken.kth.se>

	* xfs/linux/xfs_inodeops.c: xfs_readdir: Don't lookup inode
 	number. Cleanup.

1999-10-03  Assar Westerlund  <assar@sics.se>

	* arlad/messages.c (xfs_message_symlink): handle realfid

	* arlad/inter.h (cm_symlink): update prototype

	* arlad/inter.c (cm_symlink): return the realfid

	* arlad/bsd-subr.c (write_dirent): also handle the case of `..'
 	referring to a mount-point

	* tests/readdir-vs-lstat.c (verify_inodes): no need to check for
 	. or ..

	* xfs/linux/Makefile.in (mount): add

	* tests/readdir-vs-lstat.c (verify_inodes): probably works better
 	if chdir:ing to the directory

	* tests/readdir-vs-lstat.c (main): change default "foo" -> "."

	* tests/readdir-vs-lstat.c (verify_inodes): don't unlink

	* tests/compare-inum-mp: new test

	* tests/compare-inums: new test

	* tests/run-tests.in: add compare-inums, compare-inum-mp

	* tests/readdir-vs-lstat.c: only verify inode numbers

1999-10-02  Love  <lha@s3.kth.se>

	* conf/CellServDB (dev.mit.edu): changed
	(athena.mit.edu): changed

1999-10-01  Assar Westerlund  <assar@sics.se>

	* tests/run-tests.in: add readdir-vs-lstat

	* tests/Makefile.in: add readdir-vs-lstat

	* tests/readdir-vs-lstat.c: new test program for verifying that
	inode numbers from lstat and readdir are equal

1999-09-30  Assar Westerlund  <assar@sics.se>

	* rx/Makefile.in (install, uninstall): move include files to `/rx'

	* xfs/bsd/xfs/xfs_locl.h: <vm/vm_object.h>: add

	* arlad/hpux-subr.c: DIRSIZ circus

	* arlad/arla.c (args): more units

	* appl/fs/fs.c: no <xfs/xfs_deb.h>

	* include/Makefile.in: add parse_bytes.h

	* appl/amon/amon.c: add parse_bytes.h

1999-09-30  Harald Barth  <haba@pdc.kth.se>

	* doc/intro.texi: Documentation is for wimps /Überwimp.
	* doc/oddities.texi
	* doc/partsofarla.texi 
	* doc/porting.texi 
	* doc/tools.texi
	* doc/authors.texi: Here, too.
	* doc/arla.texi: Love said I should do this by now
	* configure.in: Noting in if clause is no good

1999-09-30  Assar Westerlund  <assar@sics.se>

	* lwp/make-process.o.sh.in: hpux: don't set PROCESS_S, it gets
 	included from process.S add -I$(srcdir) when running cpp/cc

	* lwp/Makefile.in (make-process.o.sh): add a dependency on
 	../config.status

1999-09-29  Love  <lha@s3.kth.se>

	* configure.in: readline support done diffrently, again

	* NEWS: remove asrvutil notice and replace it with lwp notice

	* configure.in: move lwp things to the top so we can use it in
	windows too add case cygwin in the switch statment. That isn't
	relly correct but print a warning that we only work on NT.

	* lwp/plwp.h: windwos threads glue code.

	* lwp/plwp.c: Added windows threads suppport on phtread emulation
	mode.  Debugged by Magnus map@stacken.kth.se and Robert rb@abc.se

1999-09-28  Harald Barth  <haba@puffin.pdc.kth.se>

	* doc/partsofarla.texi: nice format

	* doc/debugging.texi: minor

	* doc/Makefile.in: New targets: .pdf and .html files. Generated
	from texi input. Not made as default yet.

	* configure.in: Test for texi2pdf and texi2html, used in the doc
	tree

1999-09-27  Love  <lha@s3.kth.se>

	* arlad/unknown-subr.c (dir_remove_name): new dummy function

	* rx/rx_clock.c (set_alrm_handler): use only sigaction if
	SA_RESTART is defined

	* xfs/winnt/src/xfs_vops.c (xfs_close): free ccb and fcb
	(xfs_cleanup): opencounter--
	(xfs_create): allocate ccb and fcb and
	to pointer magic
	(xfs_dirctl): figure out where to start and only show 3 files
	(xfs_devctl): add begining of ioctl that we might use for xfs-rpc

	* xfs/winnt/src/makefile: check for alternate location of NTDDK

	* xfs/winnt/src/xfs_misc.c: ccb/fcb allocation/release

	* xfs/winnt/inc/xfs_locl.h: CCB flags and panic string

1999-09-26  Love  <lha@s3.kth.se>

	* xfs/winnt/inc/xfs_type.h: Add a allignment macro

	* xfs/winnt/inc/xfs_locl.h: Added lot of confusion structures that
	the book claims we need.

	* xfs/winnt/src/xfs_init.c (InitFS): initilize the zones for fcb
	and ccb
	(DriverEntry): #if 0 out exception code since can't generate a loadable
	modules otherwise.

1999-09-26  Assar Westerlund  <assar@sics.se>

	* appl/amon/amon.c (GetUsedBytes): use unparse_bytes_short for
 	nicer output

	* arlad/volcache.c (get_info_loop, get_info_byid,
 	get_info_byname): add an explicit `cell' argument
	(volcache_getbyname, volcache_getbyid): set stablep correctly and also
	set validp

1999-09-26  Love  <lha@s3.kth.se>

	* xfs/winnt/xfs.reg: Z: to many \ in string.

	* arlad/messages.c (vioc_calculate_cache): must be root.

1999-09-26  Harald Barth  <haba@pdc.kth.se>	

	* doc/debugging.texi: Spelling check and some new night excercices.

	* doc/intro.texi: Mostly spelling check.

	* doc/partsofarla.texi: Mostly spelling check.

	* doc/porting.texi: Mostly spelling check.
	
1999-09-25  Love  <lha@s3.kth.se>

	* lib/ko/ko.h (cell_is_sanep): new prototype

	* lib/ko/kocell.c (cell_is_sanep): new function

	* arlad/volcache.c (get_info_loop): print out the volume of the
	strance cell that doesn't have and db-server, and assert that this
	cell is a sane one.

	* arlad/fcache.c (*): Add some comments about silly rename

	* arlad/fcache.c (write_data): in case of failure, set the
	status.Length = 0 since we truncate the buffer, otherwise the
	assertion that
	(sum (all-fcachenodes).status.Length) != usedbytes will fail.

	* tests/Makefile(dup2-and-unlog): Added program.

	* tests/dup2-and-unlog.c: xsession-errors emulation

1999-09-24  Love  <lha@s3.kth.se>

	* appl/lib/Makefile.in (INCLUDES): Added xfs/include

	* arlad/fcache.c (throw_data): make sure we call
	cm_check_usedbytes_consistency() If we are compiling w/o assert,
	make sure we don't count below zero.
	(cleaner) call cm_check_usedbytes_consistency.
	(sum_node): only use Length when calculating sum (that should be
	equal usedbytes)

	* arlad/cmcb.c (RXAFSCB_CallBack): call
	cm_check_usedbytes_consistency()
	(RXAFSCB_InitCallBackState): call cm_check_usedbytes_consistency()

	* arlad/arla.c (args): new option --usedbytes-consistency -b
	(main): turn on usedbytes_consistency if needed

	* arlad/inter.h
	(cm_turn_on_usedbytes_consistency,cm_check_usedbytes_consistency):
	new prototypes.

	* arlad/inter.c (cm_check_usedbytes_consistency): if we have a
	consistent view of usedbytes
	(*): start to use cm_check_usedbytes_consistency()

	* arlad/messages.c (viocwhereis): send address to userland in
	network order.

1999-09-23  Love  <lha@s3.kth.se>

	* arlad/.gdbinit (lwp_ps_internal): more pretty printing

	* arlad/messages.c (read_mount_point): Map the mountpoint
	rw|rd|private
	(vioc_afs_stat_mt_pt): now that the mountpoint is mapped private, dont
	use a copy buffer.

	* lib/bufdir/fbuf.h: (fbuf_flags): new flags

	* lib/bufdir/fbuf.c:(mmap_flags): check new semantics
	(mmap_prot): new function
	(mmap_create): use mmap_prot
	(malloc_flush): mmap emulation

	* arlad/fcache.c (parse_mountpoint): document
	(followmountpoint): map file PRIVATE|WRITE

	* */{,*/}/*.c (*): Changed sematics of fbuf_create

1999-09-23  Assar Westerlund  <assar@sics.se>

	* arlad/Makefile.in: add arladeb2

	* arlad/arladeb2.c: new file

	* arlad/arladeb.c (arla_log_method): make global
	(arla_vwarn_with_fid, arla_warn_with_fid): move away

1999-09-20  Assar Westerlund  <assar@sics.se>

	* arlad/messages.c (try_again): try to print more explicit
 	messages when waiting

	* arlad/volcache.c (volcache_getname): new function for mapping id
 	-> name

	* arlad/arladeb.c (arla_warnx_with_fid, arla_vwarnx_with_fid): new
 	functions

	* util/log.c (log_vlog): try to handle vasprintf failing

	* configure.in: support smp for FreeBSD as well

1999-09-17  Assar Westerlund  <assar@sics.se>

	* arlad/messages.c (read_mount_point): break up into
 	get_mount_point and read_mount_point

1999-09-17  Love  <lha@s3.kth.se>

	* arlad/volcache.c: Apply assar's patch to avoid dead-lock in
	recycle_entry()

	* arlad/messages.c (vioc_afs_stat_mt_pt): create a termporary
	buffer to make sure the string ends with a '\0'.
	(read_mount_point): more confusing comments.

1999-09-16  Love  <lha@s3.kth.se>

	* appl/afsutils/klog.c: put krb_afslog_uid inside a KERBEROS ifdef

	* configure.in (APPL_SUBDIRS): += asrvutil

1999-09-14  Love  <lha@s3.kth.se>

	* appl/asrvutil/asrvutil.c (ANAME_SZ & co): Added some krb-compat

	* lib/ko/ko_locl.h: added <sys/ioccom.h>

	* arlad/fcache.c (fcache_get): make sure the new (not newest)
	entry is unlocked when put on the lru.
	(find_free_entry): Added comment about locking
	(unlink_lru_entry): Added comment about locking

	* arlad/.gdbinit: add random gdb sequences for your late night
	entertainment.

1999-09-13  Love  <lha@s3.kth.se>

	* appl/vos/vos_local.h: Iflags now defined in volumeserver.xg

	* xfs/bsd/xfs_dev-common.c (xfs_message_rpc): ignore SIGALRM

1999-09-11  Magnus Ahltorp  <map@stacken.kth.se>

	* configure.in: Don't use fpu registers on alpha and sparc64

1999-09-10  Love  <lha@s3.kth.se>

	* ydr/sym.h (Symbol): add u.proc.package

	* ydr/parse.y (proc_decl): save what package we was created ``in''
	(directive): add package to packagelist

	* ydr/output.h (packagelist): add extern prototype.

	* ydr/output.c (packagelist): used to keep track of what packages
	we have had
	(generate_hdr_struct): don't be suprised by a empty defintion.
	(generate_init): create list packagelist
	(generate_server_switch/gencase): iterate over all packages in
	this .xg file

	* ydr/parse.y (directive): estrdup package

	* appl/lib/arlalib.c (arlalib_getsyncsite): seams like the
	syncsite doesn't fill in the syncsiteaddress for some odd reson.

	* arlad/services.h: added KA one of services

	* rxdef/Makefile.in: add ka server stuff

	* rxdef/ka.xg: (new file) partial kaserver def.

	* appl/asrvutil/*: Initial import, a afs equivalent of ksrvutil.

	* conf/CellServDB (e.kth.se): changed names of db servers

	* conf/CellServDB (jpl.nasa.gov): new db-servers

1999-09-10  Assar Westerlund  <assar@sics.se>

	* appl/Makefile.in (SUBDIRS): partly set conditionally

	* lib/ko/koerror.c: move around includes

	* include/stds.h: more ifdef

	* configure.in: handle --without-krb4 set APPL_SUBDIRS to build
 	some subdirs of appl conditionally

	* include/Makefile.in: add acl.h

	* arlad/fcache.c: some ifdef KERBEROS

	* arlad/bsd-subr.c (conv_dir): ignore fcache_fhget failing

	* lib/ko/auth.c: ifdef KERBEROS

	* lib/acl/acl_files.c: ifdef KERBEROS

1999-09-09  Assar Westerlund  <assar@sics.se>

	* rxdef/cb.xg: int32 -> int32_t

	* rxdef/cb.xg: add new RPCs for AFS3.5 and the data types used by
 	these

	* rxdef/common.h (afs_UUID): add

	* rxdef/vldb.xg: move afs_UUID to common.h

	* arlad/cmcb.c: implement stubs for the 3.5 RPCs

	* configure.in: always link with -lkrb et al when testing for
 	-lkafs (this breaks with shared libraries otherwise)

1999-09-03  Assar Westerlund  <assar@sics.se>

	* appl/lib/arlalib.c (rx_initlizedp): remove, rx takes care of not
 	re-initializing

1999-08-16  Assar Westerlund  <assar@sics.se>

	* xfs/include/xfs/xfs_attr.h: remove obsolete comment

	* xfs/solaris/xfs_syscalls.c (xfs_pioctl_call): ifdef the 32 bit
 	versions so we don't get duplicates

	* xfs/include/xfs/xfs_message.h (xfs_msg_node): add more padding
 	at the end

	* lwp/make-process.o.sh.in: handle all kinds of sparcs

1999-09-09  Marcus Sundberg  <mackan@stacken.kth.se>

	* configure.in: Check for linux/devfs_fs_kernel.h

	* xfs/linux/xfs/xfs_locl.h: If linux/devfs_fs_kernel.h is available,
	use that instead of linux/devfs_fs.h

1999-09-07  Love  <lha@s3.kth.se>

	* arlad/fcache.c (throw_data): use entry->status.Length when
	counting usedbytes.

	* arlad/fcache.c (create_file): remove superflourius
	free_fs_server_context in case of error

1999-09-06  Love  <lha@s3.kth.se>

	* arlad/xfs.c (xfs_send_message_gc_nodes): log the number of nodes
	to gc

	* arlad/fcache.c (do_read_attr): remeber to free context when
	failing, add comment about fs_context
	(write_attr): remeber to free fs_context when failing
	(create_file): emeber to free fs_context when failing

1999-09-03  Love  <lha@s3.kth.se>

	* conf/Makefile.in (install) At least try to set the bits rights
	on the cachedir

	* configure.in: Check for chmod

	* xfs/solaris/bin/Makefile.in: Added krb_lib_flags

1999-09-03  Assar Westerlund  <assar@sics.se>

	* lib/ko/Makefile.in (LIB_SOURCES): add afsconf and auth
	(install): install header files

	* lib/ko/{cellconfig.h,afsconf.c,auth.h,auth.c}: new files for
	some transarc library compatability

	* lib/ko/ports.c (ports_init): make sure we only execute once

1999-08-30  Assar Westerlund  <assar@sics.se>

	* tests/Makefile.in (REALCFLAGS): add $(srcdir)/../include

1999-08-30  Love  <lha@s3.kth.se>

	* configure.in: Added check for libkafs with AC_FIND_FUNC_NO_LIBS

1999-08-29  Love  <lha@s3.kth.se>

	* appl/udebug/udebug.c: Host order bug noticed by Dr A V Le Blanc
	<LeBlanc@mcc.ac.uk>

	* README: Update that programs we distribute

1999-08-28  Love  <lha@s3.kth.se>

	* conf/Makefile.in: Create the cache-dir

1999-08-27  Love  <lha@s3.kth.se>

	* xfs/linux/xfs_message.c (xfs_message_installdata): Add code for
	open_namei in the linux2.1+ case.

	* configure.in (AC_OUTPUT): Changed to reflect new directory
	structure for appl/

	* appl/*/Makefile.in (RXKAD_LIBS): use @MILKO_RXKAD_LIBS@

	* xfs/include/xfs/xfs_message.h: Ugly hack for WIN32/i386

1999-08-25  Love  <lha@s3.kth.se>

	* xfs/winnt/src/xfs_vops.c: Added create

	* xfs/winnt/xfs.reg [Dos Devices] Change place of device

	* xfs/winnt/README: Added more tips and tools

	* xfs/winnt/src/xfs_init.c: start using XFSLOG and xfs_debug()

	* xfs/winnt/inc/xfs_locl.h: Added <stdio.h> <stdarg.h>

	* xfs/winnt/src/xfs_deb.c (xfs_debug): implement

	* xfs/winnt/inc/xfs_proto.h: Add prototyp for xfs_debug()

	* xfs/winnt/inc/xfs_deb.h: rename things to XFSLOG since that is
	what is realy is add XDEB things from xfs/include/xfs_debug.h,
	should really be an include XXX

	* xfs/winnt/src/xfs_vops.c (*): more sane debugging
	(xfs_queryvol,xfs_fscontrol): added placeholder

	* xfs/winnt/src/xfs_init.c: Added IRP_MJ_QUERY_VOLUME_INFORMATION,
	IRP_MJ_FILE_SYSTEM_CONTROL more debugging

	* xfs/winnt/inc/xfs_deb.h: Misc debugging constants

	* xfs/winnt/inc/xfs_proto.h: Added xfs_queryvol, xfs_fscontrol

	* xfs/winnt/inc/xfs_locl.h: include xfs_deb.h

1999-08-22  Love  <lha@flippflopp.passet.pp.se>

	* appl/lib/arlalib.c: remove empty comment ad the end

	* appl/lib/appl_locl.h: move <kafs.h> outside #ifdef KERBEROS

	* appl/afsutils/unlog.h: change prototype of do_help

	* appl/afsutils/tokens.c (*): Added nonkerberos support

	* appl/afsutils/klog.c (main) moved non-global stuff to main
	(*): Added non-kerberos support.

	* appl/afsutils/TODO.afsutils (general): fixed mktemp and /ticket
	problem

	* appl/*: new style tree (one program in each dir (almost))

1999-08-21  Love  <lha@s3.kth.se>

	* appl/fs.c (getcache_cmd): formating fix

	* tests/run-tests.in: Format stuff for tests now when they are
	reformated print date when we are done.

1999-08-20  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs_syscalls.c (unpag): repair linux 2.0 code

	* xfs/linux/xfs_message.c (gc_vnode): try to handle linux 2.0

	* xfs/linux/xfs_node.c (xfs_iget): use get_empty_inode if we have
 	it

	* configure.in (AC_LINUX_FUNC_GET_EMPTY_INODE): add

	* rx/Makefile.in (test_rx_clock): add dependency on $(LIB)

1999-08-17  Love  <lha@s3.kth.se>

	* arlad/xfs.c (xfs_message_wakup): Added check for lost messages.
	Fix the assert

	* configure.in(linux): Set KERNEL_CC to CC as default

1999-08-17  Simon Josefsson  <jas@pdc.kth.se>

	* appl/klog.c (do_timeout): Use waitpid() instead of wait4().

	* xfs/irix/Makefile.in (distclean,distclean-subdirs): New targets.

	* xfs/irix/bin/Makefile.in (distclean): New target.

	* conf/Makefile.in (distclean): Remove Makefile.

	* lwp/Makefile.in (clean): Remove process.i.
	(distclean): Remove Makefile.

	* include/Makefile.in (distclean): New target.

1999-08-14  Love  <lha@s3.kth.se>

	* tests/find-linux: new test

	* tests/run-tests.in: beatified and added test find-linux

	* arlad/fcache.c (emergency_remove_node): added function
	(cleaner): try to throw nodes when they are in kernel
	(unlink_lru_entry): call emergency_remove_node() if we are short on nodes.

1999-08-10  Assar Westerlund  <assar@sics.se>

	* configure.in: AC_DEFINE with three arguments to avoid having
 	garbage in acconfig.h

	* acconfig.h: remove more from this supposed-to-be-empty file

1999-08-09  Assar Westerlund  <assar@sics.se>

	* configure.in: use AC_HAVE_KERNEL_DEF instead of AC_HAVE_DEF

1999-08-08  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs/xfs_locl.h: try to move up asm/current.h even more

1999-08-08  Assar Westerlund  <assar@sics.se>

	* Release 0.27

1999-08-08  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhlookup): correct call to
 	xfs_vfs_object_create

	* xfs/bsd/xfs_syscalls-common.c (fhget_call): return a
 	`xfs_handle_t' and not a `fh_args' in vice_ioctl->out

	* xfs/bsd/xfs/xfs_common.h (memcpy): add prototype

	* xfs/bsd/xfs_common-bsd.c (memcpy): implement in terms of bcopy
 	for the kernels that don't have it

	* configure.in: check for memcpy in kernel

	* arlad/messages.c (xfs_message_remove): always do an installnode
 	instead of an installattr sometimes.  this seems to solve
 	hardlink1

	* appl/Makefile.in (LIBS): gratious link with RXKAD_LIBS.

	* appl/tokens.sh: retire

	* appl/Makefile.in: remove SHELL_SCRIPTS.  none left after
 	tokens.sh was retired

	* xfs/solaris/Makefile.in (DEFS): include KERNEL_CFLAGS

	* configure.in (solaris): try to handle 64-bit sparc

	* configure.in (linux): add `-ffixed-8' when compiling on alpha
	(setgroups-tests): add _LKM, should really use KERNEL_foo instead

1999-08-04  Assar Westerlund  <assar@sics.se>

	* arlad/messages.c (xfs_message_pioctl): conditionalize to death
 	(for 32 bit compat foobar).

	* include/kafs.h: conditionalize 32-bit guck

	* appl/klog.c: merge in more patch from Chris Wing
 	<wingc@engin.umich.edu>:
	
	1) Somebody broke the behavior of the -tmp option. (made get_tkt
 	   FALSE instead of TRUE). Fixed.
	
	2) mkstemp() from roken creates a unique temporary file and
 	   returns the name. Previously I had used mktemp(), which returns
 	   a unique name only.
	   (I originally dealt with the possible race condition by putting the
	   ticket files in a directory called /ticket, mode 1733).
	
	   The problem is that if a ticket cannot be gathered (for
 	   instance, if the wrong password is entered), this temporary
 	   file will stick around.
	
	   Fixed so that the ticket file is automatically destroyed if it
 	   isn't made available to the user.
	
	3) If -setpag is used and the shell cannot be exec()ed, the AFS
 	   token will stick around in a ghost PAG. Now klog makes sure to
 	   remove the token in this case.
	
	   (as per the recent discussion about bloating the AFS client with large
	   numbers of dead credentials)
	
	4) Minor changes to move all warning messages to use warnx, diet,
 	   etc., eliminating fprintf(stderr, ... )
	
	5) Minor changes to warning messages missing whitespace or having
 	   superfluous newlines

1999-08-02  Assar Westerlund  <assar@sics.se>

	* arlad/messages.c (xfs_message_pioctl): handle all the 32 bit
 	versions of the pioctls

	* xfs/solaris/xfs_wrap.c: install the 32bit syscall

 	* xfs/solaris/xfs_syscalls.c (xfs_syscall32): implement a 32 bit
 	syscall (to be used when running on solaris 7 in 64bit mode)

	* include/kafs.h: define ViceIoctl32 for the 32bit API in case
 	it's different.  also define all the pioctl values with _32
 	appended because the sizeof the struct may be used to to derive
 	the actual value used.

	* configure.in (--with-krbafs): handle both pointing at the prefix
 	and the lib itself
	(setgroups tests): define all kernel defines and correct name of
	sysproto macro (this should really be done with the kernel test)

	* arlad/afsdir_check.c: don't include arla_local.h because that
 	would give us xfs.h which we don't want.
	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_link): try to handle early
 	FreeBSD here as well

	* arlad/arladeb.c: don't include arla_local.h because that would
 	give us xfs.h which we don't want.

1999-08-02  Love  <lha@s3.kth.se>

	* conf/CellServDB (umr.edu): Uppdated

1999-08-01  Love  <lha@s3.kth.se>

	* arlad/fcache.c (fcache_fhget): move vice_ioctl to avoid warning.

	* xfs/bsd/xfs/xfs_syscalls.h (xfs_fhandle_t): define

	* xfs/bsd/xfs/xfs_locl.h: glue for xfs_vfs_getvfs and
	xfs_vfs_object_create

	* xfs/bsd/xfs_vfsops-osf.c (xfs_fhlookup): use opaque
	xfs_fhandle_t instead of (fsid,fileid,gen)
	(xfs_fhopen): changed to new signature

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhlookup): new signature, use
	opaque struct to pass in fh-data and typecast it to xfs_fh_args or
	fhandle_t depending on if we have a working VPTOHP (ie getfh)
	(xfs_fhopen): use native sys_fhopen

	* xfs/bsd/xfs_syscalls-common.c (fhget_call): implement a fhget if
	we have a working VPTOFH.
	(fhopen_call): use xfs_fhandle_t instead of fh_args.

	* xfs/bsd/xfs_message.c (xfs_message_installdata): use new style
	fhlookup
	(xfs_message_version): reenable native fhget

	* xfs/solaris/xfs_syscalls.c (xfs_unpag): implement

1999-07-29  Assar Westerlund  <assar@sics.se>

	* appl/klog.c: use krb_get_pw_in_tkt instead of krb_get_pw_in_tkt2
 	and don't use krb_get_default_principal to be compatible with CNS

	* lib/acl/acl_files.c (krb_principal): removed definition.  we get
 	it from stds.h

	* lwp/process.S: use ENTRY instead of _ENTRY to be more consistent
 	with the definitions in <machine/asm.h>

1999-07-29  Love  <lha@s3.kth.se>

	* arlad/messages.c (try_again): free connections then we get a
	RXKADEXPIRED.

	* rx/rx.c (rxi_ReceivePacket): if there is an error with the
	connection propagate that up to the user with
	rxi_ConnectionError()

1999-07-29  Assar Westerlund  <assar@sics.se>

	* lwp/process.S: try to be more consitent with using _C_LABEL and
 	_ENTRY

	* configure.in: some more <sys/time.h>, from Harald Barth
 	<haba@pdc.kth.se>

1999-07-29  Love  <lha@s3.kth.se>

	* conf/CellServDB: Added eng.utah.edu, anl.gov changed

	* include/Makefile.in: Added parse_time.h, by Ken Raeburn
	<raeburn@raeburn.org>
	
	* xfs/bsd/xfs/xfs_locl.h: include xfs/xfs_syscalls.h instead of
	sys/syscallargs.h to avoid dual inclusion by Ken Raeburn
	<raeburn@raeburn.org>

	* configure.in: added <sys/time.h> for setgroups test as suggested
	by Ken Raeburn <raeburn@raeburn.org>

1999-07-28  Love  <lha@s3.kth.se>

	* arlad/fcache.c (stale): throw data if we have any

1999-07-28  Assar Westerlund  <assar@sics.se>

	* arlad/volcache.c (sanitize_nvldbentry): added.  used.

	* arlad/volcache.c (volcache_getbyname, volcache_getbyid): move
 	the setting of stablep here

	* arlad/messages.c (try_again): figure out if the volume
 	information is reliable

	* arlad/volcache.c (cmp_nvldbentry): new function
	(volcache_reliable): another new function
	(*): maintain stablep

	* arlad/volcache.h (volcacheentry): add last_fetch and stablep
	(volcache_reliable): prototype
	(VOLCACHE_OLD): 120

1999-07-25  Simon Josefsson  <jas@pdc.kth.se>

	* tests/hardlink1.c (main): Non-ambigous errors.

1999-07-25  Magnus Ahltorp  <map@stacken.kth.se>

	* xfs/linux/xfs/xfs_msg_locl.h: Added xfs_message_{version,gc_nodes}
	prototypes

	* xfs/linux/xfs_message.c (xfs_message_version): new func, what
	this xfs supports
	(xfs_message_gc_nodes): throw away nodes that isn't used

	* xfs/linux/xfs_dev.c: Call new functions
	
1999-07-25  Love  <lha@s3.kth.se>

	* tests/run-tests.in: -p for `fs calculate`

	* appl/fs_lib.c (fs_calculate_cache): new function

	* arlad/messages.c (vioc_calculate_cache): New function

	* arlad/fcache.c (fcache_calculate_usage,sum_node): new functions
	to calculate real cachesize

	* include/kafs.h: added VIOC_CALCULATE_CACHE (58)

	* arlad/reconnect.c (reconnect_mkdir): Dont run mkdir on the
	child-node, its already done.

1999-07-24  Assar Westerlund  <assar@sics.se>

	* ydr/output.c (error_function): let the default be the empty
 	string which makes lots of stuff much simpler
	(generate_simple_stub): always use error_function

	* arlad/fcache.c (throw_data): correct the assert to use the
 	correct variable
	(try_next_fs): return TRUE for ARLA_VNOVOL (suggested by Jeffrey
	Hutzelman <jhutz+@cmu.edu>)
	(read_attr): don't free server context if do_read_attr fails
	(read_data): increment `usedbytes' when we have actually gotten the
	data
	(fcache_get_data): don't free server context if do_read_attr fails

1999-07-24  Love  <lha@s3.kth.se>

	* arlad/*-subr.c: use fcache_get_fbuf and fdir_readdir instead of
	adir_readdir to avoid racecondition

	* arlad/adir.c (get_fbuf_from_fcache): remove and use
	fcache_get_fbuf instead.

	* arlad/fcache.[ch] (fcache_get_fbuf): new function

	* arlad/xfs.[ch]: Move a lot of xfs related stuff here. Document
	and clarify how each function is (almost) suppose to work,
	REMEMBER the comments are only there to confuse you.

	* arlad/messages.[ch]: move a lot of xfs related stuff from
	message.[ch] to xfs.[ch]

	* arlad/kernel.c (version_thread): don't wait, just exit

	* appl/vos_dump.c (dump_volume): use conv_to_arla_errno for
	afs-errors

	* xfs/include/xfs/xfs_message.h: Add
	xfs_message_{version,gc_nodes} messsages

	* xfs/bsd/xfs/xfs_msg_locl.h: Added xfs_message_{version,gc_nodes}
	prototypes

	* xfs/bsd/xfs_message.c (xfs_message_version): new func, what this
	xfs supports
	(xfs_message_gc_nodes): throw away nodes that isn't used, XXX
	osf,smp

	* arlad/fcache.c (fcache_fhopen,fcache_fhget): check if we have
	native fopen
	(throw_data): don't assert on wrong length, file might be broken
	from and faulty StoreData.
	(cleaner): run xfs_send_message_gc_nodes() to try to gc nodes that
	is ref:ed by xfs.
	(emergency_remove_data): use xfs_send_message_gc_nodes() to throw
	any lot of nodes that is ref:ed by xfs
	(read_data): use conv_to_arla_errno() for afs-errors
	(write_data): open file RW so we can truncate if it we get an
	error while storing the file
	(truncate_file): use conv_to_arla_errno() for afs-errors

	* lib/bufdir/fbuf.c (mmap_copy{rx2fd,fd2rx}): use
	conv_to_arla_errno to fetch afs special error (VDISKFULL & co)
	from rx_Write()

	* arlad/reconnect.c (reconnect_putattr): use conv_to_arla_errno to
	fetch afs special error (VDISKFULL & co) from rx_Write()

	* arlad/messages.h (xfs_message_{send,sleep}): export

	* arlad/messages.c (*): Add gc node stuff
	(xfs_message_{send,sleep}): export
	(xfs_message_rpc): move to xfs.[ch]

	* arlad/kernel.c (kernel_interface): create version_thread
	(version_thread): start probing on what xfs can do. (XXX do
	earlier ?)

	* arlad/arla_local.h: Added "xfs.h"

	* arlad/Makefile.in: Added xfs.[cho]

	* arlad/xfs.[ch]: xfs related stuff, like version-control and
	xfs_send_message_gc_nodes().

	* configure.in: AC_CHECK_KERNEL_FUNCS(vgonel)

1999-07-23  Love  <lha@s3.kth.se>

	* arlad/messages.c (xfs_message_rmdir): only do sillyrename when
	linkcount == 2, add comments.
	(xfs_message_remove): only set it silly when linkcount == 1 (ie
	last reference to file)

	* arlad/fcache.c
	(do_read_attr,write_data,write_attr,fcache_get_data): don't read
	attr if its a silly rename.

1999-07-20  Love  <lha@s3.kth.se>

	* arlad/fcache.c (fcache_get): reset flags.silly
	(fcache_recover_state): set flags.silly == FALSE
	(fcache_reobtain_callbacks): check for flags.silly
	(fcache_giveup_all_callbacks): check for flags.silly

	* arlad/reconnect.c (do_replay): ftruncate the log_file

	* arlad/messages.c (xfs_message_remove): Only insert limbo entry
	into kernel when its there, add comment.

	* arlad/inter.c (cm_symlink): the caller of create_symlink is
	resonsible of setting flags.kernelp.

	* arlad/fcache.c (create_symlink): move out settign of
	flags.kernelp, since the entry might be a mountpoint and the
	child_entry is never pushed to the kernel.

	* arlad/inter.c (cm_lookup): make sure ret is set to a correct
	value.

	* appl/fs.c (getcache_cmd): use getarg, enable printing of bytes
	and kbytes.

	* appl/amon.c (GetUsedBytes): change names to reflect new
	fs_getfilecachestats

	* appl/fs.c (getcache_cmd): use new fs_getfilecachestats() that
	uses bytes instead of kbytes

	* appl/fs_lib.c (fs_getfilecachestats): change signature, pass
	bytes instead of kbytes.

	* arlad/messages.c (viocgetcacheparams): pass on
	fcache_{high,used}bytes unchanged to userland.

1999-07-20  Assar Westerlund  <assar@sics.se>

	* arlad/inter.h (cm_lookup): update prototype

	* arlad/inter.c (cm_lookup): new flags for following mount points

	* arlad/messages.c: new version of cm_lookup, change callers
	(xfs_message_remove): set tokens correctly

1999-07-20  Artur Grabowski <art@stacken.kth.se>

	* configure.in: test for machine/endian.h

	* rxkad/rxk_crpt.c: add a special test for endianness to allow
	static config.h on many architectures. (don't ask)

	* xfs/bsd/xfs_common-bsd.c: make it build without XFS_DEBUG.

1999-07-20  Love  <lha@s3.kth.se>

	* xfs/bsd/xfs/xfs_locl.h: add test for {sys_,}setgroups_args

	* xfs/bsd/xfs_syscalls-common.c (xfs_setgroups): use
	xfs_setgroups_args and SCARG

	* configure.in: test for {,sys_}setgroups_args

	* cf/have-def.m4: New macro

1999-07-20  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs_vfsops.c: handle d_alloc_root with one and two
 	arguments

	* configure.in: use AC_LINUX_FUNC_D_ALLOC_ROOT_TWO_ARGS

	* cf/linux-func-d_alloc_root-two_args.m4: new test

	* xfs/solaris/xfs_syscalls.c (xfs_setgroups): port the linux patch
 	to prohibit setting the pag with setgroups

	* xfs/bsd/xfs_syscalls-common.c (xfs_setgroups): port the linux
 	patch to prohibit setting the pag with setgroups

	* xfs/linux/xfs_syscalls.c (xfs_setgroups): always leave from the
 	PAG.  prevent it from installing fake PAGs.  From Chris Wing
 	<wingc@engin.umich.edu>

	* arlad/fcache.c (create_symlink): remove bogus increate of
 	`usedbytes'

1999-07-20  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c (fcache_extra_file_name): terminate string
 	properly

1999-07-19  Assar Westerlund  <assar@sics.se>

	* tests/hardlink1.c: more testing

	* xfs/linux/xfs_inodeops.c (xfs_getattr): new function for return
 	the attributes for a file or directory.  installed in all the
 	instances of `struct inode_operations'.  This requires the patch
 	adding the getattr operation to inode_operations.

	* xfs/linux/xfs/xfs_locl.h: <asm/current.h>: conditionalize

	* configure.in: check for asm/current.h check for {updatepage,
 	revalidate, and getattr} in `struct inode_operations'

	* NEWS: mention new cache file names

	* arlad/messages.c (token_for_cell): copy out the ticket

1999-07-19  Simon Josefsson  <jas@pdc.kth.se>

	* appl/fs.c (copyacl_cmd):
	(afs_copyacl): New functions.
	(afs_setacl): Garbage collect empty rights. Don't segfault on
	empty acl.

1999-07-19  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c (fcache_extra_file_name): add the @ at the end
 	instead

1999-07-15  Love  <lha@s3.kth.se>

	* arlad/messages.c (voicckserv): s,0,cell_name2num
	(cell_getthiscell());,

1999-07-15  Assar Westerlund  <assar@sics.se>

	* appl/klog.c (main): use kname_parse instead of krb_parse_name

1999-07-14  Assar Westerlund  <assar@sics.se>

	* appl/appl_locl.h: <sys/wait.h>

	* lib/acl/acl_files.c: some functions to handle other kerberos
 	libraries

	* appl/tokens.c (krb_kdctimeofday): check for

	* appl/klog.c: fallback for KRB_TICKET_GRANTING_TICKET

	* configure.in: check for sys/wait.h

	* configure.in: AC_FUNC_KRB_KDCTIMEOFDAY: add

	* tests/Makefile.in: add create-{symlinks,dirs}

	* arlad/fcache.c: make the cache directory two-level

	* arlad/fcache.h (fcache_dir_name): new prototype

	* tests/many-dirs: use create-dirs

	* tests/many-symlinks: use create-symlinks

	* tests/create-symlinks.c: new file

	* tests/create-dirs.c: new file

	* tests/many-files: use create-files

	* tests/create-files.c: new program for creating lots of files

	* tests/Makefile.in: add create-files

	* tests/read-vs-mmap2.c (mmap_file): needed cast

	* tests/read-vs-mmap.c (mmap_file): needed cast

	* appl/fs.c (afs_whereis): remove htonl - address is already in
 	network byte order

1999-07-13  Love  <lha@s3.kth.se>

	* xfs/winnt/*: Added dead code.

	* arlad/bsd-subr.c (dir_remove_name): Add assertions. Only merge
	with previous dirent, if there is enough space in the dirent.

	* appl/klog.c: start to use diet{,x}
	(randfilename): rewrite, umich compat on ticketfile

	* appl/{README.afsutils,TODO.afsutils}: Note by Chris Wing
	<wingc@engin.umich.edu>
	
	* appl/klog.[ch1]: Added klog by Chris Wing 
	<wingc@engin.umich.edu>

	* appl/unlog.[ch1]: Added unlog by Chris Wing 
	<wingc@engin.umich.edu>

	* appl/appl_locl.h: Added <kafs.h>, <parse_time.h>

	* appl/amon.c: removed <kafs.h>

1999-07-12  Magnus Ahltorp <map@stacken.kth.se>

	* appl, lib/ko: Move partition name conversion to libko

1999-07-06  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_link): only vput on OpenBSD and
 	NetBSD :-(

1999-07-06  Love  <lha@s3.kth.se>

        * arlad/volcache.c (get_info_loop): check for dynroot volume

        * arlad/fcache.c (read_attr): check for dynroot
        (getroot): check for dynroot
        (fcache_get_data): check for dynroot

        * arlad/arla.c: (args): -dynroot, -D for dynroot

        * arlad/arla_local.h: <dynroot.h>

        * arlad/Makefile.in (SOURCE,HEADER,OBJECT) += dynroot.?

        * arla/dynroot.[ch]: dynamic root, new files.

        * lib/ko/ko.h (cell_foreach,cell_get_version): export

        * lib/ko/kocell.c (celldb_version): version of in-memory
        (cellno): dont use the 0 cell
        (add_cell): assert on cell == 0
        (cell_init): add dynroot cell
        (cell_foreach): make a iterator function
        (cell_get_version): return version of the db
        (add_special_dynroot_cell): add dynrootcell to the celldb

1999-07-04  Love  <lha@s3.kth.se>

        * tests/fs-flush: test to flush

1999-07-04  Assar Westerlund  <assar@sics.se>

	* tests/run-tests.in (ARLA_TESTS): add mkdir2

	* tests/Makefile.in (mkdir2): add

	* tests/mkdir2.c: new test

	* tests/run-tests.in (ARLA_TESTS): add hardlink2

	* tests/hardlink2.c: new test

	* tests/Makefile.in (hardlink2): add

	* arlad/messages.c (xfs_message_remove): fall back to conv_dir if
 	dir_remove_name fails.  decrement the linkcount to zero if it was
 	one before so that hardlink1 succeeds.  generally clean-up.

1999-07-03  Assar Westerlund  <assar@sics.se>

	* tests/test-gunzip-gnu-mirror: replace spaces in the case-pattern
 	with * (how do you quote in a case-pattern?)

	* tests/run-tests.in (ARLA_TESTS): add test-gunzip-gnu-mirror

	* tests/test-gunzip-gnu-mirror: new test

1999-07-01  Assar Westerlund  <assar@sics.se>

	* arlad/arla_local.h: add <sys/mount.h>

	* configure.in (NetBSD): figure out PMAP_NEW in the same way as
 	UVM

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_link): VOP_UNLOCK ->
 	xfs_vfs_unlock

	* configure.in (NetBSD): fix test syntax, hopefully.

	* arlad/fcache.c (fcache_fhopen, fcache_fhget): try to handle
 	getfh and fhopen syscalls

	* configure.in (VERSION): bump to 0.27pre
	(getfh, fhopen): check for

1999-06-29  Assar Westerlund  <assar@sics.se>

	* arlad/messages.c (xfs_message_remove): install attributes for
 	the dead none so that if there are more links to it they will get
 	the correct link count
	
	* tests/Makefile.in: add hardlink1

	* tests/hardlink1.c: new test

	* tests/run-tests.in (ARLA_TESTS): add hardlink1

	* xfs/linux/xfs_node.c (new_xfs_node): always update the inode
 	attributes

	* appl/fs.c (afs_print_sysname): transarc-compatible quoting.
	From Simon Josefsson <jas@pdc.kth.se>

	* arlad/messages.c (token_for_cell): return the viceId instead.
  	From Chris Wing <wingc@engin.umich.edu>

1999-06-29  Assar Westerlund  <assar@sics.se>

	* Release 0.26

	* configure.in (VERSION): bump

	* configure.in (irix): set IP in a more robust way

	* xfs/linux/xfs_inodeops.c (xfs_print_lock): punt on printing
 	`waking' since it's different types on different architectures

1999-06-28  Johan Danielsson  <joda@pdc.kth.se>

	* xfs/bsd/xfs_vnodeops-osf.c: implement xfs_mmap, and (crude)
	xfs_getpage

	* xfs/bsd/xfs_message.c (xfs_message_installdata): ugly hack to
	prevent panics on OSF/1

1999-06-26  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs_dev.c (xfs_message_rpc): remove unused variable

	* xfs/linux/xfs_inodeops.c: removed som printf warnings

1999-06-24  Assar Westerlund  <assar@sics.se>

	* lib/bufdir/fbuf.h: <rx/rx.h>: add

1999-06-23  Assar Westerlund  <assar@sics.se>

	* xfs/linux/bin/arla.init.in: new sysv-style init file from Marko
 	Asplund <aspa@hip.fi>

	* arlad/messages.c (xfs_message_remove): remove the entry from the
 	converted directory but without moving anything around (with
 	dir_remove_name).  also install it with XFS_DATA_R.  this should
 	fix the problem with large-dir-extra

	* arlad/solaris-subr.c (dir_remove_name): implement

	* arlad/sunos-subr.c (dir_remove_name): implement

	* arlad/irix-subr.c (dir_remove_name): implement

	* arlad/hpux-subr.c (dir_remove_name): implement

	* arlad/aix-subr.c (dir_remove_name): implement

	* arlad/solaris-subr.c (dir_remove_name): some more paranoia

	* arlad/subr.h (dir_remove_name): new prototype

1999-06-22  Johan Danielsson  <joda@pdc.kth.se>

	* xfs/bsd/xfs_wrap-osf.c (xfs_configure): check for errors

1999-06-20  Assar Westerlund  <assar@sics.se>

	* lib/bufdir/fdir.c (fdir_readdir): initialize `len'.  start using
	fbuf_len and fbuf_buf

	* configure.in: comment out test for mode_t and nlink_t

	* lib/bufdir/fbuf.c (mmap_copyfd2rx): correct arguments to mmap

	* arlad/fcache.c (find_first_fs): don't segv when e->volume is not
 	set
	(write_data): new copyfd2rx

	* lib/bufdir/fbuf.c (copyfd2rx): also include offset

	* arlad/adir.c: remove all unsued variables

	* arlad/adir.c: start using fdir

	* arlad/inter.c: new signature for adir_lookup_fcacheentry

	* arlad/adir.h (adir_lookup_fcacheentry): new parameter `dir'
	
	* arlad/Makefile.in: link with bufdir instead of our own copy of
 	fbuf

	* include/Makefile.in (LOCL_HEADERS): add fbuf.h

	* tests/test-setgroups.c, tests/test-setpag.c (NGROUPS): define to
 	NGROUPS_MAX if not def

	* tests/large-dir3.c: remove extra paranoid test

	* lwp/process.S: update comment for .register stuff on solaris 7

	* arlad/messages.c (xfs_message_create, xfs_message_mkdir): don't
 	send down (owner,group) group attributes

	* appl/vos_common.c: get rid of some stupid ctype warnings

	* configure.in (mode_t, nlink_t): test for
	(const, endianness): also test for

	* arlad/fcache.c (create_directory): use the kludge of throwing
	away data if we for turn out to get a new directory with initial
	data. this is to make milko happy and should really be solved
	there instead.

1999-06-19  Assar Westerlund  <assar@sics.se>

	* arlad/arla.c: write the PID to /var/run/arlad.pid make
 	fork-logic simpler

1999-06-17  Johan Danielsson  <joda@pdc.kth.se>

	* xfs/bsd/xfs_vnodeops-common.c (xfs_read_common): actually call
	xfs_vop_read

1999-06-16  Assar Westerlund  <assar@sics.se>

	* xfs/rhapsody/xfs_node.c (xfs_attr2vattr, vattr2xfs_attr): it's
 	not ts_* but tv_*

	* xfs/rhapsody/xfs_message.c (xfs_message_installdata): the
 	standard `tmp' -> `message->cache_name'

	* xfs/solaris/xfs_vnodeops.c (do_fsync): copy attributes

	* xfs/solaris/xfs_node.c (vattr2xfs_attr): only copy the
 	interesting bits from va_mode

1999-06-13  Assar Westerlund  <assar@sics.se>

	* appl/vos_dump.c: patch from Alexandra Ellwood <lxs@MIT.EDU> to
 	work around a rhapsody gcc bug (variables and typenames in the
 	same namespace)

	* arlad/arla.c (miain): complain if we can't create the cache
 	directory or it doesn't exist

1999-06-11  Assar Westerlund  <assar@sics.se>

	* util/ip.[ch]: zaped

1999-06-10  Johan Danielsson  <joda@pdc.kth.se>

	* xfs/bsd/xfs_syscalls-common.c: remove some more ifdefs

	* xfs/bsd/xfs/xfs_locl.h: add xfs_proc_to_ruid

1999-06-09  Assar Westerlund  <assar@sics.se>

	* include/Makefile.in (LOCL_HEADERS): removed unexisting headers

	* ydr/main.c (main): use efopen and remove temporary files and
 	give sensible error messages for popen failing

1999-06-09  Johan Danielsson  <joda@pdc.kth.se>

	* xfs/bsd/xfs_vnodeops-common.c: use
	xfs_vop_{read,write,access,getattr}

	* xfs/bsd/xfs/xfs_locl.h: add xfs_vop_{read,write,access,getattr}
	
	* xfs/bsd/xfs_syscalls-wrap-bsd.c: add support for NetBSD a.out
	emulation

	* configure.in: check for aout_sysent to keep old pre-ELF NetBSD
	programs happy

1999-06-08  Love  <lha@s3.kth.se>

	* xfs/bsd/xfs_wrap-bsd.c (xfs_mod): dont have a special case for
	MOD_DISPATCH since we need the major number befor exiting.

1999-06-08  Assar Westerlund  <assar@sics.se>

	* arlad/messages.c (viocsettok): return ENOENT if the cell doesn't
 	exist

	* xfs/bsd/bin/startarla.in: after thinking about it, it doesn't
 	make very much sense to send kldload options that isn't supported
 	on any machine other than mine

1999-06-07  Assar Westerlund  <assar@sics.se>

	* xfs/linux/getcwd.c: add <sys/types.h>.  Patch from Derrick J
 	Brashear <shadow@dementia.org>

1999-06-04  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/bin/startarla.in: send -p to kldload

1999-06-03  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhopen): FILE_UNUSE the `struct
 	file'.  This might solve arlad getting hung in `closef' on NetBSD

	* xfs/bsd/xfs_wrap-bsd.c (xfs_modload): make it compile

	* xfs/bsd/xfs/xfs_dev.h (xfs_is_xfs_dev): add prototype

	* xfs/bsd/xfs_wrap-osf.c (xfs_is_xfs_dev): new function

	* xfs/bsd/xfs_wrap-bsd.c (xfs_is_xfs_dev): new function

	* xfs/bsd/xfs_vfsops-common.c (xfs_mount_common): use
 	xfs_is_xfs_dev instead of xfs_isdevopen

	* xfs/bsd/xfs_dev-osf.c (xfs_func_is_devopen): remove

	* xfs/bsd/xfs_dev-bsd.c (xfs_func_is_devopen): remove

1999-06-03  Johan Danielsson  <joda@pdc.kth.se>

	* xfs/bsd/xfs_wrap-bsd.c (xfs_mod): expand call to DISPATCH, since
	we want to get the assigned major number before exiting
	
1999-05-31  Love  <lha@s3.kth.se>

	* util/eefile.c (eefopen) Fail if mkstemp fails

1999-05-30  Love  <lha@s3.kth.se>

	* Release 0.25

1999-05-30  Assar Westerlund  <assar@sics.se>

	* tests/run-tests.in (ARLA_TESTS): add discon-tar{1,2} and remove
 	setgroups (it needs to be run as root)

	* tests/test-setgroups.c (main): kludgy tests to handle the case
 	of the PAG being in slots (0 and 1) or (1 and 2)

	* configure.in: add test for .register on solaris as

	* HACKING: new file

	* rx/Makefile.in: add test_rx_clock

	* rx/test_rx_clock.c: new test program

	* tests/build-gdb: use gdb-4.18 instead

	* arlad/reconnect.c: only update the fids in the kernel if they
 	are there

	* tests/run-tests.in: warm fuzzy at the end

	* tests/run-tests.in: add more discon*

	* arlad/reconnect.c (reconnect_putattr): comment out some code.
  	handle directories correctly.

	* arlad/messages.c (xfs_message_mkdir): try to invent attributes
 	when creating directories

	* arlad/fcache.c (write_attr): handle disconnected mode
	(create_file, create_directory): allocate fake FIDs from 1000 and 1001
	with an increment of two.

	* xfs/solaris/xfs/xfs_locl.h: add sys/syscall.h

	* xfs/irix/xfs_syscalls.c: junk unused code

	* tests/run-tests.in: recognize --version and --help

	* lwp/process.S: upgrade solaris 7 sparcv9 .register declarations
 	to the (apparently) correct syntax.  now we only need an autoconf
 	test.

	* arlad/kernel.c: err format fixes

	* arlad/afsdir_check.c: err format fixes

1999-05-30  Love  <lha@s3.kth.se>

	* doc/partsofarla.texi: @xref in a () should be a @pxref

	* tests/boot-strap-arla: New test

	* conf/CellServDB: Added arla.e.kth.se

	* configure.in (CONFIG_FILES)+= milko/bos/Makefile

	* rxdef/bos.xg: Added partial bos def.

	* rxdef/Makefile.in: Add libbos{server,client}.a

	* arlad/service.h: Added bos service id

	* lib/ko/koerror.c: Prefixed all entries with appropiate prefixes.
	Added bos errorcodes.
	
	* appl/fs.c: fs strerror to easy find the errorcode

1999-05-29  Assar Westerlund  <assar@sics.se>

	* tests/run-tests.in (ARLA_TESTS): add new tests

	* tests/discon-{create,echo,mkdir}: new tests

	* arlad/volcache.c (volcache_set_rootvolume): assert there being a
 	volname
	(VOLCACHE_SIZE): make prime

	* arlad/reconnect.c (fid_translate): make global
	(recon_hashtabdel, recon_hashtabadd): remove
	(reconnect_mkdir): remove bad error check

	* arlad/messages.c (xfs_message_putattr): write disconnected
 	changes to the log
	(xfs_message_create): try to invent attributes when creating
	disconnected files
	(xfs_message_mkdir): log disconnected changes
	(viocconnect): remove ARLACACHEDIR

	* arlad/fcache.c (recon_hashtabadd, recon_hashtabdel): add
	handle the case of entry->volume == NULL in more places
	(init_fs_server_context): new function
	(find_first_fs): don't care about connected_mode
	(fcache_reobtain_callbacks): get volume entries here.  is this right?
	(write_attr, create_directory, create_symlink, create_link,
	remove_file, remove_directory, rename_file, do_read_data, getacl,
 	setacl, getvolstat, setvolstat): check connected_mode
	(create_file): initialize more attributes

	* arlad/discon_log.h: add more prototypes

	* arlad/conn.c (internal_get): don't check connected_mode here,
 	it's done elsewhere.

	* configure.in: AC_HAVE_STRUCT_FIELD: fix uses

	* tests/mountpoint.in: run fs from objdir

	* tests/run-tests.in (MILKO_TESTS): add deep-tree2

1999-05-28  Assar Westerlund  <assar@sics.se>

	* configure.in (KRB_LIB_FLAGS): set

	* tests/Makefile.in: need to link against libkrb as well...

	* tests/run-tests.in: add new test: setgroups setpag

	* tests/Makefile.in: add setgroups and setpag

	* tests/setpag*, tests/setgroups*: add new tests

	* xfs/solaris/xfs_syscalls.c (store_pag): always get a new `struct
 	ucred'

	* xfs/bsd/xfs_syscalls-common.c (store_pag): always get a new
 	`struct ucred'

1999-05-28  Love  <lha@s3.kth.se>

	* lib/ko/kocell.c: add cell_setthiscell

	* appl/vos_createentry.c: added cell, and corrected noauth, use cell in
	arlalib_getconnbyname, return a sane error

	* appl/vos_vldbexamine.c: Added, a examine that only probes the
	vldbserver (to be removed by when vldblist works).

1999-05-27  Assar Westerlund  <assar@sics.se>

	* xfs/solaris/xfs/xfs_syscalls.h: new prototypes

	* xfs/solaris/xfs_wrap.c: install/remove setgroups wrapper

	* xfs/solaris/xfs_syscalls.c: add setgroups wrapper

	* lib/acl/acl.h: add atypes.h to make stds.h happy

	* configure.in: fix the hstrerror tests

	* xfs/bsd/xfs_syscalls-common.c (store_pag): store the correct
 	values

	* xfs/bsd/xfs/xfs_syscalls.h (xfs_setgroups, old_setgroups_func):
 	add

	* xfs/bsd/xfs_syscalls-wrap-osf.c: save and restore setgroups
 	system call

	* xfs/bsd/xfs_syscalls-wrap-freebsd.c: save and restore setgroups
 	system call

	* xfs/bsd/xfs_syscalls-wrap-bsd.c: save and restore setgroups
 	system call

	* xfs/bsd/xfs_syscalls-common.c (store_pag): new function
	(xfs_setgroups): wrapper around setgroups that preserves the PAG

	* xfs/linux/xfs_syscalls.c (xfs_setgroups): a wrapper around
 	setgroups that preserves the PAG

1999-05-25  Love  <lha@s3.kth.se>

	* lib/ko/ko.h: Added <netinet/in.h>

1999-05-22  Assar Westerlund  <assar@sics.se>

	* INSTALL: note that if you change your prefix your kerberos/afs
 	libraries may have problems.

1999-05-22  Marcus Sundberg  <mackan@stacken.kth.se>

	* xfs/linux/bin/startarla.in: Do insmod before creating missing
	  device node - makes devfs happy.

1999-05-19  Love  <lha@s3.kth.se>

	* xfs/bsd/xfs_dev-bsd.c (xfs_devioctl): reorder defines

	* xfs/bsd/xfs_vfsops-common.c (xfs_mount_common): udev2dev for
	freebsd

	* configure.in: AC_CHECK_KERNEL_FUNCS check for udev2dev

1999-05-19  Johan Danielsson  <joda@pdc.kth.se>

	* configure.in: fix test for -mno-fp-regs on NetBSD/alpha

	* lib/bufdir/fbuf.c: sys/errno.h -> errno.h

1999-05-18  Love  <lha@s3.kth.se>

	*  configure.in: CONFIG_FILES += milko/lib/msecurity

1999-05-17  Love  <lha@s3.kth.se>

	* milko/*: Added filbunke - nnp-server-class fileserver

	* include/Makefile.in: Added afs_dir.h

	* appl/vos_createentry.c (vos_createentry): zero out newentry

Mon May 17 14:13:33 1999  Johan Danielsson  <joda@pdc.kth.se>

	* xfs/bsd/xfs_vnodeops-bsd.c: only include vm/vnode_pager.h if
	it's present

1999-05-16  Assar Westerlund  <assar@sics.se>

	* configure.in (AC_LINUX_FUNC_INIT_WAITQUEUE_HEAD): add

	* cf/linux-func-init-wait-queue-head.m4: new file

	* lwp/lwp.h (LWP_NewRock, LWP_GetRock): add prototypes

	* rx/rx_clock.c: handle the case of the itimer expiring

	* acconfig.h (__EXTENSIONS__): conditionalize.  (it gets
 	automatically defined on Irix and needs to be defined on Solaris)

	* appl/vos.c: move cmds to avoid a forward declaration

	* cf/linux-type-wait-queue-head.m4: try compiling instead of
 	greping in linux/wait.h

	* arlad/fcache.c (fcache_extra_file_name): change the name for the
 	converted directory to be @%04X

	* arlad/reconnect.c: adjusted the length of the filenames, based
 	on a patch from Niklas Hallqvist <niklas@appli.se>.
	(copy_cached_file): simplify

1999-05-15  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs_inodeops.c (xfs_print_lock): make it work on 2.3.2
 	and 2.2 by printing less information.  From Hee-Seok Heo
 	<hsheo@postech.ac.kr>

	* xfs/linux/xfs_dev.c: patch from Hee-Seok Heo
 	<hsheo@postech.ac.kr> for 2.3.2 plus autoconf-junk by myself.

	* configure.in: test for wait_quque_head_t and init_MUTEX.

	* acconfig.h: cut down a lot

	* aclocal.m4: dead

	* configure.in: moved most of the tests to cf.  removed duplicate
 	tests updated to autoconf 2.13 separated linux and bsd kernel
 	tests

	* lwp/Makefile.in (install): work around make rewriting the vpath
 	file name
	
	* xfs/bsd/xfs_vfsops-osf.c: use xfs_suser

	* xfs/bsd/xfs_vfsops-bsd.c: use xfs_suser

	* xfs/bsd/xfs_syscalls-common.c: use xfs_suser

	* xfs/bsd/xfs_common-osf.c (xfs_suser): add

	* xfs/bsd/xfs_common-bsd.c (xfs_suser): add

	* lwp/rw.c (main): correct cast

	* arlad/fcache.h (FCacheEntry): kill invalid_le

	* Release 0.24

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhlookup): handle one and two
 	argument suser
	
	* xfs/bsd/xfs_syscalls-common.c (fhget_call, xfs_debug): handle
 	one and two argument suser

	* configure.in: test for suser taking two arguments

1999-05-14  Assar Westerlund  <assar@sics.se>

	* lwp/process.S (__sparcv9): add commented-out .register
 	declarations.  these are apparently needed if you have a recent as
 	but I've currently no way of testing it.

1999-05-12  Assar Westerlund  <assar@sics.se>

	* rx/rx.c (rxi_ReceivePacket): long should be u_int32_t

	* rx/rx.h: do the obvious short -> u_int16_t, long -> u_int32_t

1999-05-11  Assar Westerlund  <assar@sics.se>

	* lwp/make-process.o.sh.in: use AS from configure

	* configure.in: allow setting AS

	* xfs/linux/xfs_inodeops.c: merge 2.2.7-fix from map

	* lwp/Makefile.in (install): solaris make seems very good at
 	rewriting vpath file names.  try to work around it.

	* include/Makefile.in (install): solaris make seems very good at
 	rewriting vpath file names.  try to work around it.

1999-05-06  Assar Westerlund  <assar@sics.se>

	* arlad/arla.c (newwalk): renamed to walk.

1995-05-04  Assar Westerlund  <assar@sics.se>

	* rx/rx_clock.c (clock_ReInit): count microseconds also

	* arlad/fcache.c (getroot): find out the local cell the equality
 	way.  also made more robust, more informative, and more
 	consistent.  welcome to the new getroot.

	* lib/ko/kocell.c: make all cells be equal (and no cells more
 	equal that others)

	* arlad/arla.c (main): call clock_ReInit after forking

	* rx/rx_clock.c (clock_ReInit): add

1999-04-12  Assar Westerlund  <assar@sics.se>

	* arlad/Makefile.in (LDFLAGS): set

	* configure.in: LDFLAGS: substitute

1999-04-06  Love  <lha@s3.kth.se>

	* arlad/messages.c (viocsetvolstat): Do not change volumename,
	motd or offlinemsg

	* arlad/fcache.c (fcache_get): Added check if we missed
	volume. Note that we should really either nuke the entry or check
	for e->volume == NULL everywhere.

1999-03-29  Love  <lha@s3.kth.se>

	* arlad/messages.c (try_again) If we don't have EDQUOT use ENOSPC

1999-03-28  Robert Burgess  <rb@stacken.kth.se>

	* Release 0.23
	
Sat Mar 27 05:16:49 1999  Assar Westerlund  <assar@sics.se>

	* arlad/messages.c (vioc_get_cellstatus): reverse issuid test

	* configure.in (freebsd[34]): build KLD if kernel is ELF

	* xfs/bsd/xfs_syscalls-wrap-osf.c (rename sys_xfspioctl ->
 	xfspioctl)

	* xfs/bsd/xfs_syscalls-wrap-freebsd.c (rename sys_xfspioctl ->
 	xfspioctl)

	* xfs/bsd/xfs_syscalls-wrap-bsd.c (rename sys_xfspioctl ->
 	xfspioctl)

	* xfs/bsd/xfs_syscalls-common.c (rename sys_xfspioctl ->
 	xfspioctl)

	* xfs/bsd/xfs/xfs_syscalls.h (rename sys_xfspioctl -> xfspioctl)

1999-03-27  Robert Burgess  <rb@stacken.kth.se>

	* Removed Solaris umount_xfs (the umount command that comes with
	Solaris works better)

	* xfs/solaris/xfs_syscalls.c (fhopen_call): Changed in_size check

Wed Mar 24 23:31:09 1999  Assar Westerlund  <assar@sics.se>

	* arlad/arla.c: always do fork_late

Thu Mar  4 02:40:46 1999  Assar Westerlund  <assar@sics.se>
	
	* ydr/output.c: revert back extra changes

	* ydr/output.c (generate_multi): do the right thing with the macro
 	arguments

	* rxdef/ubik.xg: remove bogus struct keywords

	* rx/rx_user.c (rxi_GetUDPSocket): fix typos

1999-03-20  Love  <lha@s3.kth.se>

	* xfs/bsd/xfs/xfs_node.h: Added test for LK_SHARED

	* xfs/bsd/xfs_message.c (xfs_message_installnode): lock node when
	doing vget
	(xfs_message_installdata): lock node when doing vget
	

1999-03-19  Love  <lha@s3.kth.se>

	* Snapshot 1999-03-19

	* arlad/volcache.h (volume_make_uptodate): new function

	* arlad/volcache.c (volume_make_uptodate): new function

	* arlad/messages.c (try_again): ARLA_VMOVED and ARLA_VNOVOL
	invalidates volcache
	(*): new useage of try_again()

	* arlad/fcache.c (find_first_fs): make sure the volume is uptodate
	(try_next_fs): ARLA_VMOVED and ARLA_VNOVOL are errornous and will break
	the search for next fileserver (they mean that we should update
	our vldb info)

	* lib/ko/koerror.c: Added <rx/rx.h>, <fs_errors.h> and fileserver
	converted errors.

	* arlad/messages.c (viocflushvolume): when flushing the volume,
	flush the volume from the volcache at the same time

	* ydr/parse.y: use create_type

	* ydr/types.c (create_type): New function

	* xfs/bsd/xfs/xfs_node.h: If LK_EXCLUSIVE isn't defined make sure
	we define it to 1, its used for compat with old vget() that
	doesn't use lockmgr locking-style

	* xfs/bsd/xfs_vfsops-common.c (xfs_root_common): return a locked
	vnode

	* xfs/bsd/xfs_message.c: (xfs_message_install{node,root}): do
	vrele() instead of vput() since we never locks the vnode in the
	vget

	* xfs/bsd/xfs_vnodeops-common.c (xfs_lookup_common): Get a lock on
	when returning it

1999-03-16  Love  <lha@s3.kth.se>

	* include/Makefile.in: Break out generated headers and files that
	comes with the dist

Sun Mar 14 20:03:10 1999  Assar Westerlund  <assar@sics.se>

	* appl/vos_local.h: update prototypes

	* appl/vos_listvldb.c (vos_listvldb_iter): complain if
 	find_db_cell_and_host fails

	* appl/vos_examine.c (printvolstat): complain if
 	find_db_cell_and_host fails

	* appl/vos_common.c (get_vlentry): write a comment to make Magnus
 	happy.  assume host != NULL.
	(new_vlentry): check and complain if find_db_cell_and_host fails
	(find_db_cell_and_host): comment and remove casts

	* rxkad/rxk_clnt.c (client_GetResponse): handle versions >=
 	RXKAD_VERSION and always generate a version 2 response

1999-03-12  Love  <lha@s3.kth.se>

	* Snapshot 1999-03-12

	* ydr/parse.y: (TPOINTER): set symbol to NULL

	* arlad/fcache.c (find_first_fs): set num_conns to 0 for
	DISCONNECTED case
	(do_read_attr): check if disconnected and have bits

1999-03-11  Love  <lha@s3.kth.se>

	* arlad/fcache.c (setacl): flush bits in kernel to make it 
	update acl

1999-03-10  Assar Westerlund  <assar@sics.se>

	* rxdef/*.xg: include <config.h> and <roken.h>.  They are needed
	when building with !gcc

	* xfs/bsd/xfs/xfs_vfsops.h (xfs_fhopen): correct prototype

	* xfs/bsd/xfs/xfs_syscalls.h (xfs_pioctl_call): correct prototype

	* xfs/bsd/xfs_syscalls-common.c (lookup_node): printf format fix

1999-03-06  Love  <lha@s3.kth.se>

	* appl/vos_syncsite.c (vos_syncsite): Added arguments (-cell and
	-no-resolve)

	* rxdef/volumeserver.xg (AFSVolCreateVolume): name is string

	* appl/vos_local.h: Added prototypes

	* appl/vos_listvldb.c (vos_listvldb_iter): use
	find_db_cell_and_host

	* appl/vos_examine.c (vos_examine): use find_db_cell_and_host

	* appl/vos_common.c (getvolumetype): document
	(new_vlentry): New function
	(find_db_cell_and_host): new function

	* appl/fs.c(apropos_cmd): use sl apropos

	* appl/Makefile.in: Added vos_createvolume.c vos_endtrans.c to vos

	* appl/vos_{createvolume,endtrans}.c: New files

Thu Mar  4 02:40:46 1999  Assar Westerlund  <assar@sics.se>

	* appl/vos_listvldb.c (vos_listvldb_iter): const-ify

	* appl/vos_examine.c (printvolstat): use get_vlentry

	* appl/vos_common.c (get_vlentry): use arlalib_authflags_t

	* appl/vos_common.c (get_vlentry): new function

	* appl/vos_dump.c: new file

	* ydr/types.c (define_struct): handle already declared structures
	(set_struct_body_sym): new function

	* ydr/parse.y: handle forward declaration of struct and redundant
 	struct keywords

	* ydr/output.c (generating_multi): fix macro call code

	* ydr/lex.l: match the final newline on the #line-lines from cpp
 	so that we don't increment the lineno when we should not.

	* ydr: patches from Derrick J Brashear <shadow@dementia.org> for
 	generating rx-multi macros

1999-03-04  Love  <lha@s3.kth.se>

	* appl/*: started to use arlalib_getauthflag arlalib_authflags_t
	for unified -noauth and -local

	* appl/vos_listvldb.c: New file
	
	* appl/vos_local.h: Added prototypes for vos_listvldb() and
	vos_listvldb_iter()

	* appl/vos.c (cmds): added listvldb

	* appl/Makefile.in (vos): vos_listvldb

Thu Mar  4 02:40:46 1999  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_vfsops-netbsd.c (xfs_vfsops): add vfs_checkexp
 	conditionally

	* configure.in: check for vfsops.vfs_checkexp

	* rx/rx_pkt.c (rxi_ReadPacket): ignore errors from recvmsg
 	silently.
	(osi_NetSend): sendmsg can return ECONNREFUSED on linux.  ignore it.

	* rx/rx_user.c (rxi_GetUDPSocket): set SO_BSDCOMPAT. clean-up

	* include/Makefile.in (install): install stds.h

Wed Mar  3 13:10:15 1999  Marcus Sundberg  <mackan@stacken.kth.se>

	* xfs/linux/getcwd.c: removed redundant fcntl.h so it works on glibc 2.1

Wed Mar  3 00:49:00 1999  Marcus Sundberg  <mackan@stacken.kth.se>

	* configure.in, xfs/linux/xfs_load.c, xfs/linux/xfs/xfs_locl.h:
	Linux devfs support

Tue Mar  2 08:50:27 1999  Assar Westerlund  <assar@sics.se>

	* rxdef/*.xg: more RPCs

	* rx/Makefile.in (install): install header files

	* lwp/Makefile.in (install): install include files from srcdir

	* lib/ko/Makefile.in: add vlmisc

	* arlad/volcache.c (vldb2vldbN): move to vlmisc.c
	(get_info_loop): less warnings

	* appl/arlalib.c: let all the functions take a cell argument

	* appl/appl_locl.h: add rx header files

	* appl/Makefile.in: vos: re-organize

	* lib/ko/vlmisc.c: new file

	* lib/acl/Makefile.in (INCLUDES): use include directory in srcdir
	(Makefile): add
	* appl/vos.c: clean-up

	* ydr/output.c (print_varray): correct code
	(init_generate): let all the files include the appropriate header
	files
	(print_type): make `string<>' generate `char *'
	(encode_string): allocate memory dynamically with string<>

	* arlad/volcache.c (recycle_entry): don't assume that num_ptr and
 	name_ptr are parallel
	(add_clone): add a parameter for the suffix_type
	(get_info_common): if there's no read-write volume, add the read-only
	volume with the vanilla name

	* arlad/fcache.c (find_first_fs): do not believe volumeId[type] to
 	be valid
	(find_volume): more paranoid checks for if the volumes really exist.

	* arlad/conn.c (pinger): re-structure the code

	* rx/rx_user.c (rxi_getUDPSocket): remove code for looping around
 	bind and for checking the port number

	* rx/Makefile.in (install): install headers

	* lwp/Makefile.in (install): install headers

Sun Feb 28 00:44:51 1999  Assar Westerlund  <assar@sics.se>

	* ydr/output.c (init_generate): add inclusion of foo.{s,c}s.h in
 	foo.{c,s}s.c
	(generate_server_stub): use prefix when writing the prototype.

	* configure.in: freebsd34: nuke DIAGNOSTIC test

	* xfs/bsd/xfs_vnodeops-bsd.c: call zfreei instead of zfree

	* ydr/output.c: always generate includs for atypes.h and rx.h in
 	stubs

	* ydr/main.c (main): return an error if parse_errors is true.

	* ydr/lex.l: recognize `proc'
	  (error_message): set a flag when an error has occured.

	* ydr/lex.h (error_message): update prototype

	* ydr/parse.y: add prefix

	* ydr/lex.l: add prefix

	* lwp/Makefile.in (install): install lwp.h

	* ydr/Makefile.in (install): install ydr

	* ydr/output.c (generating): remove roken.h and arlad/fs_errors.h

	* rxdef/*.xg: arlad/fs_errors.h -> fs_errors.h

	* lwp/Makefile.in (clean): remove test programs.

	* include/Makefile.in: install some headers

	* ydr/parse.y (param_type): default to IN
	(memberdecl2): handle string without size

Sat Feb 27 20:11:28 1999  Johan Danielsson  <joda@blubb.pdc.kth.se>

	* xfs/bsd/xfs_dev-common.c (xfs_uprintf_device): don't print junk

Sat Feb 27 12:01:35 1999  Assar Westerlund  <assar@sics.se>

	* util/eefile.c, util/eefile.h: new files

	* ydr: Install patches from Derrick J Brashear
	<shadow@dementia.org> for running several instances simultaneously.

1999-02-26  Love  <lha@s3.kth.se>

	* xfs/bsd/xfs_vnodeops-common.c: (xfs_rename_common): Don't remove
	"tname". Arlad changes the fid if it exist (linux does this today)

	* configure.in: welcome back test for mnt_syncer

	* xfs/bsd/xfs_node-bsd.c: (free_all_xfs_nodes): check if we don't
	unmount and then skip mnt_syncer

	* xfs/bsd/xfs_node-osf.c: (free_all_xfs_nodes): third dummy
	argument

	* xfs/bsd/xfs_dev-common.c (xfs_devclose_common): pass on to
	free_all_xfs_nodes that we dont unmount

	* xfs/bsd/xfs_vfsops-common.c (xfs_unmount_common): pass on to
	free_all_xfs_nodes that we unmount

1999-02-25  Love  <lha@s3.kth.se>

	* arlad/messages.c (xfs_message_rename): flush new dir from DNLC
	cache

1999-02-22  Love  <lha@s3.kth.se>

	* xfs/bsd/xfs_dev-common.c:(xfs_devclose_common): Removed dead
	mnt_syncer code.

	* acconfig.h: HAVE_STRUCT_VOP_FSYNC_ARGS_A_FLAGS

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_fseek):
	HAVE_STRUCT_VOP_FSYNC_ARGS_A_FLAGS

	* configure.in: check for vop_fsync_args.a_flags

	* Release 0.22

	* arlad/fs_errors.h: catch VRESTARTING

	* arlad/messages.c: catch VRESTARTING.

	* xfs/bsd/bin/startarla.in: test for kld

Sun Feb 21 04:31:22 1999  Magnus Ahltorp  <map@stacken.kth.se>

	* xfs/linux/xfs_message.c (xfs_message_installnode): Try a
 	requested entry first, then try any entry. Delete old alias from
 	alias chain before adding it.

Sat Feb 13 02:32:37 1999  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_syscalls-common.c (sys_xfspioctl): use
 	`xfs_proc_to_cred'

	* util/Makefile.in: add heaptest
	(check): new target

	* util/heaptest.c, util/util-tester.c: improve batchability a
 	little bit

	* util/Makefile.in (libutil_SRCS, libutil_OBJS): removed prio and
 	timeprio

	* util/prio.[ch], util/timeprio.[ch]: removed
	
	* util/mem.[ch]: removed.

	* xfs/linux/getcwd.c: handle both `struct stat' and `struct
 	new_stat'

	* acconfig.h (HAVE_STRUCT_NEW_STAT): add

	* configure.in: remove old BSD kernel functions not being called
 	any longer.  test for `struct new_stat' for linux

	* xfs/linux/getcwd.c: handle the case without getcwd

	* xfs/linux/getcwd.c: try to get the current directory by any of
 	these ways:
	a. the getcwd syscall
	b. /proc/self/cwd (only on 2.1)
 	c. by tracing the directory structure backwards and comparing
 	inode numbers
	
	also make sure that buf == NULL works everywhere

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_lock, xfs_unlock): re-organize
 	the code so that we handle the case of there not being any flag
 	argument (with one argument vop_lock)

	* xfs/bsd/xfs/xfs_vnodeops.h (xfs_fsync_common, xfs_close_common):
 	update prototypes

	* xfs/bsd/xfs_vnodeops-common.c (xfs_fsync_common,
 	xfs_close_common): add `proc' argument

	* xfs/bsd/xfs_vnodeops-osf.c (xfs_fsync, xfs_close): adapt to
 	changing *-common functions

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_fsync, xfs_close): adapt to
 	changing *-common functions

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_lock, xfs_unlock, xfs_islocked):
 	re-introduce counted locking but only when flags & LK_TYPE_MASK,
 	otherwise the assymetry comes back to bite us.

	* xfs/bsd/Makefile.in (unload): add support for kld

	* configure.in (freebsd): generate vnode_if.[ch] and -I. to be
 	able to find them
	
Sat Feb  6 03:22:56 1999  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs/xfs_vnodeops.h (xfs_fsync_common, xfs_close_common):
 	update prototypes

	* xfs/bsd/xfs_vnodeops-common.c (xfs_fsync_common,
 	xfs_close_common): add `proc' argument

	* xfs/bsd/xfs_vnodeops-osf.c (xfs_fsync, xfs_close): adapt to
 	changing *-common functions

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_fsync, xfs_close): adapt to
 	changing *-common functions

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_lock, xfs_unlock, xfs_islocked):
 	re-introduce counted locking but only when flags & LK_TYPE_MASK,
 	otherwise the assymetry comes back to bite us.

	* xfs/bsd/Makefile.in (unload): add support for kld

	* configure.in (freebsd): generate vnode_if.[ch] and -I. to be
 	able to find them

	* xfs/bsd/xfs_syscalls-common.c (xfs_debug): move the super-user
 	test to the setting of the debug level.  I don't quite remember
 	why I did this but I can see no harm in letting any user find out
 	the current debug level?

	* tests/run-tests.in: add --help

	* arlad/volcache.c (vldb2vldbN): constize and only copy the safe
 	number of servers

	* arlad/fcache.c: remove old code

	* arlad/inter.c: always set Result.error to make things simpler.

1999-02-05  Love  <lha@s3.kth.se>

	* arlad/volcache.c (vldb2vldbN): Added bounce checking
	(get_info_loop): dont loop if old serve returns RXGEN_OPCODE

1999-02-05  Love  <lha@s3.kth.se>

	* arlad/volcache.c (vldb2vldbN): New function
	(get_info_loop): Added fallback-code for old server

	* arlad/volcache.c (ConnCacheEntry): Added field flags.old

	* arlad/conn.c (new_connection): reset flags.old

	* arlad/arla_local.h: Added rxgencon.h

	* appl/fs.c (connect_cmd): return 0;
	(newcell_cmd): rewrote and started to use getarg
	(getmaxfprio): return 0

	* arlad/messages.c (viocgetwscell): len strlen(cellname)+1 as
	suggested by Chuck Lever <cel@monkey.org>

Mon Feb  1 05:53:52 1999  Assar Westerlund  <assar@sics.se>

	* lwp/plwp.c: include config.h
	(LWP_CreateProcess): call thr_yield if there's one
	(Create_Process_Part2): fix call to pthread_attr_setstacksize

	* acconfig.h: define __EXTENSIONS__ to make solaris' header files
 	happy.

	* configure.in: check for thr_yield

	* lwp/plwp.[ch]: new files with lwp-over-pthreads

	* lwp/rw.c: new file with test code

	* lwp/preempt.h: more prototypes

	* lwp/Makefile.in: support building with lwp-over-pthreads

	* include/Makefile.in (lwp.h): link in the correct file for
 	LWP/pthreads

	* appl/Makefile.in: handle linking with pthreads

	* arlad/Makefile.in: handle linking with pthreads

	* INSTALL: document --with-pthreads

	* configure.in (--with-pthreads): add code from Derrick J Brashear
 	<shadow@dementia.org> for using pthreads

Sun Jan 31 20:48:57 1999  Assar Westerlund  <assar@sics.se>

	* configure.in (irix): always add -DR4000 to cflags, otherwise it
 	seems to break. 

	* xfs/irix/xfs/xfs_syscalls.h: use correct include files

	* xfs/irix/xfs/xfs_node.h: port to Irix 6.4

	* xfs/irix/xfs/xfs_fs.h: port to Irix 6.4

	* xfs/irix/xfs_vnodeops.c: port to Irix 6.4

	* xfs/irix/xfs_vfsops.c: port to Irix 6.4

	* xfs/irix/xfs_syscalls.c: use `curprocp' instead of `u'.  that
 	makes it work under 6.4 as well

	* xfs/irix/xfs_node.c: port to Irix 6.4

	* xfs/irix/xfs_message.c (xfs_message_installdata): VOP_LOOKUP is
 	called differently under irix 6.4

	* xfs/irix/Makefile.in (LDFLAGS): always add -32
	(MOD): write in current directory and not source directory

	* configure.in (irix): correct and portabilize irix6.4-test

	* xfs/solaris/xfs_vnodeops.c (xfs_map): always cast len to
 	unsigned long in the debug output

	* xfs/bsd/xfs_vfsops-osf.c (xfs_root): send both proc and cred to
 	xfs_root_common

	* configure.in (irix): define IRIX_64 if running on Irix 6.4 or
 	above.

	* tests/dir-size-mismatch: use find | xargs rm to remove the
 	files, it was overflowing the argument size.

	* xfs/solaris/xfs/xfs_dev.h (intptr_t): define if there's none

	* acconfig.h (HAVE_INTPTR_T): add

	* configure.in: bump version to 0.22pre remove duplicate test for
 	syslog test for `intptr_t'

Sun Jan 31 17:51:34 1999  Assar Westerlund  <assar@sics.se>
 
	* Release 0.21

	* configure.in (freebsd34): add -I. to kernel flags to find the
 	generated vnode_if.h

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_lock, xfs_unlock, xfs_islocked):
 	more debug output

Sat Jan 30 17:42:00 1999  Assar Westerlund  <assar@sics.se>

	* tests/copy-and-diff-gnu-mirror: use correct fd.  From Simon
 	Josefsson <jas@pdc.kth.se>

1999-01-28  Love  <lha@s3.kth.se>

	* arlad/arla.c(arla_cp): Added copy command.

1999-01-24  Love  <lha@s3.kth.se>

	* conf/Makefile.in(install): Install a empty SuidCells if there is no.

	* tests/run-tests.in: Print out that the test FAILED while running

	* xfs/bsd/Makefile.in: (xfs_vopdefs.h): Make the link even if
	'mkdir xfs' fails, and test if xfs is a dir

	* configure.in (freebsd[34]*) Add support for freebsd4, default to
	kld on freebsd4, add output from test

Tue Jan 19 20:31:50 1999  Assar Westerlund  <assar@sics.se>

	* configure.in (irix): check for IP and cpu and add them to
 	KERNEL_CFLAGS

	* xfs/irix/Makefile.in: use KERNEL_CFLAGS for figuring out CPU and
 	such

Sat Jan 16 18:55:17 1999  Love <lha@stacken.kth.se>

	* configure.in: check if VOP_LOCK takes one argument (NetBSD1.3.x)

	* xfs/bsd/xfs_vnodeops-bsd.c: Check if VOP_LOCK takes one argument

Tue Jan 12 01:16:12 1999  Assar Westerlund  <assar@sics.se>

	* xfs/include/xfs/xfs_message.h (CACHEHANDLESIZE): bump to 80
 	(needed on Solaris 7 in 64bit mode)

	* lwp/process.S: add even more ifdef's to handle sparc v9

	* lwp/make-process.o.sh.in: use CC and AS from environment.
  	remove foo.c when we're done.

	* lwp/lwp.c (REGSIZE): on a sparc v9 the registers are also 8
 	bytes

	* lwp/lwp.h (lwp_context): try to use the correct amount for sparc
 	v9

	* rx/rx_user.c (rxi_Listener): use `rx_maxSocketNumber' when
 	selecting to avoid having to send the rather large FD_SETSIZE

	* rx/rx_pkt.h (rx_GetLong, rx_PutLong): use `u_int32_t' instead of
 	`long'

	* tests/build-gdb: change path for gdb.

	* tests/build-emacs: change path for emacs.  GNU has reorganized
 	their ftp server and moved all programs into subdirectories.

Sun Jan 10 07:25:51 1999  Assar Westerlund  <assar@sics.se>

	* arlad/fprio.c (fprio_readin): don't print a warning if the file
 	cannot be opened.

	* xfs/linux/xfs_dev.c (xfs_message_rpc): also check for strange
 	positive return values.

	* xfs/bsd/xfs_wrap-bsd.c (SYSCALL_MODULE): replace index with
 	pointer
	(xfs_load): update prototype

	* xfs/bsd/xfs_vfsops-bsd.c (vfs_object_create): use the correct
 	number of arguments

	* INSTALL (--enable-kld): add

	* configure.in (freebsd3): change test for kernel object format
	(vfs_object_create): add test for number of arguments

	* xfs/bsd/xfs_vfsops-freebsd.c: preliminary support for syscall
 	KLD module

	* xfs/bsd/xfs/xfs_vfsops.h (xfs_root_common): update prototype

	* xfs/bsd/xfs_vfsops-common.c (xfs_root_common): take a `proc' as
 	argument.  call vget instead of vref.

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_root): call new style
 	xfs_root_common update comments

	* xfs/bsd/xfs_syscalls-freebsd.c: preliminary support for syscall
 	KLD module

	* xfs/bsd/xfs_wrap-bsd.c: preliminary support for syscall KLD
 	module

	* arlad/messages.c (CELLSTATUS_{PRIMARY,SETUID}): use defines
	(vioc_gcpags): implement no-op

	* arlad/inter.c (cm_getattr): real_fid is always set.

	* appl/fs_lib.c (fs_gcpags): send in a correct (and empty) params
 	structure

	* appl/fs.c (gc_cmd): correct argc and string in printf
	(all): add XDEBNODE

	* configure.in (freebsd): use sysctl to get the name of the kernel
 	reorder the include files in the kernel compilation tests, it was
 	failing on FreeBSD-current

1999-01-05  Magnus Ahltorp  <map@stacken.kth.se>

	* xfs/linux/xfs_vfsops.c: Do xfs_d_init() when building too to
	prevent dangling pointers

	* xfs/linux/xfs_message.c: Hopefully more correct invalidation of
	dentries

Tue Jan  5 00:07:51 1999  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_vfsops-openbsd.c (vfs_register, vfs_unregister):
 	define and use

	* include/kafs.h: add cell status flags

1999-01-03  Love  <lha@s3.kth.se>

	* arlad/fcache.c
	(throw_entry,fcache_reobtain_callbacks,fcache_giveup_all_callbacks):
	if the fileserver is `down' don't give up callbacks

	* xfs/bsd/xfs_node-bsd.c (xfs_getnewvnode): Set field vnlock to 0
	(new_xfs_node): Use HAVE_LK_INTERLOCK

	* xfs/include/xfs/xfs_message.h: XFS_MSG_ADVLOCK confusion

	* xfs/bsd/xfs/xfs_node.h: Added locks confusion

	* lib/ko/kocell.c: Implement clue-code for
	cell_{is,set}suid{,by_{num,name}} and $SYSCONFDIR/SuidCells

	* lib/ko/ko.h (cell_issuid): new function
	(cell_issuid_by_name): new function
	(cell_issuid_by_num): new function
	(cell_setsuid_by_num): new function
	(struct cell_entry): Added field suid_cell

	* arlad/messages.c: added rpc messages advlock
	(vioc_get_cellsstatus): implement
	(vioc_get_cells): implement

	* appl/fs_local.h: afs_listcells()

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_invalid): dummyify since is
	break free 2.2.x
	(xfs_print): write
	(xfs_advlock): comment out comfusing code

	* arlad/fcache.c (update_entry): suid-flags cleaner

	* appl/fs.c:suidcells: New command, show all cells with suid cells
	marked. afs_listcells(): Rewritten


	* appl/fs_lib.c: fs_getcells(): New function fs_getcellstatus():
	New function

	* appl/alralib.c(hfs_getcells): New function fs_getcellstatus():
	New function

	* xfs/bsd/xfs_vfsops-freebsd.c(xfs_init (<3.0)): reset ptr's
	(vfs_register): set ptr before calling function

	* conf/CellServDB(stacken.kth.se): dog.stacken.kth.se ->
	fishburger.stacken.kth.se

1999-01-03  Assar Westerlund  <assar@sics.se>

	* arlad/reconnect.c: add some more O_BINARY
	
	* arlad/messages.c: add some more O_BINARY
	
	* arlad/fcache.c: add some more O_BINARY
	
	* util/date_rfc822.c (date_time2rfc822): update from rfc822 to
	rfc1123 section 5.2.14

	* rx/rx_pkt.h (RX_FIRSTBUFFERSIZE): always define it to 1468
	(RX_CBUFFERSIZE): always define it to 1024

	* xfs/bsd/xfs_syscalls-freebsd.c: use `sysent' instead of
 	`aout_sysvec'

1999-01-02  Magnus Ahltorp  <map@stacken.kth.se>

	* Changed getcwd.so to libgetcwd.so.

Thu Dec 31 12:13:10 1998  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_node-bsd.c (xfs_dnlc_enter): actually set nameiop to
 	CREATE.  (when did this disappear?)

Thu Dec 31 13:04:23 1998  Assar Westerlund  <assar@sics.se>

	* arlad/volcache.c (volcache_getbyid): use correct hash table

	* arlad/volcache.c (recycle_entry): don't clear entire entry
	(volcache_getbyname, volcache_getbyname): restructure

	* xfs/linux/xfs_message.c (xfs_message_installnode): nuke benign
 	warning

Wed Dec 30 11:56:04 1998  Assar Westerlund  <assar@sics.se>

	* tests/untar-emacs: esthetically corect on fd 3

	* configure.in (freebsd3): always try to guess the kernel object
 	format, also print it out to give the user the change to see if
 	the guess was wrong.  also, warn when building LKMs with a !aout
 	kernel (maybe we should just switch to KLDs in that case).

	* arlad/volcache.c (recycle_entry): hopefully work around
 	refcount-bug

Tue Dec 29 03:01:57 1998  Assar Westerlund  <assar@sics.se>

	* tests/generic-build: get rid of warning messages from tar

	* configure.in (full_name_hash): more politically correct test.

	* configure.in: --with-sys: actually use the value.

	* arlad/messages.c (vioc_afs_sysname): send 4 bytes length and
 	then string
	* appl/fs_lib.c (fs_get_sysname): change to expect 4 bytes before
 	sysname string

	* arlad/arla.c (krb_get_err_text): fallback version.  Should
 	probably be somewhere else.  kroken?

	* configure.in: test for krb_get_err_text

	* configure.in: HAVE_BROKEN_FULL_NAME_HASH ->
 	HAVE_FULL_NAME_HASH_8BIT

	* xfs/linux/xfs/xfs_locl.h: conditionalize on replacing
 	full_name_hash

	* configure.in: test for broken full_name_hash

1998-12-28  Love  <lha@s3.kth.se>

	* xfs/bsd/bin/Makefile.in(startarla): Build startarla via
 	startarla.new as suggested by Ken Raeburn <raeburn@raeburn.org>

	* rx/Makefile.in(INCLUDE): typo, fix by Ken Raeburn
 	<raeburn@raeburn.org>
	
	* Snapshot 0.21pre

Mon Dec 28 01:16:36 1998  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_vfsops-freebsd.c (xfs_init): kludge that might make
 	it work with kld modules

	* aclocal.m4: KERNEL_CFLAGS -> test_KERNEL_CFLAGS

	* configure.in: support for building kld modules. more tests
	
	* xfs/bsd/Makefile.in: support building a kld module

	* xfs/bsd/xfs_vfsops-freebsd.c (xfs_init): try with
 	vfs_add_vnodeops

	* xfs/bsd/xfs_vfsops-netbsd.c (xfs_init): vfs_opv_init depending
 	on NetBSD-version

	* configure.in: check for vfs_opv_init include <sys/module.h> in
 	some tests

	* xfs/bsd/xfs_wrap-bsd.c: update and conditionalize KLD_MODULE

	* arlad/messages.c (all_powerful_p): new function.  use it.
	(vioc_afs_sysname): fix reading of sysname

	* configure.in: new files to test for
	(freebsd3): try to make kld work

	* xfs/bsd/xfs_vfsops-netbsd.c: try without having a special vfs
 	for xfs dead vnodes

	* xfs/bsd/xfs_vfsops-netbsd.c: HAVE_VFS_ATTACH ->
 	HAVE_KERNEL_VFS_ATTACH

	* xfs/bsd/xfs_vfsops-freebsd.c (xfs_stat_filesys): add

	* xfs/bsd/xfs_vfsops-openbsd.c (xfs_stat_filesys): add

	* xfs/bsd/xfs_vfsops-netbsd.c (xfs_stat_filesys): add
	(xfs_install_filesys): try xfs first
	(xfs_uninstall_filesys): dito

	* xfs/bsd/xfs_wrap-bsd.c (xfs_unload): try unloading filesystem
 	first
	(xfs_may_unload): remove

	* xfs/bsd/xfs_vfsops-netbsd.c (vfs_attach): check for vfs_init
 	being NULL

	* include/Makefile.in (HEADERS): add heap.h

	* util/heap.c, util/heap.h: new files

	* util/Makefile.in: add heap.[ch]

	* arlad/fcache.c (add_to_invalidate): go backwards

	* util/list.h (listhead, listtail, listprev, listnext, listdata,
 	listemptyp, listnextp): made into inline functions

	* arlad/inter.c (cm_close): don't overwrite the error code.

	* arlad/fcache.c (fcache_update_length): assert against usedbytes
 	wrapping around

	* arlad/fcache.c (create_file, create_directory): don't touch
 	dir_entry->status.Length

	* arlad/fcache.c (create_symlink): update usedbytes

	* INSTALL: linux: add map's warning message about updating
 	getcwd.so

	* arlad/reconnect.c (reconnect_putdata): adapt to new semantics of
 	copyfd2rx

	* arlad/fcache.c (read_data): adapt to new semantics of copyrx2fd
	and copyfd2rx

	* arlad/fbuf.c: *_copyfd2rx, *_copyrx2fd: don't close the fd some
 	comments

	* arlad/fcache.c: assert that all closes are succesful.

	* arlad/adir.c: assert that all closes are succesful.

1998-12-24  Robert Burgess  <rb@stacken.kth.se>

	* Release 0.20

1998-12-23  Assar Westerlund  <assar@sics.se>

	* xfs/linux/getcwd.c (getcwd): If we fail with ENOSYS, fall back
 	on the old getcwd.  From <allbery@ece.cmu.edu>

	* lib/ko/kocell.c (newcell): no dbnum
	(readcellservdb): init dbnum

	* arlad/messages.c (vioc_new_cell): new function
	(vioc_get_cell): fix bugs

	* lib/ko/ko.h: sync with kocell.c

	* lib/ko/kocell.c: re-organize and write some new functions

	* appl/fs.c: newcell: implement

	* appl/fs_lib.c (fs_newcell): implement

	* xfs/bsd/xfs_vfsops.c: move all xfs initialization code into
	xfs_vfsops-*bsd.c

	* configure.in (*bsd): use xfs_vfsops-*bsd.c

1998-12-22  Love  <lha@s3.kth.se>

	* */*/*: Moved xfs's include files to xfs/

1998-12-21  Assar Westerlund  <assar@sics.se>

	* arlad/cred.c (print_cred): print uid correctly

	* arlad/fcache.c (find_next_fs): made global
	(*): hopefully use try_next_fs properly

Sun Dec 20 17:52:17 1998  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_message.c (xfs_message_installnode): vget and vput
 	the parent node to prevent it from being recycled
	(xfs_message_installdata): vget and vput the vnode.

	* xfs/bsd/xfs_vnodeops-common.c (xfs_symlink_common): vput the
 	just created symlink...

	* arlad/messages.c (try_again): also translate error codes
	(*): realfid always contains the correct fid

	* arlad/fcache.c (try_next_fs): some more error codes

	* arlad/fs_errors.h: add some more error codes

	* arlad/fs_errors.h (VNOVOL, ARLA_VNOVOL): add

	* arlad/fcache.c (findconn): remove
	(try_next_fs): figure out if it's worth trying the next fs from the
	error code.  call it.
	(fcache_get): always set realfid

1998-12-19  Magnus Ahltorp  <map@stacken.kth.se>

	* xfs/linux/xfs_inodeops.c: Prevent xfs_lookup from returning
	errno values below -1000 in 2.1 kernels. They would otherwise be
	dereferenced in other parts of the kernel.

	* arlad/fcache.c: Check for rw flag when looking for backup volume

	* arlad/reconnect.c: Use find_first_fs instead of find_conn

Sat Dec 19 01:34:23 1998  Assar Westerlund  <assar@sics.se>

	* appl/fs.c: move around some more
	(apropos_cmd): implement

	* conf/CellServDB (transarc.com): updated cell entry

	* arlad/volcache.c (get_info_loop): call VL_GetEntryByNameN
 	instead of VL_GetEntryByName

	* arlad/fs_errors.h (conv_to_arla_errno): add unused.  this also
 	requires <roken.h>

	* arlad/fcache.c (fs_server_context): MAXNSERVERS -> NMAXNSERVERS

	* arlad/volcache.h (volcacheentry): use nvldbentry

1998-12-16  Magnus Ahltorp  <map@stacken.kth.se>

	* xfs/linux/bin/startarla.in: start arlad with -z switch

1998-12-15  Assar Westerlund  <assar@sics.se>

	* Release 0.19

	* xfs/solaris/xfs_dev.c (xfs_message_rpc): bzero the xfs_link's.
	why is this necessary?

	* xfs/solaris/xfs_node.c (xfs_dnlc_enter): handle the case of no
	NC_NAMLEN

	* xfs/solaris/xfs_syscalls.c (xfs_debug): new function
	(xfs_pioctl_call): call xfs_debug

	* xfs/irix/xfs_dev.c (xfs_message_wakeup_data): fix call to
	MUTEX_LOCK

	* arlad/fcache.c (find_next_fs): simplify
	(free_fs_server_context): simplify

	* tests: introduce and use AFSROOT

	* arlad/fcache.c (find_first_fs): only sort valid entries.
	estimate rtt:s before sorting.
	* arlad/volcache.c (get_info_loop): only sort valid entries.
	estimate rtt:s before sorting.
	* arlad/conn.c (conn_rtt_cmp): don't handle NULL pointers

	* arlad/conn.h (conncacheentry): add rtt
	(RTT_FUZZ): add

1998-12-14  Love  <lha@s3.kth.se>

	* xfs/unknown/xfs_deb.h: dummy

Sun Dec 13 10:55:10 1998  Assar Westerlund  <assar@sics.se>

	* Release 0.18

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_lock, xfs_unlock, xfs_islocked):
 	add a large comment describing the sad state of affairs and remove
 	all commented out code from the functions

	* ydr/parse.y: add syntax: error-function <function>

	* configure.in (AC_C_INLINE): test for

	* arlad/fcache.c (find_first_fs, find_next_fs): update to sort
 	filservers by rtt (+ random fuzz)
	(free_fs_server_context): new function

	* arlad/volcache.c (get_info_loop): get all db-servers and sort
 	them by rtt + random fuzz.

	* arlad/conn.c (conn_rtt_cmp): comparison function for rtt of two
 	entries.  adds a random fuzz to load balance.

	* arlad/conn.h (conn_rtt_cmp): function for comparing two entries
 	for rtt

Sun Dec 13 10:47:21 1998  Magnus Ahltorp  <map@stacken.kth.se>

	* appl/fs.c: Added fs rmm.

	* arlad/messages.c: Change to new symlink creation
 	sematics. VIOC_AFS_DELETE_MT_PT added. VIOC_AFS_STAT_MT_PT code
 	rewritten.

	* arlad/inter.c: Do followmountpoint in cm_symlink in order to
 	install correct information into xfs

	* arlad/fcache.c: Don't to fcache_update_length when doing
 	directory operations. Put more paranoia into fcache_update_length

	* arlad/adir.c: Change to unsigned char in hash function

	* xfs/linux/xfs_message.c: Invalidate cache when directory is
 	installed.

	* tests/*: New tests.

Sat Dec 12 11:52:22 1998  Assar Westerlund  <assar@sics.se>
	
	* xfs/bsd/Makefile.in (SYS): set from configure

	* configure.in (--with-sys): add

	* arlad/volcache.c (get_info_loop): try to return better errors.
  	also handle the case of an non-existing volume better.

	* arlad/fcache.c (followmountpoint): update some comments and move
 	some code.

	* arlad/fcache.c (followmountpoint): more comments.

	* arlad/fcache.c (followmountpoint): restructure and split up.
  	also return better errors.

	* arlad/messages.c (vioc_arladebug): new function

	* arlad/volcache.c (volcache_getby*): return ETIMEDOUT instead of
 	ENODEV

	* arlad/fcache.c (followmountpoint): don't nuke the error code

	* arlad/conn.c (pinger): ping one host per loop.  print debug
 	information correctly
	(conn_dead): print port number/services correctly.

	* appl/fs.c (checkservers_cmd): try to give better error messages
 	for non-existing cells

	* tests/Makefile.in (SRC_TESTS): add ls-afs

	* tests/ls-afs: new test

	* appl/arlalib.h (fserr): update prototype

	* appl/fs_lib.c (fserr): const-ize, print to stderr
	(fs_checkservers): copy cell name correctly. return correct return
 	value

	* appl/fs.c (checkservers): fixes

	* appl/arlalib.h: add prototype for fs_checkservers

	* appl/fs_lib.c (fs_checkservers): random fixups move around
 	#ifdef's

	* arlad/messages.c (viocckserv): some fixes

	* arlad/conn.h (conn_probe): add prototype

	* arlad/conn.c (pinger): run `conn_free' instead of just
 	decrementing the refcount when done with a connection.  if
 	somebody else killed it while we're using it, it should get
 	recycled.
	(conn_probe): new function
	(host_down): implement CKSERV_DONTPING and some other random stuff

	* xfs/linux/xfs_inodeops.c (xfs_write_file): return `i_blocks' in
 	units of `I_BLOCKS_UNIT'

	* xfs/linux/xfs_node.c (xfs_attr2inode): return `i_blocks' in
 	units of `I_BLOCKS_UNIT'

	* xfs/linux/xfs_locl.h (I_BLOCKS_UNIT): add

	* configure.in (VERSION): bump

1998-12-08  Love  <lha@s3.kth.se>

	* tests/run-tests.in: new file, do it in shellscript instead
	of the makefile.

	* lib/roken/getarg.[ch]: Made arg_printusage() understand style.

	* */{,*/}*.c: Made world aware of that arg_printusage() took
	a style argument.

	* fs/fs_lib.c: stub for VIOCCKSERV

	* fs/fs.c: checkservers

	* arlad/conn.[ch]: conn_downhosts

	* arlad/messages.c: Non working viocckserv()

	* include/kafs.h: Flags for VIOCCKSERV

Tue Dec  8 00:49:26 1998  Robert Burgess  <rb@stacken.kth.se>

	* Release 0.17.1

Tue Dec  8 00:47:49 1998  Magnus Ahltorp  <map@stacken.kth.se>

	* xfs/*: Fix memory leak.

1998-12-06  Love  <lha@s3.kth.se>

	* tests/find-and-cat-netbsd: cat netbsd 1.3.2

Sun Dec  6 20:00:25 1998  Assar Westerlund  <assar@sics.se>

	* Release 0.17

	* appl/amon.c (main): no options to XtAppInitialize

	* configure.in (VERSION): bump

	* INSTALL: add --without-x

	* appl/Makefile.in (AMON_LIBS): add more libraries

	* appl/fs_lib.c (debug): new helper function
	(arla_debug): new function

	* appl/fs_local.h (arla_debug): add prototype

	* appl/fs.c (arladebug_cmd): new function
	(xfsdebug_cmd): fix parsing and unparsing of flags

	* appl/Makefile.in (fs): add arladeb.c

	* xfs/bsd/xfs_deb.c (xfsdeb): no XDEBANY

	* xfs/linux/xfs_syscalls.h: remove xfs_syscall debug stuff

	* xfs/linux/xfs_syscalls.c (handle_xfs_syscall): remove

	* xfs/include/xfs_debug.h (XDEBANY): remove

	* include/kafs.h (VIOC_ARLADEBUG): add

	* configure.in (VERSION): bump

1998-12-06  Love  <lha@s3.kth.se>

	* arlad/messages.c (viocaviator): New funtion
	(xfs_message_pioctl): Add VIOC_AVIATOR case

	* appl/fs_lib.c (fs_getaviatorstats)new function

	* appl/arlalib.h (fs_getaviatorstats)new function

	* arlad/kernel.[ch]: added kernel_usedworkers() and
	kernel_highworkers()

	* include/kafs.h: added VIOC_AVIATOR

	* appl/amon.c: Break out stripChart and add workers

	* configure.in: Check for X.

	* appl/amon.c: New, monitor number of vnodes and kbytes used i cache.

Sun Dec  6 00:02:42 1998  Assar Westerlund  <assar@sics.se>

	* arlad/arladeb.h (arla_deb_units): export new prototypes
	* arlad/arladeb.c (arla_deb_units): define in order.  define all
 	and almost-all properly
	(arla_log_set_level_num, arla_log_get_level_num): new functions

	* xfs/linux/setdebug.c: removed

	* xfs/linux/Makefile.in: removed setdebug

	* arlad/discon_log.c (log_head): initialize to zero by default

	* arlad/reconnect.c: static-ize some

	* arlad/darla.h: add prototypes

	* arlad/arla_local.h: include reconnect.h

	* arlad/reconnect.h: new file

	* appl/vos.c (main): initports -> ports_init

	* appl/pts.c (main): initports -> ports_init

	* lib/ko/ports.c (ports_num2name): new function
	(initports): renamed to ports_init.  changed all callers

	* arlad/volcache.c (vl_probe): new function

	* arlad/messages.c (try_again): print a warning and sleep while
 	waiting for a busy volume
	(viocgetacl, viocsetacl, viocgetvolstat, viocsetvolstat): call
	try_again

	* arlad/fcache.c (fs_probe): new function
	(invalidator): new debug messages

	* arlad/cred.c (cred_expire): print a message telling the user
 	that credentials have expired

	* arlad/conn.h (ConnCacheEntry): add `probe', `probe_le',
 	`probe_next', `ntries'
	(conn_get): new parameter `probe'

	* arlad/conn.c: probe servers that were marked as down.
	(re_probe, add_to_probe_list, pinger): new functions
	(conn_init): start a pinger thread
	(new_connection, add_connection, internal_get, conn_get): new
	parameter `probe' (a function that probes the service)
	(conn_dead): print message when loosing connection to a server
	(conn_alive): print message when a server comes up again

	* arlad/arla_local.h: add <pwd.h>

	* arlad/arla.c (main): init rx before conn.  initports ->
 	ports_init

	* xfs/irix/Makefile.in (CFLAGS): update with more magic flags

	* util/list.c (listempty): explicit cast to shut up SGI cc

	* tests/copy-and-diff-gnu-mirror: use find and cmp instead of diff
 	-r

	* arlad/discon_log.c (write_log_ent): add type to `index'

	* xfs/linux/xfs_message.c (xfs_message_installnode): use
 	xfs_full_name_hash instead of full_name_hash

	* xfs/linux/xfs_inodeops.c (xfs_readdir): use xfs_full_name_hash
 	instead of full_name_hash

	* xfs/linux/xfs_locl.h (xfs_full_name_hash): work-around for
 	broken full_name_in_hash in 2.1.131

	* xfs/linux/xfs_vfsops.c (xfs_delete_inode): correct type in debug
 	output

Sat Dec  5 00:35:05 1998  Assar Westerlund  <assar@sics.se>

	* tests/Makefile.in (SRC_TESTS): add build-gdb

	* tests/build-emacs: use generic-build

	* tests/build-gdb: new test

	* tests/generic-build: new file

	* tests/strange-characters: new test

	* tests/read-vs-mmap.c, read-vs-mmap2.c, mmap-and-read.c: include
 	<time.h>

	* tests/Makefile.in: add copy-and-diff-gnu-mirror
	(check): generate more unique directory names so that several tests
	can be run in the same directory at the same time

	* tests/copy-and-diff-gnu-mirror: new test

	* arlad/kernel.c (worker): move `data' up front to make sure it's
 	more suitably aligned.  how should this really be done?

	* lwp/make-process.o.sh.in (irix): needs -n32 to as.

	* arlad/discon_log.h: clean-up

	* arlad/discon.h: clean-up

	* arlad/reconnect.c (reconnect_create): remove C++-comment

	* arlad/discon_log.c (update_log_ent): fix strange comment
 	look-a-likes

	* arlad/messages.c (afsstatus2xfs_attr): use ClientModTime instead
 	of ServerModTime

	* arlad/adir.c: spell-checking and updating of comments

	* arlad/fcache.c (find_next_fs): destroy previous connection.
  	change all callers.

	* arlad/fcache.c: call conn_dead at all the appropriate places

	* arlad/volcache.c (get_info_loop): mark conns as dead

	* arlad/conn.c (create_new_connections): init `parent'
	(recycle_conn): remove one reference to `parent'
	(internal_get): new function.  handle setting of parent.
	(conn_get): only return live servers
	(conn_dead, conn_alive): new functions

	* arlad/conn.h (ConnCacheEntry): `parent' points to a
 	security-cred-free instance
	(conn_dead, conn_alive): new functions

	* arlad/fcache.c (find_next_fs, find_first_fs): fill the daily
 	quota for comments.

	* arlad/fcache.c (find_next_fs): remember how far we got
	(getacl, setacl, getvolstat, setvolstat): always call fcache_release

1998-12-05  Love  <lha@s3.kth.se>

	* arlad/arla.c: New option, --fork-late,-f that daemonify,
	when everything is setup and running.

1998-12-03  Love  <lha@s3.kth.se>

	* Cleaned up disconnected code (no warnings).

Wed Dec  2 05:04:04 1998  Assar Westerlund  <assar@sics.se>

	* arlad/messages.c (viocgetcell): update to use `cell_dbservers'

	* arlad/fcache.c (find_first_fs, find_next_fs): new functions.
  	use them.
	(findconn): dead.  reconnect code probably doesn't work

	* arlad/volcache.c (get_info_loop): new function to try all db
 	servers.  use it.

	* lib/ko/ko.h (cell_dbservers): new prototype

	* lib/ko/kocell.c (cell_dbservers): new function to list all DB
 	servers
	(cell_listdbserver, cell_finddbserver): removed

	* ydr/output.c (print_array, print_varray): fix printf types

Wed Dec  2 09:26:55 1998  Robert Burgess  <rb@stacken.kth.se>

	* Release 0.16

Wed Dec  2 00:10:05 1998  Assar Westerlund  <assar@sics.se>

	* tests/large-dir.c, tests/large-dir-16384: new files

	* tests/Makefile.in (TEST_PROGRAMS): add large-dir

	* tests/large-dir.c (creat_files): fix types

	* tests/mmap-and-read.c (generate_random_file): generate digits in
 	the different pages

	* configure.in: vm/vm_object.h, vm/vm_pager.h, vm/vnode_pager.h:
 	check for

	* util/hash.c (_add): add braces to make it do what I mean

	* util/hash.h (hashtabaddreplace): new prototype

	* util/hash.c (hashtabadd): renamed hashtabaddreplace
	(hashtabadd): don't replace existing entry

	* arlad/afs_dir.h (MAXPAGES): update comment

	* arlad/afsdir_check.c: handle large directories

	* arlad/adir.c (getpage): new function.  use it.
	(is_page_empty): new function
	handle large directories

	* tests/large-dir.c (creat_files): better close the files

	* xfs/bsd/xfs_message.c (xfs_message_installattr,
 	xfs_message_installdata): set pager size

	* xfs/bsd/xfs_locl.h: include vm/vm.h and vm/vm_extern.h

	* configure.in: VERSION: bump to 0.15
	vm/vm.h, vm/vm_extern.h: check for

	* arlad/reconnect.c: don't inlcude discon_fix.h

	* arlad/discon_fix.h: remove. not used anymore.

	* arlad/discon_log.c: don't inlcude discon_fix.h

	* arlad/arla_local.h: remove discon_fix.h

	* arlad/discon_log.h: replace vattr by xfs_attr and moved two
 	definitions here from discon_fix.h

1998-11-23  Love  <lha@s3.kth.se>

	* Release 0.15

Sun Nov 22 00:35:33 1998  Assar Westerlund  <assar@sics.se>

	* arlad/inter.c (cm_open): set result to zero if succesful

	* arlad/fs_errors.h: new file

	* arlad/messages.c (try_again): new function
	(xfs_message_*): rewritten to use a loop and call try_again to handle
	expiring kerberos credentials and busy volumes

	* arlad/kernel.c (WORKER_STACKSIZE): increase

	* tests/untar-emacs: progress to fd 3

	* tests/Makefile.in (check): give the tests a fd to stderr

	* tests/Makefile.in: add read-vs-mmap2

	* tests/read-vs-mmap2.c: new file

	* tests/Makefile.in (SRC_TESTS): add rename2
	(check): write output of failing tests into temporary files. run
	scripts with $(SHELL) -x

	* tests/Makefile.in: add mmap-and-read

	* arlad/inter.c (cm_mkdir): ReleaseSharedLock -> ReleaseWriteLock

	* arlad/fcache.h (fcache_update_length); add prototype

	* arlad/fcache.c (fcache_update_length): new function.  use it.

	* arlad/adir.c: call fcache_update_length at appropriate places

	* configure.in: don't test for <sys/dirent.h> test for
 	vfs_object_create and vnode_pager_setsize

	* tests/read-vs-mmap.c: new file

	* tests/hello-world.in: new file

	* tests/Makefile.in: hello-world, read-vs-mmap: add

	* arlad/fbuf.c (fbuf_buf): new function

	* arlad/fbuf.h (fbuf_buf): add prototype

	* arlad/fbuf.h: (fbuf_len): add prototype

	* arlad/fbuf.c (fbuf_len): add

	* tests/untar-emacs: add . in loop

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_getpages): report the error

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhlookup): call vfs_object_create
 	if there's one.

	* xfs/bsd/xfs_vnodeops-common.c (xfs_write_comon): call
 	`vnode_pager_setsize' if there's one

1998-11-18  Love  <lha@s3.kth.se>

	* xfs/bsd/xfs_vnodeops-bsd.c(xfs_{get,put}pages): use
	vnode_pager_generic_{put,get}pages if they exist.

Tue Nov 17 04:10:59 1998  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/bin/startarla.in: create /afs

	* arlad/bsd-subr.c (write_dirent): use _GENERIC_DIRSIZ

	* arlad/arla_local.h: only include <sys/dir.h> if there's no
 	<dirent.h>

1998-11-15  Love  <lha@s3.kth.se>

	* arlad/inter.c(cm_rename): Check in new_name already exist, and
	delete it in that case, this should not happen. Suggested by
	Chuck Lever <chuckl@netscape.com>. Relly a problem between 
	implementations of rename i bsd and linux xfs.

1998-11-14  Love  <lha@s3.kth.se>

	* arlad/inter.c(cm_rename): use adir_lookup_fcacheentry()

	* arlad/adir.[ch]: New function adir_lookup_fcacheentry()

Fri Nov 13 05:31:27 1998  Assar Westerlund  <assar@sics.se>

	* arlad/volcache.c (get_info_common): check for dfs fileset

	* rxdef/vldb.xg (VLF_DFSFILE_SET): added

Tue Nov 10 05:08:27 1998  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c (fcache_get): handle the case of the entry
 	appearing while we were out looking for a free entry to put it in.

	* arlad/adir.c (adir_lookup): centry shouldn't be static

1998-11-08  Love  <lha@s3.kth.se>

	* ydr/output.c: dont ydr the OUT arguments in server stub if
	function fails, ie returns != 0.

Sat Nov  7 17:22:58 1998  Assar Westerlund  <assar@sics.se>

	* arlad/arla.c: new argument --workers

	* arlad/kernel.c (kernel_interface): dynamic number of worker
 	threads

	* arlad/{discon_fix.h,darla.h,discon_log.c,discon.h,discon_log.h,darla.c,reconnect.c}: new files (from wwshen)

	* include/kafs.h (CONNMODE_PARCONNECTED): new

	* arlad/messages.c (xfs_message_create): preliminary disconn
 	support
	(viocconnectmode): create and replay log on transitions between
	DISCONNECTED and CONNECTED

	* arlad/fcache.h: some new prototypes

	* arlad/cmcb.c (cmcb_init): not being able to create security
 	objects is a fatal error

	* arlad/fcache.c (throw_entry): signal threads waiting on fee
 	nodes
	(unlink_lru_entry): if there are no nodes, sleep until they appear.
	don't reuse nodes being used.
	(findconn): made global. handle disconnected mode
	(find_entry): remove bogus assert
	(fcache_unused): new function
	(fcache_giveup_all_callbacks): new function
	(fcache_reobtain_callbacks): new function
	(do_read_attr): more asserts
	(read_data): more asserts
	(write_data): try to handle disconnected mode
	(truncate_file): try to handle disconnected mode
	(create_file): dito
	(fcache_get): can't set volume if disconnected

	* arlad/adir.c (adir_lookup): remove static variables.  add more
 	asserts
	(adir_readdir): handle the case of broken pgcount in athena.mit.edu

	* arlad/kernel.c: create NUM_WORKERS worker threads to handle
 	messages from xfs

	* arlad/volcache.c (get_info): handle the case of getting back a
 	different name (seems to happen with DFS-servers).  move out some
 	common code.

1998-11-07  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_dead_lookup): add

	* arlad/volcache.c: separate out the _byid and _byname functions.

1998-11-07  Love  <lha@s3.kth.se>

	* appl/fs.c: Patches from Andrzej Filinski <andrzej@daimi.aau.dk>

1998-11-04  Love  <lha@s3.kth.se>

	* arlad/fbuf.c (malloc_create): Do lseek(fd, 0, SEEK_SET) before 
	reading in the file.

	* doc/oddities.texi: Added.

1998-11-02  Love  <lha@s3.kth.se>

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhopen): Fix for FreeBSD3.0

	* util/list.[ch] (listnextp): New function.

	* ydr/main.c: Call generate_tcpdump_patches().

	* ydr/parse.y: Call generate_printfunction{,_prototype} and
	generate_tcpdump_stub

	* ydr/output.h: Random prototypes for below functions.

	* ydr/output.c: Introduces concept of printing ydr structures,
	added random comment (in generated and !generated code).
	(td_file): where tcpdump patches ends up.
	(encode_*): Changed sematics for *_MEM, now do goto fail; instead
	of return
	(print_*): Implemented random functions and stubs for the rest.
	(display_type): entrypoint for printing functions
	
Mon Nov  2 05:11:25 1998  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c (throw_data): check that the length of the cache
 	file agress with the status

	* arlad/arladeb.c (arla_deb_units): add `almost-all'

	* xfs/bsd/xfs_vnodeops-osf.c (xfs_create): don't print va_rawmode,
 	there's no such field in 4.0

	* xfs/bsd/xfs_vfsops-osf.c (xfs_root): moved the code to
 	xfs_root_common

	* xfs/bsd/xfs_vfsops.h (xfs_root_common, make_dead_vnode): add

	* xfs/bsd/xfs_vfsops-common.c (xfs_root_common): new function

	* xfs/bsd/xfs_vfsops-bsd.c (make_dead_vnode): set v_data in newly
 	created node
	(xfs_root): moved the code to xfs_root_common
	(xfs_install_filesys): use vfs_register if available

	* arlad/fcache.c (write_data): make sure `usedbytes' and
 	entry->status.Length is updated correctly even if we fail to write
 	the data to the server

	* aclocal.m4 (AC_C___ATTRIBUTE__): update to discover that the
 	support for __attribute__ in gcc 2.6.3 is not enough for us

Mon Nov  2 05:53:25 1998  Robert Burgess  <rb@stacken.kth.se>

	* Release 0.14.1

1998-11-02  Love  <lha@s3.kth.se>

	* README: Note about ultrix.

	* lib/acl/acl.h: Added stds.h, patch from Max
	<davros@cyclone.Stanford.EDU>

Mon Nov  2 02:38:52 1998  Robert Burgess  <rb@stacken.kth.se>

	* Release 0.14

1998-11-02  Love  <lha@s3.kth.se>

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_{get,put}pages): Disable since
	it doesn't work.

1998-10-31  Love  <lha@s3.kth.se>

	* configure.in (FreeBSD3.0): Ugly hack to check if we have
	DIAGNOSTIC in kernel.

	* xfs/bsd/xfs_vnodeops-common.c: FreeBSD3.0
	(xfs_rename-common): Removed common


Sat Oct 31 15:00:55 1998  Johan Danielsson  <joda@hella.pdc.kth.se>

	* xfs/bsd/xfs_syscalls-common.c: make xfs_is_pag static

	* xfs/bsd/xfs_node-osf.c (vattr2xfs_attr): va_mode is u_short, not
 	mode_t
	
Sat Oct 31 03:42:23 1998  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs_inodeops.c (xfs_d_delete): make sure we have an
 	xfs_node to delete

	* xfs/solaris/bin/Makefile.in (check): add

	* arlad/inter.c (cm_rename): swap order of adir_creat and
 	adir_remove

Wed Oct 28 04:00:05 1998  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_syscalls-freebsd.c (xfs_syscall): fix typo

	* configure.in: vfsops: test for vfs_uninit and vfs_oidp struct
 	proc.p_retval: improve test vfs_register: test for

Sun Oct 25 20:36:37 1998  Johan Danielsson  <joda@hella.pdc.kth.se>

	* arlad/arla.c: implement simple `wc' command

	* rx/rx_clock.c: STARTVALUE for UXP/V

	* lwp/make-process.o.sh.in: UXP/V

	* lwp/lwp.c: set regsize to 8 for UXP/V

	* lwp/process-vpp.s: LWP context switch for Fujitsu UXP/V

1998-10-25  Assar Westerlund  <assar@sics.se>

	* configure.in (freebsd3): set VFS_LKM

Sun Oct 25 09:48:25 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* arlad: Added viocgetcacheparms

	* xfs/linux: Use filehandles in installdata. SMP fixes.

Sat Oct 24 02:11:00 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* xfs/linux: Added filehandle support

1998-10-24  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_message.c (xfs_message_installdata): revert second
	part of last change.

	* xfs/bsd/xfs_message.c (xfs_message_installdata): fall back to
	looking up cached by names if fhlookup fails.  do not reinstall
	the same node.

	* xfs/bsd/xfs_vfsops-common.c (xfs_unmount_common): conditionalize
	on HAVE_KERNEL_DOFORCE

	* xfs/bsd/Makefile.in (DEFS): remove DIAGNOSTICS.  defining this
	when it's defined in the kernel build would be a good idea but we
	currently have no way of knowing when that's the case.

	* arlad/adir.c (adir_lookup, adir_changefid): fcache_release
	properly

	* configure.in (doforce): check for

	* aclocal.m4 (AC_CHECK_KERNEL_VAR): new macro

	* xfs/bsd/bin/mount_xfs.c: handle two argument getvfsbyname

	* configure.in: getvfsbyname: check for two argument version

1998-10-23  Love  <lha@natt.e.kth.se>

	* rxkad/rxkad_locl.h: #ifndef assert

	* appl/pts.c: Implemented: createuser, creategroup, delete, remove,
	rename, chown, setfields
	(pr_name2id): Bugfixed
	(prdebug): Added debugging variable, and added some output code.
	(main): Added cvs style debugging switch.

	* lib/ko/koerror.c: Added prerrors.

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_readdir): Cookies are off_t in NetBSD

1998-10-21  Love  <lha@s3.kth.se>

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_readdir): No need to save cookies
	for netbsd.

	* ydr/output.c (encode_string): Check length of size-less TSTRING
	when decoding.

Wed Oct 21 22:41:29 1998  Johan Danielsson  <joda@hella.pdc.kth.se>

	* xfs/bsd/xfs_node-bsd.c (xfs_cnp_init): init cn_proc

Mon Oct 19 01:47:22 1998  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_syscalls-common.c (fhget_call, remote_pioctl):
 	re-order code so that we always vrele vp

	* arlad/adir.c (adir_lookup): don't release the centry if
 	fcache_get fails

	* arlad/messages.c (viocvenuslog): only print rx stats if RX_DEBUG

	* xfs/bsd/xfs_msg_locl.h: new prototype

	* xfs/bsd/xfs_message.c (xfs_message_updatefid): new function

	* xfs/include/xfs_message.h (XFS_MESSAGE_UPDATEFID): new message

	* xfs/bsd/xfs_dev-common.c (xfs_message_receive): handle
 	XFS_MSG_UPDATEFID

	* arlad/messages.c (update_kernelfid): new function
	(xfs_message_pioctl): moved most of the operations into functions of
	their own

	* arlad/adir.h: new prototypes

	* arlad/adir.c (find_entry): new function
	(find_by_name): use find_entry
	(update_fid_by_name): new function
	(adir_changefid): new function
	(adir_emptyp): new function

1998-10-19  Assar Westerlund  <assar@sics.se>

	* lwp/make-process.o.sh.in (irix): needs -n32 add -I../include to
	find config.h

	* lwp/process.S (hopefully) improve some of the conditional stuff.

Sun Oct 18 11:00:58 1998  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_mkdir): conditionalize vput
	
	* xfs/irix/xfs_vnodeops.c (xfs_write): merge solaris fix for
 	updating mtime and size
	(xfs_creat): merge solaris fix for truncating file
	(xfs_map): try to implement

Sun Oct 18 00:03:12 1998  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_symlink): fix call to
 	xfs_symlink_common

	* arlad/cred.h (cred_add_krb4): updated prototype

	* arlad/cred.c (cred_add_krb4): add `uid'

Sun Oct 18 00:02:36 1998  Johan Danielsson  <joda@hella.pdc.kth.se>

	* xfs/bsd/xfs_node-osf.c (vattr2xfs_attr): cast VNOVAL to correct
 	type
	(xfs_cnp_init): fix hash calculation

	* xfs/bsd/xfs_vnodeops-*.c: don't pass cnp to various common
 	vnode-ops

Sat Oct 17 12:37:54 1998  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_vnodeops-common.c (xfs_lookup_common,
 	xfs_create_common): disable my create optimization

	* xfs/bsd/xfs_node-bsd.c (new_xfs_node): fix interlock stuff

	* arlad/adir.c (adir_lookup): disable cache

	* xfs/bsd/xfs_message.c (xfs_message_installdata): only purge
 	cache if XFS_INVALID_DNLC is set

	* arlad/messages.c: set installdata.flag

	* xfs/include/xfs_message.h (installdata): add a flag

Sat Oct 17 11:47:48 1998  Assar Westerlund  <assar@sics.se>

	* arlad/messages.c (token_for_cell): return uid
	(xfs_message_pioctl VIOCSETTOK): remember uid

	* arlad/cred.c (cred_add): add `uid'

	* arlad/cred.h (CredCacheEntry): add uid

	* xfs/irix/xfs_vnodeops.c (xfs_readdir): look at the abi and
 	convert to irix5_dirent if needed

	* xfs/bsd/xfs_vnodeops-common.c: remove bsd-specific code

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_lookup, xfs_remove, xfs_rmdir,
 	xfs_link, xfs_symlink): move the freeing of the namei buffer here
 	from common

	* xfs/bsd/xfs_vfsops-osf.c (make_dead_vnode): fix prototype

	* xfs/bsd/xfs_syscalls-common.c: include <sys/ioccom.h> or
 	<sys/ioctl.h>

	* xfs/bsd/xfs_node-osf.c (xfs_dnlc_enter): do the negative cache
 	check

	* xfs/bsd/xfs_vnodeops-common.c: VOP_UNLOCK -> xfs_vfs_unlock

	* xfs/bsd/xfs_node-bsd.c (xfs_dnlc_enter): make sure there's no
 	entry already in the DNLC

	* xfs/bsd/xfs_message.c (xfs_message_installnode): removed cache
 	checking code

	* arlad/fcache.c (read_data): if copyrx2fd fails, bail out

Fri Oct 16 16:46:57 1998  Johan Danielsson  <joda@hella.pdc.kth.se>

	* xfs/bsd/xfs_locl.h: #define cn_nameiop ni_nameiop

1998-10-16  Love  <lha@s3.kth.se>

	* appl/fs*.[ch]: Added code to gc pags (compat).

	* include/kafs.h: Added VIOC_GCPAGS

1998-10-15  Love  <lha@s3.kth.se>

	* INSTALL,configure.in: --enable-knfs

	* xfs/bsd/xfs_vnodeops.c(xfs_readdir): Added cookie creation code.

Wed Oct 14 05:41:34 1998  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_vnodeops.h: update prototypes

	* xfs/bsd/xfs_vnodeops-osf.c (xfs_mkdir, xfs_readdir): adapt to
 	new versions of -common functions

	* xfs/bsd/xfs_vnodeops-common.c (xfs_lookup_common): do not enter
 	negative entries if creating
	(xfs_mkdir_common): remove the OS-specific code
	(xfs_readdir): set `eofflag'

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_create): make sure to call
 	VOP_LOOKUP with cn_nameiop == LOOKUP
	(xfs_mkdir): do the post mkdir lookup
	(xfs_readdir): set eofflag

	* xfs/bsd/xfs_vfsops-bsd.c: replace printf with XFSDEB

	* xfs/bsd/xfs_syscalls-common.c (fhget_call): check suser

	* xfs/bsd/xfs_node-bsd.c (xfs_dnlc_enter_name): init more fields
 	in `cn'

	* xfs/bsd/xfs_message.c (xfs_message_installnode): make sure we
 	get rid of any negative entries before adding the new entry.  Is
 	this really needed?
	(xfs_message_installdata): remove old stuff

	* xfs/bsd/xfs_locl.h (xfs_proc_to_cred): new macro

	* xfs/bsd/Makefile.in (unload): fix for non-OSF1

	* xfs/bsd/bin/mount_locl.h (__progname): remove

	* xfs/bsd/xfs_vfsops.h (xfs_fhlookup): update prototype

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhlookup): take `gen' and check it

	* lib/ko/gensysname.c (sysnames): remove all bsd entries

	* TODO: I think we do this (at least on some OSes)

	* xfs/bsd/xfs_dev-common.c (xfs_message_rpc): sigmask seems to be
 	defined on more systems than __sigmask.  are there any with only
 	__sigmask?

	* xfs/bsd/xfs_common.h: s/define/endif/

Thu Oct 15 05:29:19 1998  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/Makefile.in: use KERNEL_LD

	* xfs/bsd/xfs_locl.h: <vm/vm_zone.h>

	* configure.in (KERNEL_LD): set
	<vm/vm_zone.h>: check for
	
	* xfs/bsd/xfs_vnodeops-bsd.c: free pathnames with zfree if there's
 	a zfreei.

	* aclocal.m4 (AC_KERNEL): allow ac_kernel_ld to be already set
	(AC_HAVE_KERNEL_FUNC): use KERNEL_CLAGS.  should probably call
	AC_TRY_COMPILE_KERNEL directly

	* xfs/bsd/xfs_vnodeops-common.c: free pathnames with zfree if
 	there's a zfreei.

	* configure.in (freebsd3): add
	(vfc_mountroot in struct vfsconf): check for
	(zfreei, vfs_cache_lookup): check for

	* xfs/irix/xfs_vfsops.c (xfs_root): don't VN_HOLD
	(make_dead_vnode): use vn_alloc

	* xfs/bsd/xfs_vfsops-bsd.c: move around and reorganize the code

	* xfs/bsd/xfs_wrap-bsd.c: handle different versions of MOD_DEV

	* xfs/bsd/xfs_syscalls.h: re-organize SCARG & syscallarg

	* configure.in: add -I. before testing for VOP_LOCK & c:o

	* configure.in (freebsd): use /bin/sh and not $SHELL

	* acconfig.h (HAVE_STRUCT_PROC_P_RETVAL): add

	* configure.in (freebsd): generate vnode_if.[ch]
	(struct proc): look for `p_retval'

	* xfs/bsd/xfs_wrap-bsd.c: replace printf by XFSDEB
	(xfs_mod): handle MOD_DISPATCH

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_cachedlookup): new function
	(xfs_eopnotsupp): always return EOPNOTSUPP.  use instead of
	vn_default_error

	* xfs/bsd/xfs_syscalls.h (xfs_setpag_call, xfs_pioctl_call): add

	* xfs/bsd/xfs_syscalls-freebsd.c (xfs_syscall): move here.  handle
 	3.0 returning values
	(xfs_install_syscalls): try AFS_SYSCALL first, then first free lkm
	slot

	* xfs/bsd/xfs_syscalls-common.c (xfs_syscall): remove

	* xfs/bsd/xfs_syscalls-osf.c (xfs_syscall): move here
	(xfs_install_syscalls): try AFS_SYSCALL first, then AFS_SYSCALL2, and
	then first free lkm slot

	* xfs/bsd/xfs_syscalls-bsd.c (xfs_syscall): move here
	(xfs_install_syscalls): try AFS_SYSCALL first, then first free lkm
	slot

	* xfs/bsd/xfs_locl.h: <sys/filedesc.h>: move <sys/fctnl.h>:
 	include

	* xfs/bsd/xfs_dev-bsd.c (xfs_dev): modern FreeBSD has poll instead
 	of select

Sun Oct 11 16:15:04 1998  Johan Danielsson  <joda@stp.pdc.kth.se>

	* xfs/bsd/xfs_vnodeops-{osf,bsd}.c (xfs_create): move some code from
	xfs_create_common here

	* xfs/bsd/xfs_vnodeops-common.c (xfs_create_common): remove
	architecture dependent code (specifically the call to VOP_LOOKUP)

	* xfs/bsd/xfs_dev-common.c (xfs_message_rpc): use __sigaddset if
	defined

Sat Oct 10 21:05:13 1998  Johan Danielsson  <joda@hella.pdc.kth.se>

	* lib/ko/gensysname.c: add generic bsd handler

	* configure.in, lib/ko/ko_locl.h: sys/utsname.h

1998-10-09  Love  <lha@s3.kth.se>

	* ydr/output.c: (sizeof_type) TOPAQUE has a size (1).

Thu Oct  8 14:39:48 1998  Johan Danielsson  <joda@hella.pdc.kth.se>

	* xfs/bsd/xfs_node-osf.c (new_xfs_node): move call to insmntque to
 	after initializing the vnode
	(so it will automagically create a VM object)

	* xfs/bsd/xfs_vfsops.h: xfs_fhlookup takes generation number iff
 	OSF/1

	* xfs/bsd/xfs_message.c (xfs_message_installdata): pass generation
 	number to xfs_fhlookup iff OSF/1

	* xfs/bsd/xfs_vfsops-osf.c: implement xfs_fhlookup, and xfs_fhopen

	* xfs/bsd/xfs_vfsops-common.c (xfs_mount_common): init OSF/1
 	f_fsid

	* xfs/bsd/xfs_dev-osf.c (xfs_install_device): try to install
 	device with major 64

	* xfs/bsd/xfs_syscalls-osf.c: try to install syscall at slot 232

	* xfs/bsd/xfs_syscalls-common.c: fixes for OSF/1

	* xfs/bsd/xfs_dev-common.c (xfs_devclose_common): cleanup,
 	(xfs_message_rpc): use xfs_curproc()

	* xfs/bsd/xfs_locl.h: xfs_curproc()

	* arlad/bsd-subr.c (conv_dir): check return value from
 	fcache_fhget

	* xfs/bsd/bin/mount_xfs.c: call set_progname, add `-F' option to
 	set mountflags (used by OSF/1 mount)

Wed Oct  7 21:28:14 1998  Johan Danielsson  <joda@hella.pdc.kth.se>

	* lib/ko/gensysname.c: Add Digital UNIX/Alpha

Wed Oct  7 05:01:53 1998  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs_inodeops.c (xfs_follow_link): handle both two and
 	three argument versions

	* acconfig.h: HAVE_FOLLOW_LINK_THREE_ARGS: add

	* configure.in (linux): try looking in /proc/ksyms before
 	/proc/cpuinfo
	(follow_link): test for number of arguments

1998-10-05  Assar Westerlund  <assar@sics.se>

	* Release 0.13

	* NEWS: updated

	* configure.in: bump to 0.13

	* arlad/irix-subr.c: use the correct size macro

	* INSTALL: add --disable-dynamic-afs and --enable-smp

	* xfs/irix/Makefile.in (unload): add

	* configure.in (linux): fall back on testing on /proc/cpuinfo
	(--enable-smp): add

	* configure.in (linux): do the smp test against the include-files
	instead of /proc

	* configure.in (linux): test for smp by looking in /proc/ksyms
	instead of /proc/cpuinfo

1998-10-04  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c (stale): set sentenced iff already locked.
	changed all callers.

	* util/log.c (log_vprint_syslog): fflush

	* xfs/irix: much improved.  most stuff (except getdents) seems to
	work.

Sun Oct  4 03:44:53 1998  Magnus Ahltorp  <map@stacken.kth.se>

	* acconfig.h configure.in: Check for read_super arguments.

	* xfs/linux/xfs_load.c: Fix read_super argument confusion.

1998-10-03  Love  <lha@e.kth.se>

	* xfs/bsd/xfs_node-bsd.c(new_xfs_node): Broke out the 
	getnewvnode() code.
	(xfs_getnewvnode): new function, creates xnode too.

	* xfs/bsd/xfs_vfsops-{bsd.c,common.c}: Added strange knfs code.

Fri Oct  2 06:39:15 1998  Assar Westerlund  <assar@sics.se>

	* arlad/volcache.c (get_info): remove bogus `we didn't get what we
 	asked for'-warning

	* xfs/linux/xfs_inodeops.c (xfs_readdir, xfs_follow_link): do
 	xfs_free

	* xfs/linux/xfs_dev.c (xfs_devread): do free

	* xfs/linux/xfs_common.c (xfs_alloc): debugging for xfs_allocs -
 	xfs_frees

	* xfs/linux/xdeb.h (XDEBMEM): add

	* ydr/symbol.c (printsymbol): unused

	* lwp/iomgr.c (IOMGR): correct printf format string

	* include/bits.c: some unused to get rid of warnings

	* arlad/messages.c (xfs_message_rpc): mark as unused to get rid of
 	a warning

	* acconfig.h (_GNU_SOURCE): define it

Wed Sep 30 06:39:08 1998  Assar Westerlund  <assar@sics.se>

	* xfs/irix/xfs_dev.c (xfs_install_device): initialize the queues

	* xfs/irix/xfs_vfsops.c (xfs_mount): remove cdevsw check

Wed Sep 30 01:10:31 1998  Assar Westerlund  <assar@sics.se>

	* Release 0.12

	* arlad/fcache.c (create_node): new function
	(fcache_get): call create_node if there is no cache node.

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_lock, xfs_unlock, xfs_islocked):
 	don't use vop_nolock/vop_nounlock/vop_noislocked

Tue Sep 29 04:07:14 1998  Assar Westerlund  <assar@sics.se>

	* arlad/volcache.c (recycle_entry): release the filecache entry

	* arlad/fcache.c (fcache_get): assert that find_free_entry
 	succeeded

Mon Sep 28 00:51:45 1998  Assar Westerlund  <assar@sics.se>

	* acconfig.h (HAVE_KERNEL_VFS_GETVFS): add

Sun Sep 27 11:55:55 1998  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_may_uninstall_filesys): new
	(xfs_fhlookup): use vfs_getvfs

	* configure.in (vfs_getvfs): check for
	(linux): check for __SMP__

Sun Sep 27 11:55:54 1998  Assar Westerlund  <assar@sics.se>

	* Release 0.11

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_islocked): faking always having
 	it locked is better.

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhopen): bump v_writecount if
 	opening for wrinting

Sun Sep 27 11:29:46 1998  Assar Westerlund  <assar@sics.se>

	* xfs/linux/Makefile.in: use KERNEL_CFLAGS

	* configure.in (linux): set KERNEL_CFLAGS
	use AC_HAVE_KERNEL_STRUCT_FIELD

	* aclocal.m4 (AC_HAVE_KERNEL_STRUCT_FIELD): new macro

Sun Sep 27 07:33:18 1998  Assar Westerlund  <assar@sics.se>

	* arlad/adir.c (add_to_page): set flag

Sat Sep 26 19:45:37 1998  Robert Burgess  <rb@stacken.kth.se>

	* Release 0.10

Sat Sep 26 19:28:00 1998  Assar Westerlund  <assar@sics.se>

	* arlad/adir.c (adir_lookup): correct centry logic

	* lwp/Makefile.in (REALCFLAGS): add DEBUG

	* arlad/fbuf.c (mmap_copyrx2fd, mmap_copyfd2rx, malloc_copyrx2fd,
 	malloc_copyfd2rx): handle len == 0 properly

	* arlad/arla.c: use fcache_release

	* arlad/adir.c (adir_lookup): verify datap of cached directory

	* arlad/fcache.c (find_entry_nolock): new function
	(fcache_stale_entry): if entry is locked, sentence it
	(read_data): always call copyrx2fd
	(write_data): always call copyfd2rx
	(fcache_release): new function.  change all callers.

	* arlad/fcache.h (FCacheEntry): new flag `sentenced'
	(fcache_release): new function

Wed Sep 23 03:31:48 1998  Assar Westerlund  <assar@sics.se>

	* xfs/solaris/xfs_common.c (memcpy): define in terms of bcopy
 	because gcc generates references to it and solaris doesn't have
 	any in the kernel

Sun Sep 20 06:18:09 1998  Assar Westerlund  <assar@sics.se>

	* arlad/sunos-subr.c (conv_dir): `handle' should be `cache_name'

	* arlad/irix-subr.c (conv_dir): `handle' should be `cache_name'

	* arlad/hpux-subr.c (conv_dir): `handle' should be `cache_name'

	* arlad/linux-subr.c (conv_dir): `handle' should be `cache_name'

Thu Sep 17 00:26:08 1998  Assar Westerlund  <assar@sics.se>

	* arlad/messages.c: conditionalize all tests of RXKADEXPIRED on
 	KERBEROS

	* xfs/bsd/xfs_message.c (xfs_message_installdata): use cache
 	handle

	* xfs/bsd/xfs_syscalls-common.c: use xfs_fh_args

	* xfs/bsd/xfs_syscalls.h (xfs_fh_args): define

	* xfs/bsd/xfs_vfsops.h (xfs_fhlookup): add prototype

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhlookup): new function
	(xfs_fhopen): use `xfs_fhlookup'

1998-09-15  Love  <lha@s3.kth.se>

	* xfs/linux/xfs_locl.h: Checked for HAVE_LINUX_MODVERSIONS_H
	and appied patch from Aaron M. Ucko <amu@mit.edu>.

	* configure.in: - Added check for <linux/modversions.h>
	- Applied patch from  (Dima Ruban) <dima@best.net>

Mon Sep 14 03:14:13 1998  Assar Westerlund  <assar@sics.se>

	* xfs/solaris/xfs_vnodeops.c (xfs_read, xfs_write): complain if
 	not VREG

	* xfs/solaris/xfs_message.c (xfs_message_installdata): only purge
 	the name cache if this file had data before.

	* xfs/bsd/xfs_vnodeops-common.c (xfs_lookup_common): removed bogus
 	NCHNAMLEN test

	* xfs/bsd/xfs_node-bsd.c (xfs_dnlc_enter): check for NCHNAMLEN.
  	apparently freebsd-3.0 doesn't have any limit on the length of
 	file names in the dnlc.

	* conf/arla.conf: bump {high,low}_bytes

	* arlad/messages.c (xfs_message_mkdir): do an installdata of the
 	new directory

	* arlad/inter.c (cm_getattr): should be no need to set the tokens
 	here explicitly

	* arlad/adir.c: removed lots of magic, clean-up.
	(adir_lookup): add a one-entry cache of directories
	(adir_readdir): return entries in order stored in directory instead of
	hash table order (. and .. are always the two first entries)

1998-09-13  Johan Danielsson  <root@chowder.pdc.kth.se>

	* configure.in: use AC_ELF_OBJECT_FORMAT, add -D_LKM to CFLAGS
	when checking for vfssw, (NetBSD) try to figure out KERNEL_CFLAGS
	in a more intelligent way, and make sure we have -mno-fp-regs on
	alpha

Sat Sep 12 23:34:14 1998  Assar Westerlund  <assar@sics.se>

	* xfs/solaris/xfs_vnodeops.c (xfs_setattr): clear tokens before
 	rpc
	(xfs_link): arguments in correct order.  call lookup correctly
	(xfs_map): verify that the attributes are there.  fake handling the
	MAP_SHARED, PROT_WRITE-case

	* xfs/solaris/xfs_syscalls.c: solaris' uprintf doesn't understand
 	%p

	* arlad/messages.c (xfs_message_putattr): install the new
 	attributes

	* arlad/fcache.c (truncate_file): send (size, 0, size) to
 	StartRXAFS_StoreData.

1998-09-12  Love  <lha@s3.kth.se>

	* ydr/output.c: Added missing adding of total_len for strings.
	Added RCSID to the generated files.

Sat Sep 12 03:01:36 1998  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_vfsops.h (xfs_mount_common): new prototype

	* xfs/bsd/xfs_vfsops-common.c (xfs_mount_common): const-ize
 	user_path

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhopen): more debugging

	* xfs/bsd/xfs_syscalls-common.c (fhget_call, fhopen_call): new
 	prototypes

	* xfs/bsd/xfs_syscalls-freebsd.c (xfs_syscallent): correct number
 	of arguments

	* xfs/bsd/xfs_syscalls-bsd.c (xfs_syscallent): correct number of
 	arguments

	* arlad/fcache.c (fcache_fhget): check fhopen_working

Fri Sep 11 04:27:35 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* milko/{ptserver.c,pr.c}: First version of ptserver

Wed Sep  9 22:15:09 1998  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_syscalls.h (SCARG): better definition

	* xfs/bsd/xfs_syscalls-common.c: now even compiles

	* xfs/bsd/xfs_message.c (xfs_messge_installdata): don't use
 	non-existing variable `tmp'

	* rx: compilable without RXDEBUG

	* arlad/messages.c: remove unused variables

	* lib/ko/gensysname.c: add freebsd2.2

	* arlad/arla.c (arla_rx_status): conditionalize on RXDEBUG

	* arlad/Makefile.in (REALCFLAGS): add RXDEBUG

Tue Sep  8 01:21:25 1998  Assar Westerlund  <assar@sics.se>

	* arlad/adir.c: new fcache_open_file

	* xfs/bsd/xfs_vfsops.h (xfs_fhopen): prototype

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_fhopen): new function

	* xfs/bsd/xfs_syscalls-common.c (fhget_call, fhopen_call): new
 	functions
	(pioctl_call): restructure

	* xfs/solaris/bin/umount_xfs.c: include <config.h>
	add ID
	
	* xfs/solaris/bin/mount_xfs.c: include <config.h>
	add ID
	
	* xfs/solaris/bin/test-fhopen.c: new file

	* xfs/solaris/bin/Makefile.in (test-fhopen): add

	* xfs/solaris/xfs_vnodeops.c (xfs_space): implement for cmd ==
 	F_FREESP, fl->l_len == 0

	* xfs/solaris/xfs_vfsops.c (xfs_fhlookup, xfs_fhopen): new
 	functions

	* xfs/solaris/xfs_syscalls.h (xfs_fh_args): add

	* xfs/solaris/xfs_syscalls.c (fhget_call, fhopen_call): new
 	functions
	(pioctl_call): restructure

	* xfs/solaris/xfs_message.c (xfs_message_installdata): update to
 	new message.  use xfs_fhlookup

	* xfs/solaris/xfs_deb.h (XDEBLKM, XDEBSYS): define

	* xfs/sunos/xfs_message.c (xfs_message_installdata): update to new
 	message

	* xfs/rhapsody/xfs_message.c (xfs_message_installdata): update to
 	new message

	* xfs/linux/xfs_message.c (xfs_message_installdata): update to new
 	message

	* xfs/irix/xfs_message.c (xfs_message_installdata): update to new
 	message

	* xfs/include/xfs_message.h (CACHEHANDLESIZE): make fsid_t +
 	fhandle_t in size
	(xfs_message_installdata): add cache_name

	* xfs/bsd/xfs_message.c (xfs_message_installdata): update to new
 	message

	* xfs/aix/xfs_message.c (xfs_message_installdata): update to new
 	message

	* include/kafs.h (VIOC_FHGET, VIOCE_FHOPEN): define

	* arlad/inter.h (cm_open): update prototype

	* arlad/inter.c (cm_open): return cache_name and cache_handle

	* arlad/arla.c: update to new fcache_open_file

	* arlad/fcache.h (FCacheEntry): 32-ize.  replace `inode' with
 	index and cache-handle

	* arlad/fcache.c (fhopen, fcache_fhget): new functions
	(fcache_create_file): new function.  use.
	(fcache_open_file): use fhopen if it's working
	(fcache_open_file): remove mode argument.  change all callers.
	(find_entry): handle the case of being called from volcache before the
	fcache is initialized.
	(read_data, write_data): only call copyrx2fd/copyfd2rx if sizefs > 0

	* arlad/subr.h (conv_dir): update prototype

	* arlad/*-subr.c (conv_dir): return cache_name and handle.

	* arlad/Makefile.in (KAFS_LIBS): set
	(LIBS): add KAFS_LIBS
	
1998-09-06  Love  <lha@s3.kth.se>

	* output.c: - Added bounce checking for memencoding.
	- Got rid of fail: label error message.

	* rx/rx.h: Added sys/param.h to get rid of warning.

Fri Aug 28 22:49:22 1998  Assar Westerlund  <assar@sics.se>

	* util/strutil.h (strupr, strlwr): remove prototypes

	* util/strutil.c (strupr, strlwr): remove (they're already in
 	libroken)

Mon Aug 24 02:48:19 1998  Assar Westerlund  <assar@sics.se>

	* xfs/solaris/xfs_vnodeops.c (xfs_create): truncate the file if
 	needed

	* xfs/solaris/xfs_vnodeops.c (xfs_create): existing file is no
 	error
	(xfs_write): update mtime and size from cache vnode

Tue Aug 11 18:34:33 1998  Johan Danielsson  <joda@blubb.pdc.kth.se>

	* arlad/arla.c (read_conffile): use parse_units

Tue Aug  4 02:19:06 1998  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_vfsops): conditionalize vfc_name

	* configure.in: check for `vfs_name' in `struct vfsops'

Fri Jul 31 00:15:38 1998  Robert Burgess  <rb@stacken.kth.se>

	* Release 0.9
	
	* xfs/solaris: compiler warning cleanup

Thu Jul 30 23:04:46 1998  Assar Westerlund  <assar@sics.se>

	* configure.in (netbsd): comments are `dnl' and not `/*' :-)

	* configure.in: --with-krb{4,5}: better values for include and lib
 	directory

	* xfs/linux/xfs_inodeops.c (xfs_write_file): set the f_pos of the
 	cached file before calling its write

Wed Jul 29 22:35:31 1998  Assar Westerlund  <assar@sics.se>

	* TODO: optimistically remove the items that I think have been
 	fixed

	* arlad/fcache.c (unlink_lru_entry): don't remove entries with
 	refcount > 0
	(followmountpoint): set refcount on the root of the new volume, not on
	the mount point in the old one.

	* arlad/inter.c (cm_lookup): fix the handling of `..' over mount
 	points.

	* arlad/volcache.c (recycle_entry): decrement the refcounts of all
 	fcacheentries pointing to the root of any of the volumes of `e'

	* arlad/volcache.h (volcacheentry): remove `mount_point'

	* INSTALL: removed mknod from BSD installation instructions

	* xfs/bsd/bin/xfs_makedev: new file

	* xfs/bsd/bin/startarla.in: use xfs_makedev

	* xfs/bsd/bin/Makefile.in: install xfs_makedev

	* xfs/bsd/xfs_wrap-bsd.c: made it into a LKM_DEV.

	* xfs/bsd/xfs_dev-bsd.c (xfs_install_device, xfs_uninstall_device,
 	xfs_stat_device): removed all code for adding the device to the
 	cdevsw.

	* xfs/bsd/Makefile.in (load): use -p xfs_makedev

	* arlad/adir.c (adir_remove, adir_creat): assert the directory
 	having data

	* arlad/inter.c (cm_create, cm_mkdir, cm_symlink, cm_link,
 	cm_remove, cm_rmdir, cm_rename): make sure we have the data of the
 	directory

	* arlad/fbuf.c (malloc_truncate): call ftruncate

	* xfs/bsd/xfs_vfsops-common.c (xfs_mount_common): handle two
 	argument vfs_getnewfsid

	* configure.in: test for two argument vfs_getnewfsid

Tue Jul 28 23:36:47 1998  Assar Westerlund  <assar@sics.se>

	* lwp/process.S: Applied patch for NetBSD/alpha from John Davison
 	<davisoja@clarkson.edu>

	* ydr/output.c: try to handle error returns from rx_Read and
 	rx_Write

	* lib/ko/kocell.c: check memory allocation and clean-up

	* appl/fs.c (afs_listquota): don't divide by zero

	* arlad/fcache.c (followmountpoint): close fd if fbuf_create fails

1998-07-28  Love  <lha@e.kth.se>

	* xfs/bsd/xfs_vfsops-osf.c(xfs_install_fs): Be paranoid about the size
	of the private data of struct vnode.

	* xfs/bsd/xfs_dev-common.c: (xfs_message_rpc):No code for sigwaitmask

1998-07-24  Love  <lha@e.kth.se>

	* xfs/bsd/xfs_vfsops-osf.c: (xfs_root): Added uid check for osf.

	* appl/fs.c: Added VIOCNOP.

Fri Jul 24 19:15:45 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* arlad/messages.c: Added VIOCGETCELL, VIOCWHEREIS, VIOCNOP,
 	VIOCUNPAG and VIOC_AFS_STAT_MT_PT.

Fri Jul 24 09:53:19 1998  Assar Westerlund  <assar@sics.se>

	* configure.in (int32, u_int32): test for

	* arlad/messages.c (xfs_message_create): try installing data for
 	the new file.

	* arlad/arla.c (temp_sysname): const-ize

Fri Jul 24 06:49:32 1998  Magnus Ahltorp <map@stacken.kth.se>

	* xfs/linux/xfs_inodeops.c: Merged in patch from
	Aaron M. Ucko <amu@mit.edu>.

	* xfs/linux: Made things work better on 2.0 and i386.

1998-07-24  Love  <lha@e.kth.se>

	* appl/fs.c: fixed small bug in fs lsm.

Thu Jul 23 03:55:12 1998  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_vfsops-common.c (xfs_mount_common): use
 	vfs_getnewfsid is there's one.  From Dan Winship <danw@MIT.EDU>

	* xfs/bsd/xfs_vfsops-bsd.c: use `struct vnodeopv_desc',
 	vfs_attach, and vfs_detach when applicable.  From Dan Winship
 	<danw@MIT.EDU>

	* configure.in: more tests for modern NetBSD.  From Dan Winship
 	<danw@MIT.EDU>

	* arlad/inter.c (expand_sys): new function for expanding @sys
	(cm_lookup): expand @sys anywhere in the name

	* xfs/bsd/xfs_vnodeops-common.c (xfs_inactive_common): handle the
 	case of an already clean vnode.

	* xfs/bsd/xfs_node-bsd.c (free_xfs_node): remove bogus comment

	* arlad/fcache.c (create_{file,symlink,directory}): update the
 	acccache and anonacess

	* arlad/volcache.c: rename recover_state -> volcache_recover_state

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_islocked): return 0 as a
 	fallback

	* xfs/bsd/xfs_vnodeops.h (xfs_vfs_readlock, xfs_vfs_writelock,
 	xfs_vfs_unlock): new macros for encapsulating the locking

	* xfs/bsd/xfs_vfsops-osf.c (xfs_root): remove ifdef __osf__

	* xfs/bsd/xfs_vfsops-bsd.c (xfs_root): remove ifdef __osf__

Wed Jul 22 05:00:08 1998  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.h (create_symlink): update prototype

	* arlad/fcache.c: keep better track of the number of used bytes
 	(usedbytes)

	* rxdef/fs.xg (Symlink): correct

	* arlad/fcache.c (fcache_file_name): cast `inode' to unsigned

	* lib/ko/gensysname.c: restructured, cleaned up and added new
 	sysnames

	* util/strmatch.c: const-ize

	* arlad/adir.c: replace magic numbers with expressions based on
 	constants from afs_dir.h

	* arlad/arla.c (main): set the sysname from arla_getsysname

Tue Jul 21 04:55:00 1998  Assar Westerlund  <assar@sics.se>

	* arlad/adir.c (adir_remove): eliminate trailing empty pages

	* arlad/adir.c (adir_remove): use the actual size of the converted
 	directory instead of that from status

	* arlad/adir.c (adir_lookup, adir_readdir): use the actual size of
 	the converted directory instead of that from status

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_revoke): implement

	* configure.in (vop_revoke, genfs_revoke): check for

	* configure.in (vop_noislocked, genfs_nolock, genfs_nounlock,
 	genfs_noislocked): check for

	* xfs/bsd/xfs_vnodeops-bsd.c (xfs_lock, xfs_unlock, xfs_islocked):
 	try to use default operations

Mon Jul 20 04:51:11 1998  Assar Westerlund  <assar@sics.se>

	* configure.in: openbsd2.3: remove
	more kernel tests
	
	* lwp/lwp.h (lwp_context): add linkRegister and conditionRegister
 	for powerpc

	* xfs/bsd: restructured

	* arlad/arla.c (connected_levels): fix misspelling

Mon Jul 20 01:49:28 1998  Robert Burgess  <rb@stacken.kth.se>

	* Release 0.8

Sun Jul 19 10:41:44 1998  Mattias Amnefelt  <mattiasa@stacken.kth.se>

	* appl/vos.c: added support for busy volumes

Fri Jul 17 18:21:10 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* configure.in, xfs/linux/Makefile.in, xfs/linux/getcwd.c: Added
 	getcwd shared library to make getcwd work better in 2.1.

Fri Jul 17 03:10:48 1998  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c (fcache_recover_state): make sure the volume of
 	the entry we read back actually exists, otherwise just ignore it.

Thu Jul 16 02:06:28 1998  Assar Westerlund  <assar@sics.se>

	* configure.in: selinfo.si_pid test removed

	* lib/ko/gensysname.c (printsysname): arla_getsysname should
 	return a const string

	* lib/ko/ko.h (arla_getsysname): const-ize

	* arlad/volcache.c (volcache_getbyname, volcache_getbyid):
 	restructure tail so that refcount is return whenn e != NULL

	* xfs/openbsd2.3/xfs_vnodeops.c (xfs_lookup): set *vpp to NULL at
 	the beginning

	* xfs/bsd/xfs_vnodeops.c (xfs_lookup_common): set *vpp to NULL at
 	the beginning

1998-07-15  Love  <lha@s3.kth.se>

	* lib/ko/gensysname.c: Added generation of a sysname function.

Tue Jul 14 16:35:31 1998  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/bin/mount_xfs.c: conditionalize on autoconf symbols
 	instead of on __FreeBSD__

	* configure.in (getvfsbyname,vfsisloadable,vfsload): check for
 	them

1998-07-14  Love  <lha@s3.kth.se>

	* arlad/services.h: Added VOTE_SERVICE and DISK_SERVICE

	* appl/udebug.c: Added the udebug program.

	* appl/vos.c: Added command syncsite (only work on local cell)

	* appl/arlalib.[ch]: arlalib_getsyncsite() does not work,
	I can't see why it shouldn't work thou.

	* appl/appl_locl.h: added <err.h> and <ubib*>

	* appl/Makefile: Added udebug

	* rxdef/ubik.xg: Added

	* xfs/bsd/bin/mount_xfs.c: Added patch from Alec Wolman 
        <wolman@cs.washington.edu> to add the right argument to mount
        for FreeBSD

Mon Jul 13 20:50:09 1998  Assar Westerlund  <assar@sics.se>

	* lwp/make-process.o.sh.in (aix): for some odd reason the aix
 	assembler is happier if we always say we have a RIOS
	
	* ydr/Makefile.in: compat with stupid makes

	* xfs/sunos/Makefile.in: compat with stupid makes

	* xfs/linux/Makefile.in: compat with stupid makes

	* util/Makefile.in: compat with stupid makes

	* rxdef/Makefile.in: compat with stupid makes

	* lwp/process.S: rhapsody fixes

	* arlad/volcache.c (recycle_entry): only decrement fe->refcount
 	if we found the node.

	* arlad/kernel.c (process_message): remove `proc_msg: byte = %d'

	* arlad/fcache.c (count): rename to inode_count
	(fcache_stale_entry): always call stale
	(fcache_find): check if find_entry succeeded

	* arlad/conn.c (conn_get): check securityindex and cred, otherwise
 	we could end up not having any connection for (0,0) and loose when
 	we get a callback

	* arlad/arla.c (newwalk): patches from Alec Wolman
 	<wolman@cs.washington.edu>

	* arlad/Makefile.in: compat with stupid makes

	* lib/Makefile.in: compat with stupid makes

	* appl/Makefile.in: compat with stupid makes

	* THANKS: Alec Wolman <wolman@cs.washington.edu>

	* Makefile.in: compat with stupid makes

	* configure.in (KERNEL_INCLUDE): include -I
	(rhapsody): add
	some more field tests

	* config.{guess,sub}: rhapsody

	* xfs/rhapsody: Rhapsody port from Alexandra Ellwood <lxs@MIT.EDU>

Thu Jul  9 16:14:50 1998  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs_inodeops.c (xfs_write_file): 2.0-fix

Mon Jul 13 06:35:55 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* xfs/linux: Locking corrected and locking debugging added

	* xfs/linux: Changed to new lookup method

Sun Jul 12 16:39:05 1998  Johan Danielsson  <joda@emma.pdc.kth.se>

	* xfs/bsd/*: Merge OSF/1 changes.

	* xfs/bsd/xfs_dev.h: make xfs_devopen static, and add prototype
 	for xfs_func_is_devopen that does the comparison

	* xfs/bsd/xfs_deb.h: unsigned int

	* xfs/bsd/xfs_deb.c: unsigned int

	* xfs/bsd/xfs_common.c: use xfs_malloc

	* configure.in: Add support for OSF/1.

	* xfs/bsd/bin/{mount_xfs,umount_xfs}.c: use <mount_locl.h>

	* xfs/bsd/bin/mount_locl.h: common include file for mount/umount

	* xfs/bsd/bin/mntopts.h: remove __P from the single prototype (to
 	avoid having to add a definition for __P) -- all compilers (gcc
 	and DEC CC knows prototypes anyway).

	* xfs/bsd/bin/Makefile.in: some fixes for OSF/1: conditionally
 	build `startarla', and add include and link paths for roken.

	* rxkad/rxk_crpt.c: __alpha is LE

Thu Jul  9 22:18:25 MET DST 1998  Mattias Amnefelt  <mattiasa@stacken.kth.se>

	* appl/Makefile.in: Changed so we use libroken included in
	  arla insead of the one which comes with kth-krb.

1998-07-08  Love  <lha@e.kth.se>

	* xfs/bsd/{xfs_vfsops.c,xfs_wrap.c} Check if we can unload 
	before we even try, since on NetBSD you can unload a
	mounted filesystem, that will crash in next sync.

Wed Jul  8 01:44:15 1998  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c (creat_nodes): use IOMGR_Select instead of
 	LWP_DispatchProcess to give the iomgr thread the chance to run

	* xfs/aix/xfs_syscalls.c (xfs_setpag_call): generate the pag
 	correctly

1998-07-07  Love  <lha@e.kth.se>

	* util/{time,}prio.[ch], util-tester.c: Added.

Tue Jul  7 02:41:05 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* xfs/linux/xfs_vfsops.c: Use print_aliases() and
	set xfsp->root to NULL when unmounting

	* xfs/linux/xfs_common.[ch]: Added print_aliases()

Mon Jul  6 19:56:34 1998  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_dev.c: obvious xfs_vfs_busy fix

Mon Jul  6 12:59:51 1998  Mattias Amnefelt  <mattiasa@sundance.stacken.kth.se>

	* appl/vos.c: correct parsing of partition names

	* appl/appl_locl.h: #include <ctype.h>

Mon Jul  6 12:29:04 1998  Johan Danielsson  <joda@emma.pdc.kth.se>

	* xfs/bsd/Makefile.in: Get KERNEL_CFLAGS from configure.

	* xfs/bsd/xfs_dev.c: Add wrapper for vfs_busy.

	* xfs/bsd/xfs_vnodeops.c: Add wrapper for VOP_LOCK/VOP_UNLOCK.

	* configure.in: Add KERNEL_CFLAGS for *BSD and OSF/1. Test for
 	three valued vfs_busy, and two valued VOP_LOCK.

	* aclocal.m4: AC_TRY_COMPILE_KERNEL, that adds KERNEL_CFLAGS to
 	CFLAGS during test.

Sun Jul  5 20:26:02 1998  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c (fcache_find): new function add invalidating and
 	vnode creating threads

	* arlad/fcache.h (FCacheEntry): rename `listentry' -> `lru_le'.
  	add `invalid_le'
	(fcache_find): add prototype

	* util/list.c (listaddbefore, listaddafter): new functions

Sun Jul  5 03:28:44 1998  Assar Westerlund  <assar@sics.se>

	* arlad/arla.c: new option `--cache-dir'

Sun Jul  5 04:28:02 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* xfs/linux/xfs_vfsops.c: Fix 2.1 {put,delete}_inode weirdness

	* xfs/linux/xfs_message.c: Fix callback handling

Sun Jul  5 04:24:14 1998  Magnus Ahltorp  <magnus@dike.aladdin.se>

	* xfs/linux/xfs_inodeops.c: Clear vm maps when closing file.

Sat Jul  4 16:21:44 1998  Magnus Ahltorp  <magnus@dike.aladdin.se>

	* xfs/linux/xfs_inodeops.c: 2.0 fixes

Sat Jul  4 05:53:01 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* xfs/linux/*: Big rewrite of different things. Works somewhat
	(writes	sometimes do the wrong thing) on 2.1, 2.0 is untested.
	The file system may now be mounted before arlad is started.

Fri Jul  3 19:38:22 1998  Assar Westerlund  <assar@sics.se>

	* arlad/arla_local.h: this ugliness seems required

Wed Jul  1 21:34:42 1998  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c (fcache_get): remove the old entry from the free
 	list before adding the new one.
	
Sat Jun 27 12:46:20 1998  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs_syscalls.c (sys_afs): correct check for
 	copy_{from,to}_user.  Always return -errno.

	* xfs/linux/xfs_common.h (copy_to_user, copy_from_user): these
 	functions should return the number of uncopied bytes.

	* configure.in: remove uid_t size test

	* xfs/include/xfs_message.h: use __kernel_foo_t

	* xfs/include/xfs_attr.h: define __kernel_foo_t if they are not
 	already defined and use them.

	* xfs/bsd/xfs_node.c (vattr2xfs_attr): cast to `mode_t' otherwise
 	it breaks on modern NetBSD

Thu Jun 25 06:04:01 1998  Assar Westerlund  <assar@sics.se>

	* arlad/adir.c (add_to_page): don't index off the end of the page.

1998-06-24  Love Hornquist-Astrand  <root@junkyard.stacken.kth.se>

	* doc/partsofarla.texi: Added info about libkafs and pioctl()

Mon Jun 22 17:34:53 1998  Robert Burgess  <rb@stacken.kth.se>

	* xfs/solaris/xfs_vfsops.c: debug panic patch from:
	John Hawkinson <jhawk@bbnplanet.com>

1998-06-22  Love  <lha@e.kth.se>

	* Added doc/*.texi

1998-06-21  Love  <lha@e.kth.se>

	* lib/sl/sl.[ch]: Added SL_BADCOMMAND

	* appl/{fs,vos}.c: Fixes for sl.

	* configure.in: Added patch for afslib from: 
	Mark Eichin <eichin@kitten.gen.ma.us>

Fri Jun 19 20:43:42 1998  Assar Westerlund  <assar@sics.se>

	* appl/fs.c (connect_cmd): correct comparison against `dis'

Wed Jun 17 17:08:39 1998  Robert Burgess  <rb@stacken.kth.se>

	* Release 0.7.2

Sat Jun 13 03:32:39 1998  Assar Westerlund  <assar@sics.se>

	* appl/vos.c (printpartinfo): use bogus field

1998-06-09  Love  <lha@e.kth.se>

	* lwp/make-process.o.sh.in: The new magic way of building process.o

Tue Jun  9 10:11:03 1998  Magnus Ahltorp  <map@stacken.kth.se>

	* Release 0.7.1

	* major bug fixes

Mon Jun  8 18:07:12 1998  Robert Burgess  <rb@stacken.kth.se>

	* Release 0.7

1998-06-08  Love  <lha@e.kth.se>

	* arlad/fcache.c: Try to do sane things with callback->ExpirationTime.
	(Assume that ExpirationTime is a relative time)

	* util/log.c(log_vprint_file): Print date when logging to file/stderr.

Mon Jun  8 15:14:10 1998  Assar Westerlund  <assar@sics.se>

	* xfs/openbsd2.3/xfs_syscalls.c: merge in
 	xfs/bsd/xfs_syscalls.c:1.26->1.27

	* xfs/bsd/xfs_syscalls.c (xfs_setpag_call): only copy the required
 	gids and return the new cred

Sun Jun  7 10:57:18 1998  Assar Westerlund  <assar@sics.se>

	* configure.in: add irix

Sun Jun  7 07:23:07 1998  Robert Burgess  <rb@stacken.kth.se>

	* xfs/{solaris,aix,sunos}/xfs_messages.c
	(xfs_message_invalidroot): clear tokens when invalidating

	* arlad/fcache.c (fcache_init): set fprioritylevel at init

Sun Jun  7 07:19:35 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* acconfig.h, configure.in, lib/roken/roken.h:
	Autodetect linux htonl weirdness 

Thu Jun  4 00:12:37 1998  Assar Westerlund  <assar@sics.se>

	* arlad/arla.c: new option `--recover' or `-z' for recovering
 	(not) stored state

	* arlad/fcache.c (fcache_init): new parameter `recover'

	* arlad/volcache.c (volcache_init): new parameter `recover'

Wed Jun  3 23:41:42 1998  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c (do_read_attr): make sure we don't return -1

Tue Jun  2 19:16:15 1998  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs_locl.h: include <linux/modversions.h> to get
 	versioned names of exported kernel symbols

Tue May 26 22:54:33 1998  Assar Westerlund  <assar@sics.se>

	* acconfig.h (VFS_NEED_PROCP): remove

	* configure.in (openbsd2.3): remove old junk

Mon May 25 04:16:26 1998  Artur Grabowski  <art@stacken.kth.se>

	* arlad/messages.c: fix reading of links when only having
	'l' rights

	* xfs/*bsd*/xfs_vnodeops.c: change size and mtime of files when
	writing to them.

Mon May 25 00:58:17 1998  Assar Westerlund  <assar@sics.se>

	* Release 0.6

	* lwp/Makefile.in: more uglyness for process.S

	* util/Makefile.in: link mmaptime_test with libroken

1998-05-24  Love  <lha@e.kth.se>

	* util/mmaptime_test.c: Added

	* arlad/messages.c(vioc_fpriostatus): FPRIO_{GET,SET}MAX

	* arlad/fcache.c(restore_state): Set priority too.
	(do_read_attr): Check for disconnected mode, if we got
		attr just return, otherwise return ENETDOWN.
	(read_data): Check for disconnected mode.
	(fcache_get): Check for disconnected mode.
	(uptodatep): Check for connected logging mode.
	
	* arlad/conn.c(conn_free): When in disconnected mode conn
	sets to NULL.

	* appl/{arlalib.h,fs.c,fs_lib.c,fs_local.h}: Added
	{set,get}maxfprio.

Sat May 23 07:24:22 1998  Assar Westerlund  <assar@sics.se>

	* appl/appl_locl.h: include <sys/param.h>

	* arlad/aix-subr.c: new file

	* arlad/linux-subr.c (conv_dir): got rid of stupid warning

	* arlad/arla.c (arla_cat): check return values from fcache*

	* configure.in: check for h_errno, h_errlist, and h_nerr

	* aclocal.m4: add check-declaration and check-var

Fri May 22 21:34:30 1998  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c (fcache_get): check return value from
 	volcache_getbyid.

Wed May 20 02:56:14 1998  Assar Westerlund  <assar@sics.se>

	* arlad/arla.c: add `--port'

	* getarg.c: fix some of the getarg bugs

Tue May 19 17:18:31 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* xfs/linux: Fixed varous pointer conversions.
	Moved glibc support to the correct place.
	Added random code for debug control syscall.

1998-05-18  Love  <lha@e.kth.se>

	* lwp/process.S: Add linux alpha support

	* xfs/bsd/xfs_syscalls.c: Log to XDEBSYS instead of XDEBMSG

	* include/kafs.h: Added new PIOCTL (50) for VIOC_FPRIOSTATUS
	Added defines and structs for FPRIOSTATUS.

	* conf/arla.conf: Added fpriority, default to 100

	* arlad/messages.c: Added vioc_fpriostatus

	* arlad/inter.c:(log_operation) dont log operations when in
	connected mode.

	* arlad/fcache.c: Added fprioritylevel and made use of it in
	emergency_remove_file() and in cleaner thread.

	* arla/arla_local.h: Added new state of connected_mode,
	CONNECTEDLOG

	* arlad/arla.c: Added fpriority to the conf file

	* appl/fs.c: (getarg) Added {add,remove,get}removepriority, 
	and version.
	(connect) changed fs_connect syntax
	({get,set}crypt) changed fs_*crypt syntax
	({set,get,remove}prio) added calls
	(fserr) moved to fs_lib.c and changed syntax
	(fsversion) print version of fs.c and fs_lib.c
	(afs_getfid) moved to fs_lib
	
	* appl/arlalib.h: Added fs_* prototypes

Sat May 16 11:41:19 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* xfs/linux: Merged in Linux 2.1 support

Sat May 16 06:44:16 1998  Assar Westerlund  <assar@sics.se>

	* xfs/solaris/xfs_vnodeops.c: fix use of VOP_RWLOCK and
 	VOP_RWUNLOCK

	* xfs/aix/bin: add umount_xfs and mount_xfs.

	* xfs/aix/xfs_vfsops.c (xfs_mount): find the device path

	* xfs/aix/xfs_dev.c: init `event_word' to EVENT_NULL

	* xfs/aix/xfs_deb.h: Use uprintf instead of printf to make it
 	possible to see the messages.

Tue May 12 17:29:39 1998  Assar Westerlund  <assar@sics.se>

	* lwp/process.S: grammar fix

Sun May 10 02:25:47 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* xfs/linux/xfs_inodeops.c: Fixed create, mkdir, rmdir, rename
	in 2.1 branch

	* xfs/linux/{xfs_message.c,xfs_inodeops.c}:
	Addded more correct handling of dcache in 2.1 branch

Sat May  9 11:41:10 1998  Assar Westerlund  <assar@sics.se>

	* xfs/solaris/xfs_vnodeops.c: replace VN_HOLD/VN_RELE by
 	VOP_RWLOCk/VOP_RWUNLOCK before calling VOP-funktions in ufs.

	* configure.in: aix

	* xfs/solaris/xfs_message.c (xfs_message_installdata): replace
 	printf by XFSDEB.  Extra ASSERT for rb.

Thu May  7 04:00:30 1998  Assar Westerlund  <assar@sics.se>

	* xfs/aix: new directory

1998-05-06  Assar Westerlund  <assar@sics.se>

	* xfs/solaris/xfs_message.c: try to purge the dnlc once in a while

	* xfs/solaris/xfs_node.c (vattr2xfs_attr): check for AT_TYPE
	(vattr2xfs_attr, xfs_attr2vattr): correct panic string

Tue May  5 10:45:15 1998  Assar Westerlund  <assar@sics.se>

	* ydr/output.c (encode_string): zero-terminate string when
 	decoding.

1998-05-05  Love  <lha@s3.kth.se>

	* configure.in: Check for dbm.

	* arla/arla.c: Added flushfid command in -t mode.

 	* milko/bufcache.{c,h}: Added experimental bufcache.

Sun May  3 04:29:01 1998  Assar Westerlund  <assar@sics.se>

	* xfs/solaris/xfs_vnodeops.c: return ENOSYS instead of EINVAL.
	implement some trivial vnodeops

	* xfs/solaris/xfs_vfsops.c: return ENOSYS instead of EINVAL for
 	non-implemented vfs-operations

Sat May  2 03:00:35 1998  Assar Westerlund  <assar@sics.se>

	* **/Makefile.in: add `DESTDIR' and `uninstall:'

	* arlad/fcache.c: got rid of some stupid warnings
	updated to new volcache root volume stuff

	* arlad/volcache.c: renamed volcache_rootvolume ->
 	volcache_get_rootvolume
	(volcache_set_rootvolume): new function

	* arlad/cred.c (cred_add): remove any old entry before adding the
 	new one.

	* arlad/messages.c: try to handle expiring credentials in lots of
 	places
	(viocgettok): remember to free the cred.

	* arlad/fcache.c (read_data): handle the case of the file not
 	fitting in the cache.
	(getroot): print the errors correctly
	(getacl, setacl, getvolumestatus, setvolumestatus): don't destroy the
	error code

	* arlad/fbuf.c: rename all arguments fbuf -> f to avoid namespace
 	invasion.

	* arlad/bsd-subr.c (conv_dir): get rid of a stupid varning

	* arlad/cred.c (cred_expire): new function

	* arlad/messages.c: try to handle expiring credentials.

Fri May  1 22:20:23 1998  Assar Westerlund  <assar@sics.se>

	* configure.in: call AC_C___ATTRIBUTE__

	* aclocal.m4 (AC_C___ATTRIBUTE__): new macro for testing for
 	`__attribute__'
	(AC_C___FUNCTION__, AC_FUNC_NTOHL): conservative default when
	cross-compiling

1998-04-30  Love  <lha@s3.kth.se>

	* ydr/output.c: No #define FOO_BAR_SIZE 0

	* conf/services.h: No more errormessages...

	* arlad/{fcache.c, arlad.c}: Added --root-vol=root.afs

	* milko/* Added random stuff.

Mon Apr 27 22:11:55 1998  Assar Westerlund  <assar@sics.se>

	* ydr/lex.l: parse more types of #line-lines.
	renamed all tokens to T_FOO

	* lwp/lwp.h: <sys/types.h> and <sys/select.h>

	* lwp/Makefile.in: rs6000.
	try harder preprocessing process.S
	
	* appl/Makefile.in: add AIX_EXTRA_KAFS

	* configure.in: aix

	* aclocal.m4: AC_KRB_SYS_AIX added

Sun Apr 19 15:36:35 1998  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/Makefile.in (vop_defs.h): generate list of vops.  From
 	"Per Boussard, ERA/T/ED" <per@era-t.ericsson.se>

	* xfs/bsd/xfs_locl.h: include vop_defs.h

Sun Apr 19 08:09:43 1998  Assar Westerlund  <assar@sics.se>

	* xfs/openbsd2.3/xfs_vfsops.c (xfs_mount): set `f_files' correctly

	* xfs/bsd/xfs_vfsops.c (xfs_mount): set `f_files' correctly

Wed Apr 15 04:52:27 1998  Robert Burgess  <rb@abc.se>

	* Release 0.5

	* xfs/solaris/xfs_node.c: set blksize/nblocks

Tue Apr 14 23:59:08 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* xfs/linux/xfs_load.c: Changed major number to the newly
 	allocated 103

Tue Apr  7 05:32:26 1998  Robert Burgess  <rb@stacken.kth.se>

	* arlad/fcache.c: Added VIOCSETAL support

	* arlad/messages.c: Moved some checks here from xfs_syscalls.c

Mon Apr  6 05:19:44 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* xfs/linux/xfs_vfsops.c: Added xfs_statfs

	* xfs/linux/xfs_syscalls.c: Merged in new syscall style from bsd

	* arlad/messages.c: Free opaque after use

Sun Apr  5 12:50:56 1998  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_node.c (xfs_dnlc_lookup): print debug output
 	correctly.

	* arlad/cred.c (cred_delete): new function

Sun Apr  5 05:49:27 1998  Robert Burgess  <rb@stacken.kth.se>

	* arlad/fcache.c: Added VIOCGETVOLSTAT/VOLCSETVOLSTAT support
	
Sun Apr  5 05:31:52 1998  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c (truncate_file): decrement usedbytes iff the data
	was cached.

	* arlad/adir.c (adir_mkdir): zero out hash table.

	* arlad/afsdir_check.c: use arla_log

	* arlad/Makefile.in (afsdir_check): link with arladeb.o

Sun Apr  5 01:25:00 1998  Assar Westerlund  <assar@sics.se>

	* ydr/output.c (gendeclare): handle strings

Sat Apr  4 20:39:18 1998  Assar Westerlund  <assar@sics.se>

	* configure.in: add a --disable-mmap

	* aclocal.m4 (AC_HAVE_GETCONF): call AC_CHECK_PROG properly

Sat Apr  4 14:00:06 1998  Assar Westerlund  <assar@sics.se>

	* appl/Makefile.in: link with RXKAD and KAFS in the correct order

Fri Apr  3 09:19:53 1998  Love H-Astrand  <lha@ksk.sala.se>

	* lib/ko/port.[ch]: Moved and added more ports.

Fri Apr  3 05:30:19 1998  Assar Westerlund  <assar@sics.se>

	* lib/ko/koerror.c: const-ize

	* arlad/arla.c: new option `-n'

	* arlad/*.c: rationalize and use new debug levels and functions

	* util/log.c: change LOG_DEBUG -> LOG_INFO

	* util/log.h: add __attribute__

	* arlad/arladeb.c: add new debug levels.
	add arla_{v,}{err,warn}{,x}

Thu Apr  2 05:07:29 1998  Assar Westerlund  <assar@sics.se>

	* configure.in: use AC_STRUCT_SOCKADDR_HAS_SA_LEN

	* aclocal.m4 (AC_STRUCT_SOCKADDR_HAS_SA_LEN): added

	* rx/rx_user.c (GetIFInfo): rewrite so that it actually works.

Tue Mar 31 07:52:39 1998  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_vnodeops.c (xfs_lookup): better debug output for
 	negative caching

	* xfs/bsd/xfs_message.c (xfs_message_installnode): purge the name
 	cache
	(xfs_message_installdata): purge the name cache iff it's a directory

Mon Mar 30 17:45:45 1998  Love Hörnquist-Åstrand  <lha@stacken.kth.se>

	* Added autoconf test for glibc. 
	From: Brad Keryan <keryan@andrew.cmu.edu>

Mon Mar 30 12:01:50 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* xfs/linux/xfs_inodeops.c: added mkdir and rmdir

	* xfs/linux/xfs_inodeops.c: xfs_readdir checks for inode numbers
 	in the name cache

Mon Mar 30 00:27:22 1998  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* aclocal.m4: Autoconf test for getconf, and getconf LFS_{C,LD}FLAGS

Sun Mar 29 14:25:28 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* xfs/linux: Merged in access control from bsd.

	* xfs/linux: Fixed various things. Should work much better.

Sun Mar 29 03:21:39 1998  Assar Westerlund  <assar@sics.se>

	* arlad/arla.c: new option `connected-mode' for setting initial
 	connected mode

	* arlad/fcache.c (do_read_attr, read_data): set anonaccess
	
	* configure.in: remove test for winsock.h.  added test for recvmsg
	and sendmsg.

	* rx/rx_mach.h: cygwin doesn't have SIOCGIFCONF.  From Dan Winship
 	<danw@MIT.EDU>

	* arlad/*.c: Use O_BINARY.  From Dan Winship <danw@mit.edu>

Sat Mar 28 10:34:30 1998  assar westerlund  <assar@sics.se>

	* xfs/bsd/xfs_common.c (install): use DESTDIR

	* arlad/bsd-subr.c (write_dirent): conditionalize on
 	HAVE_STRUCT_DIRENT_D_TYPE

	* configure.in: check for `d_type' in `struct dirent'

Sat Mar 28 10:15:29 1998  Assar Westerlund  <assar@sics.se>

	* aclocal.m4 (AC_HAVE_STRUCT_FIELD): added

1998-03-28  Love Hörnquist-Åstrand  <lha@s3.kth.se>

	* *: USE_MMAPTIME

	* configure.in: Added --enable-mmaptime

	* arlad/{messages,arlad}.c: Added no kerberos fix from
	Dan Winship <danw@mit.edu>

1998-03-27  Love Hornquist-Astrand  <lha@ksk.sala.se>

	* util/mmaptime.[ch]: Added (not working yet)

Fri Mar 27 03:41:45 1998  Assar Westerlund  <assar@sics.se>

	* arlad/arla.c (newwalk): handle symlink followed by more path

	* xfs/bsd/xfs_vnodeops.c (xfs_lookup): enter negative entires in
	name cache when arlad returns ENOENT

	* xfs/bsd/xfs_node.c (xfs_dnlc_lookup): change signature to be
 	more compatible with cache_lookup

	* arlad/arla.c (arla_cat): release lock

Thu Mar 26 02:21:48 1998  Assar Westerlund  <assar@sics.se>

	* Release 0.4

	* lwp/process.S: rhapsody/powerpc
	
	* lwp/Makefile.in: Add powerpc and rhapsody.
	
	* **/Makefile.in: Use KRB_INC_FLAGS
	
	* configure.in, aclocal.m4: Test for krb v5.  From <lxs@mit.edu>

Wed Mar 25 04:26:56 1998  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs_dev.c (xfs_devwrite): return the correct value.
  	also check for bogus size == 0

	* xfs/{linux,sunos,solaris}: update to new style xfs_message.h

	* xfs/bsd/xfs_msg_locl.h: new file

	* xfs/bsd/xfs_wrap.c: do DISPATCH the `correct' way

	* xfs/bsd/xfs_message.c: add `struct proc *p' to xfs_message_*

	* xfs/bsd/xfs_node.c (new_xfs_node): now takes a `struct proc *p'

	* xfs/bsd/xfs_dev.c: add `struct proc *p' to xfs_message_*

	* xfs/bsd/xfs_dev.h: add prototypes for xfs_message_*

	* arlad/messages.c: made all xfs_message_* functions static

	* arlad/messages.h: add proto for xfs_message_receive

	* xfs/include/xfs_message.h: Removed all the prototypes.

	* xfs/bsd/xfs_vnodeops.c: s/EINVAL/EOPNOTSUPP/

	* xfs/bsd/xfs_dev.c (xfs_message_wakeup_data): correct debug
 	output

	* arlad/messages.c(afsrights2xfsrights): change arguments.

	* xfs/linux/xfs_load.c (init_module): don't print
 	xfs_message_installnode, it's static now.

Tue Mar 24 00:24:18 1998  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_vfsops.c (xfs_mount): copy in the arguments.  From
 	Karl Ramm <kcr@mit.edu>.
	
Tue Mar 24 19:53:50 1998  Robert Burgess  <rb@stacken.kth.se>

	* arlad/fcache.c: Added VIOCGETAL support
	
Tue Mar 24 02:03:43 1998  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs_dev.c (xfs_devwrite): fix?

	* arlad/kernel.c: also collect statistics on the number of
 	messages per read

	* arlad/messages.c: more stats

	* arlad/messages.c: count the number of send/recd messages

	* xfs/include/xfs_message.h (XFS_MSG_COUNT): added

	* arlad/*-subr.c (conv_dir): use `fcache_extra_file_name' and do
 	locking correctly.

	* xfs/bsd/xfs_vnodeops.c (xfs_seek): return 0.

	* Makefile.in (configure): ignore errors

	* arlad/arla.c (main): don't malloc and free device_file

	* appl/fs.c: added `getcrypt' and `setcrypt'

	* xfs/bsd/xfs_syscalls.c (xfs_pioctl_call): add
 	VIOC_[GS]ETRXKCRYPT

	* include/kafs.h (VIOC_[GS]ETRXKCRYPT): added

	* arlad/bsd-subr.c (write_dirent): set `d_type'

Sun Mar 22 19:25:18 1998  Assar Westerlund  <assar@sics.se>

	* Release 0.3

	* configure.in: don't clobber CFLAGS

	* xfs/bsd/xfs_syscalls.c (xfs_pioctl_call): use
	`a_followSymlinks'.  Call `suser' instead of == 0

	* arlad/solaris-subr.c: handle the weirdness in the solaris dirent
 	format

	* arlad/afsdir_check.c (check): removed bogus code

	* xfs/solaris: major rewriting and fixing.

Sun Mar 22 02:47:59 1998  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* appl/fs.c,arlad/messages.c,xfs/{bsd,openbsd2.3,linux}:
	Added VIOCCONNECTMODE

Sat Mar 21 15:20:52 1998  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c (read_data, write_data, truncate_file): kill the
 	call if an error occurs.

	* configure.in: tweak CFLAGS and -I/usr/athena

	* arlad/conn.c (conn_get): connected_mode test

	* arlad/volcache.c (volume_uptodatep): look at connected_mode

	* arlad/fcache.c (uptodatep): look at `connected_mode'

	* arlad/arla.c: new option `--debug'

	* arlad/arladeb.c (arla_log_set_level, arla_log_get_level,
 	arla_log_print_levels): new functions

	* arlad/kernel.c (process_message): handle multiple messages

	* xfs/{sunos,solaris,linux}/xfs_dev.c: merge in changes from bsd

	* arlad/messages.c(xfs_send_message_wakeup_multiple): new
 	function.  use it.

	* lwp/iomgr.c: re-wrote the handling of fd_set's

	* xfs/bsd/xfs_dev.c (xfs_devread, xfs_devwrite): implement
 	multiple messages per read/write

Sat Mar 21 06:45:42 1998  Artur Grabowski  <art@squit.stacken.kth.se>

	* doc/* : added a few docs about Arla.

Fri Mar 20 08:19:36 1998  Artur Grabowski  <art@squit.stacken.kth.se>

	* xfs/{openbsd2.3,bsd}/xfs_vfsops.c (xfs_unmount): fix unmounting.

Fri Mar 20 04:30:33 1998  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/xfs_vnodeops.c (xfs_fetch_rights): new function used by
 	`xfs_access'
	(xfs_read, xfs_write, xfs_readdir, xfs_readlink): vop_lock and
	vop_unlock

Thu Mar 19 22:31:20 1998  Assar Westerlund  <assar@sics.se>

	* ydr/output.c (init_generate): change path of rx.h

	* xfs/bsd/xfs_vnodeops.c(xfs_fsync): send correct flags to
 	do_fsync

	* arlad/fbuf.c (mmap_copyrx2fd, malloc_copyrx2fd): check result of
 	ftruncate

	* arlad: moved kerberos includes to arla_local.h

	* include/Makefile.in: remove stds.h, kafs.h add rxkad.h service.h
	
	* **/Makefile.in: remove unused INCLUDES

Thu Mar 19 12:27:47 1998  Love Hörnquist-Åstrand  <lha@s3.kth.se>

	* app/fs/fs.c: 
	(fserr): Implemented and changed on all used use on all places.
	(afs_getfid): Added VIOCGETFID
	(quit_cmd): use return instead of exit();

Wed Mar 18 21:52:31 1998  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c (create_directory): create the directory locally
 	instead of fetching it from the file server

	* arlad/adir.c (dir_mkdir): new function

	* arlad/fcache.c (stale): don't bother if the callback is already
 	dropped

Wed Mar 18 10:58:44 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* xfs/linux/xfs_vfsops.c: Added xfs_write_inode

	* xfs/linux/xfs_inodeops.c: Added permission checking and write support

Wed Mar 18 03:11:51 1998  Artur Grabowski  <art@squit.stacken.kth.se>

	* xfs/{openbsd2.3,bsd}/{xfs_fs.h,xfs_node.c}: xfs_has_pag implemented.

	* xfs/{openbsd2.3,bsd}/xfs_node.c (new_xfs_node): set anonrights.

	* xfs/openbsd2.3/xfs_vfsops.c: small fix to {un,}installation.

	* xfs/{openbsd2.3,bsd}/xfs_vnodeops.c
	(xfs_access): implement correctly

	* xfs/{openbsd2.3,bsd}/xfs_node.h: add an anonrights field to
	xfs_node.

	* xfs/{openbsd2.3,bsd}/xfs_message.c
	(xfs_message_installattr, xfs_message_installdata): set anonrights.

	* xfs/include/xfs_message.h: add anonrights, change id from u_int
	to pag_t, add masks for rights.

	* arlad/messages.c
	(afsrights2xfsrights): implement.
	(fcacheentry2xfsnode): add handling of access rights.
	(most functions): access rights handling with changed cm_attr.

	* arlad/inter.c
	(getrights): correct implementation.
	(checkright): correct implementation.
	(cm_getattr): handling of access rights.

	* arlad/fcache.c
	(create_new_entries): initialize acccache.
	(recover_state): Do not recover rights.
	(findaccess): pag 0 doesn't mean that it's unauthorized.

	* ChangeLog: updated.

Tue Mar 17 06:05:26 1998  Artur Grabowski  <art@squit.stacken.kth.se>

	* lwp/iomgr.c: some speed optimizations on selecting.

Tue Mar 17 03:09:56 1998  Love Hornquist-Astrand  <lha@foo.ksk.sala.se>

	* Make arlad /dev/xfs0 working again.

	* lib/ko/koerror.c: Fallback on strerror().

	* xfs/bsd/{xfs_dev.c,xfs_vnodeops.c,xfs_locl.h}: Started to
	use #ifdef HAVE_VOP_FOO for everything.

	* xfs/bsd/xfs_dev.c: NetBSD 1.3 and OpenBSD 2.2 doesn't have
	vop_{get,put}pages_desc.

Tue Mar 17 01:24:55 1998  Assar Westerlund  <assar@sics.se>

	* xfs/*: moved xfs/*.h to .

	* xfs/bsd/xfs_vnodeops.c: fixed vop_t

	* xfs/solaris/Makefile.in: renamed xfs.mod -> xfs

	* lwp/Makefile.in: check if the compiler is gcc not if it's called
 	gcc

	* **: renames lots of `errno' to `error'

	* xfs/linux/Makefile.in: include KRB_INC_DIR last

Mon Mar 16 21:38:06 1998  Artur Grabowski  <art@squit.stacken.kth.se>

	* lwp/process.S: close a comment and let lwp work on ppc. (reported
	to work)

Mon Mar 16 20:55:52 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* xfs/linux/xfs_inodeops.c: Fixed bug in xfs_readdir

Mon Mar 16 02:54:53 1998  Assar Westerlund  <assar@sics.se>

 	* Release 0.2

	* NEWS, THANKS: new files.

	* include/Makefile.in: add parse_units.h and resolve.h

Sun Mar 15 00:56:47 1998  Assar Westerlund  <assar@sics.se>

	* arlad/volcache.c (volume_uptodatep): new function
	(recover_state): don't mark recovered volumes as valid

	* xfs/sunos/xfs_vnodeops.c (xfs_inactive): use the flag field on
 	the inactivenode message

	* xfs/solaris/xfs_vnodeops.c (xfs_inactive): use the flag field on
 	the inactivenode message

	* xfs/openbsd2.3/xfs_vnodeops.c (xfs_reclaim): use the flag field
 	on the inactivenode message

	* xfs/linux/xfs_vfsops.c (xfs_put_inode): set flag in inactivenode
 	message

	* xfs/include/xfs_message.h (xfs_message_inactivenode): new `flag'
 	field

	* xfs/bsd/xfs_vnodeops.c (xfs_close): only call `do_fsync' if the
 	file was oppened for writing and was actually changed.
	(xfs_inactive): send an inactivenode message
	(xfs_reclaim): use the correct flag on the inactivenode message

	* arlad/messages.c (xfs_message_inactive): look at the flags
	(xfs_message_create & c:o): use the correct realfid

	* arlad/inter.c: update to new FCacheEntry

	* arlad/fcache.c (throw_entry): only give up a callback if we have
 	any.
	(recover_state): init `count'
	(fcache_stale_entry): call stale iff flags.kernelp
	(fcache_get_data): don't get data if the shows that it hasn't changed.

	* arlad/fcache.h (FCacheEntry): remove `nreaders' and `nwriters'.
  	add `flags.kernelp'

	* arlad/adir.c (create_new_page): return page1
	(add_to_page): only loop till ENTRIESPERPAGE - 2
	(adir_creat): don't use status.Length, it might already have been
	increased by the file server.  more and more correct checks.

	* appl/vos.c (printvolstat): const-ized

	* appl/arlalib.h: const-ized

	* appl/arlalib.c: const-ized

Sat Mar 14 14:39:25 1998  Assar Westerlund  <assar@sics.se>

	* include/Makefile.in: add err.h

	* rx/rx_pkt.[ch]: don't assume sizeof(void) == 1

Sat Mar 14 14:08:02 1998  Assar Westerlund  <assar@sics.se>

	* arlad/cmcb.c (RXAFSCB_CallBack): remove warning message

	* arlad/{ports,arla,messages}.c: no \n to arla_log

	* rxkad/rxk_locl.c (rxkad_check_packet): kludge around.

	* README: update installation instructions

	* arlad/arla.c: add options for rxkad_level and device.

Sat Mar 14 13:56:55 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* arlad/Makefile.in: Added libko dependencies in arlad

Fri Mar 13 05:06:37 1998  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs_inodeops.c (xfs_readlink): call `set_fs'

	* xfs/bsd/xfs_vnodeops.c (do_fsync): reset the XFS_DATA_DIRTY flag
	(xfs_remove): remove the name from the dnlc
	(xfs_mmap, xfs_bmap, xfs_getpages, xfs_putpages): dummy functions

	* xfs/bsd/xfs_message.c: spell-check the printfs

	* util/fnameutil.[ch]: rename {base,dir}name to copy_\1name

	* rxdef/pts.xg: fix broken declarations

	* include/Makefile.in: add getarg.h

	* arlad/volcache.h (volcacheentry): add `validp'

	* arlad/volcache.c: change `freelist' to be a `lrulist'
	(recover_state, volcache_store_state): new functions
	(volcache_invalidate): new function

	* arlad/inter.c (cm_init,cm_store_state,log_operation): new
 	functions
	(*): call log_operation
	(*): const-ized some arguments

	* arlad/fcache.h: update prototypes

	* arlad/fcache.c (fcache_store_state,recover_state): new functions
	(fcache_init): don't create cachedir. try to recover state.
	(*): return ENETDOWN if findconn fails
	(do_read_attr): throw data if DataVersion has changed
	(truncate_file): use O_CREAT
	(create_file): create a empty cache file
	(*): const-ized some arguments
	(fcache_get_data): DTRT

	* arlad/cmcb.c (RXAFSCB_CallBack): handle volume callbacks.

	* arlad/arladeb.h: add ADEBVOLCACHE and ADEBCM

	* arlad/arla.c (newwalk): return int.  change callers.  handle
 	signals by storing state
	(main): use getarg. chdir to cachedir before initializing

	* configure.in: fix sys/dir.h and dirent.h test.
	call AC_KRB_VERSION

	* aclocal.m4 (AC_KRB_VERSION): new macro

	* TODO: update

Thu Mar 12 15:22:50 1998  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* configure.in,aclocal.m4,acconfig.h,lib/roken/resolve.c: 
	Added HAVE__RES

	* configure.in, aclocal.m4: Added tests for krb-libs,and includes.

Thu Mar  5 22:20:54 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* xfs/linux/xfs_inodeops.c: More correct error handling
	and -Wall pleasing.

Thu Mar  7 05:50:10 1998  Love Hörnquist-Åstrand  <lha@s3.kth.se>

	* rxdef/pts.xg: Added broken xg def.

Wed Mar  4 03:23:19 1998  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* arla/*.c: Added arla_log and started to used.

	* util/log.c: Added log_vlog.

	* arlad/messages.c: Moved vicofluchvolume outsize #ifdef KERBEROS
 	and added stub for VIOCGETAL.

Tue Mar  3 21:16:06 1998  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* xfs/linux/xfs_inodeops.c: fixes memoryleak and xfs_readdir()
	on linux != sparc. from amu@mit.edu (Aaron M. Ucko)

Tue Mar  3 00:00:55 1998  Assar Westerlund  <assar@sics.se>

	* arlad/inter.c (cm_lookup): const-ized parameters

	* xfs/{sunos,solaris}/{,bin/}Makefile.in: set exec_prefix
	(install): removed '-m 444'

	* rxdef/volumeserver.xg: remove stds.h

	* lib/{ko,tl}/Makefile.in (install): removed '-m 444'

	* arlad/arla.c (newwalk): follow symlinks
	(main): try harder getting kerberos credentials

	* appl/appl_locl.h: include <atypes.h>

Mon Mar  2 13:32:42 1998  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* appl/vos.c: Vos exa now uses libko/kocell.

	* lib/ko/kocell.c: Moved from arlad/cell.c, and turned
	arlad/cell.c to a dummy.

	* configure.in,include/stds.h.in: Added autoconf test 
	for krb_principal

	* Made a bunch of links to include/ from all .h files
	to make the compile lines more sane.

	* arla/{fcache.c,volcache.c} Added use of libkoerror.

Mon Mar  2 01:00:09 1998  Johan Danielsson  <joda@emma.pdc.kth.se>

	* arlad/bsd-subr.c: Horrible hack for DEC Unix.

Sun Mar  1 06:42:00 1998  Assar Westerlund  <assar@sics.se>

	* Release 0.1

	* arlad/fcache.c (do_read_attr): invalidate data if we have it
 	cached and DataVersion has changed.

	* xfs/bsd/xfs_node.c (new_xfs_node): postpone vget-ing

	* xfs/bsd/bin/Makefile.in: set PROGS and clean properly

	* xfs/bsd/xfs_message.c (xfs_message_isntallnode): more debug

	* xfs/bsd/Makefile.in (doclean): clean properly
	(CFLAGS): remove Wall (it is set by configure)

	* rx/rx.h: remove stupid includes

	* conf/Makefile.in: don't overwrite existing configuration files

	* configure.in: remove unused tests

	* xfs/bsd/xfs_message.c (xfs_message_installdata): don't
 	VOP_UNLOCK unlocked vnode.

	* util/list.c: more paranoia

	* arlad/bsd-subr.c (conv_dir): free buf

	* arlad/adir.c (adir_readdir): do `.' and `..'-magic correctly.

Fri Feb 27 23:37:39 1998  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c: better error reports when rx calls fail.

Fri Feb 27 07:09:08 1998  Artur Grabowski  <art@squit.stacken.kth.se>

	* arlad/*-subr.c: truncate files when opening a dircache file.

Fri Feb 27 04:56:58 1998  Artur Grabowski  <art@squit.stacken.kth.se>

	* arlad/arladeb.h: ADEBFCACHE added
	
	* arlad/fcache.c: don't break dead xfs-callbacks.
	
	* arlad/adir.c: put '.' and '..' in front of a readdir. Some systems
	seem to like it that way.

Thu Feb 26 01:30:44 1998  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* arlad/fcache.c,messages.c: VIOC_FLUSHVOLUME

	* Now semiworking (no good parsing) vos listvol, it was a feature
 	in ydr.

	* ydr/output.c: 
	  - long -> int32 fix
	  - Fix for use of temporary variables.

Mon Feb 23 06:38:18 1998  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* xfs/bsd/xfs_syscalls.c: Merged in changes from obsd23.

	* lib/roken/roken.h: ssize_t added.

	* lib/roken/roken.h: sunos select fix.

	* lib/roken/roken.h,acconfig.h, configure.in: sunos select fix.

	* VIOC_VENUSLOG: Almost.

Mon Feb 23 01:17:43 1998  Artur Grabowski  <art@stacken.kth.se>

	* xfs/openbsd2.3: (xfs_pioctl) cleanup and VIOCSETCACHE

	* arlad/messages.c, fcache.c: VIOCSETCACHE

Mon Feb 23 02:10:51 1998  Assar Westerlund  <assar@sics.se>

	* Release 0.0

	* arlad/arla.c (main): try to get tokens for the local cell.

	* appl/appl_locl.h: include rxkad.h iff KERBEROS

	* arlad/fcache.c (read_data): make sure we never go over
 	`highbytes'

	* lwp/Makefile.in: add hpux

	* configure.in: add hpux

	* rx/rx_pkt.c(rxi_ReadPacket): fix from <per@era-t.ericsson.se>
 	for handling strange packets.

	* rxdef/vldb.xg: MAXNAMELEN -> VLDB_MAXNAMELEN

	* rx/rx_locl.h: include <atypes.h>

	* lib/ko/ko.h: include <atypes.h>

	* arlad/messages.c: always include <kafs.h>

	* arlad/arla.c: made `conf_params' static to make it initable.

	* arlad/Makefile.in: coompatible with stupid make

	* appl/Makefile.in: use KAFS_LIBS

	* configure.in: set KAFS_LIBS

	* arlad/arla.c: allow setting of low and high-water marks.

	* configure.in: test if strtok_r needs a prototype

	* rxdef/Makefile.in: remove new junk files

	* ydr/main.c: changed the way of running cpp :-(

Mon Feb 23 05:55:54 1998  Artur Grabowski  <art@squit.stacken.kth.se>

	* xfs/openbsd2.3: (xfs_pioctl) cleanup and VIOCSETCACHE

	* arlad/messages.c, fcache.c: VIOCSETCACHE

	* appl/fs.c: setcachesize implmeneted.

	* arlad/arla.c: Added reading of a configuration file. 

Sun Feb 22 20:51:47 1998  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* xfs/bsd/xfs_vnodeops.c(xfs_link): Added OpenBSD and NetBSD 
	compability

	* configure.in, include/stds.h, rxkad/rxkad.h: Added test for
	{,u_}int32, and added those for rxkad.

	* appl/vos.c: Fixing listpart, but the total is still wrong.

	* appl/vos.c: Added libko to parts of vos.c

	* lib/ko: Added libko, vlserver, volserver and rxkad errorcodes
	and messages.

Sun Feb 22 15:59:30 1998  Assar Westerlund  <assar@sics.se>

	* arlad/volcache.c (print_entry): print every volume only once.

Sun Feb 22 15:23:31 1998  Johan Danielsson  <joda@emma.pdc.kth.se>

	* lwp/iomgr.c (struct IoRequest): add `next' pointer instead of
 	bogus use of `result'.

	* lwp/lwp.c: Include <string.h>, replace "0x%x" with "%p".

	* rx/*: Use rx_locl.h
	  - replace bcopy with memcpy
	  - remove `register'
	  - change long -> int32
	  - don't depend on sizeof(whatever) being correct

	* rx/rx_user.c: Clean up osi_Panic.

	* rx/rx_pkt.c: Cleanup rx_Slow{Read,Write}Packet.

	* appl/vos.c: htonl(vlentry.serverNumber)

Sun Feb 22 06:10:55 1998  Assar Westerlund  <assar@sics.se>

	* ydr/lex.l (yywrap): conditionalize

Sun Feb 22 01:11:17 1998  Assar Westerlund  <assar@sics.se>

	* arlad/messages.c (xfs_message_pioctl): implement VIOCGETTOK

	* xfs/bsd/xfs_syscalls.c (xfs_pioctl_call): implement `VIOCGETTOK'

	* rxkad: updated to a more modern version.

	* xfs/bsd/xfs_vnodeops.c (xfs_link, xfs_rename): implement

	* arlad/messages.c (xfs_message_link, xfs_message_rename):
 	implement

	* arlad/inter.c (cm_link, cm_rename): new functions

	* arlad/fcache.c (create_link, rename_file): new functions
	all functions are now careful not to use any OUT parameters from
 	rpc's that fail.

	* xfs/bsd/xfs_node.c (xfs_node_find): cleaner

	* arlad/fbuf.c: re-did the fbuf-interface

	* arlad/bsd-subr.c (write_dirent): do special for ".." iff
 	flags.mountp

	* arlad/volcache.c (recycle_entry): removed a bogus `hashtabdel'

	* rx/rx_pkt.c (rxi_ReadPacket): case `RX_HEADER_SIZE' to int when
 	comparing again `nbytes', otherwise we lose :-(

	* xfs/bsd/xfs_node.c (xfs_node_find): a dead vnode might still be
 	on the mount-list, check for that.

Sat Feb 21 23:14:47 Love Hornquist-Astrand  <lha@foo.ksk.sala.se>

	* arlad/adir.c(adir_remove): Use length when deleting a entry 
	in a afsdir.

	* arlad/fcache.c: Return ENOMEM when not finding a cred for the
	new cell (this should never fail, we should allways be able to find a
	 rx_null cred.)

	* xfs/bsd/xfs_vnodeops.c: Define xfs_vop_t for Open|NetBSD for
	typecasting --> getting less errors.

	* arlad/fcache.c: Use CRED_ANY when we hit a remote cell,
	and doesn't find a "native" cred.

Sat Feb 21 18:14:47 1998  Assar Westerlund  <assar@sics.se>

	* arlad/messages.c (xfs_message_symlink): new function

	* arlad/inter.c (cm_symlink): new function

	* arlad/fcache.c (create_symlink): new function

	* xfs/bsd/xfs_vnodeops.c (xfs_symlink): implement

	* xfs/bsd/xfs_vnodeops.c (xfs_lookup): more SAVENAME voodoo
	(xfs_remove, xfs_rmdir, xfs_abortop): implement functions

	* arlad/messages.c (xfs_message_mkdir, xfs_message_rmdir): new
 	functions

	* arlad/inter.c (cm_mkdir, cm_rmdir): new functions

	* arlad/fcache.c (create_directory, remove_file,
 	remove_directory): new files

	* arlad/afsdir_check.c: more paranoid tests

	* arlad/adir.c: squash some almost fence-post bugs.

	* xfs/include/xfs_message.h (xfs_message_remove): added cred

	* arlad/afs_dir.h: start using sized types

	* arlad/messages.c (xfs_message_create): convert and push down the
 	updated directory

	* arlad/inter.c (cm_create): create the file in the local cached
 	copy of the directory.

	* arlad/fbuf.c: re-organized.
	(truncatefilebuffer): new function

	* arlad/adir.c (adir_lookup): test to see that `dir' is a
 	directory.
	(adir_readdir): dito
	(adir_creat): new function for adding an entry to a directory.
	(aidr_remove): new function for removing an entry from a directory.

	* arald/afsdir_check.c: new program

Sat Feb 21 16:00:00  Love Hornquist-Astrand  <lha@foo.ksk.sala.se>

	* arlad/arla.c, rx/r.c: Added rx-status.

Fri Feb 20 09:32:52 1998  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c: return better error codes than ENODEV (except in
 	two cases)

Thu Feb 19 23:17:25 1998  Love Hornquist-Astrand  <lha@foo.ksk.sala.se>

	* xfs/bsd/xfs_syscalls.c, arlad/messages.c: Added VIOC_GET_WS_CELL.

	* xfs/include/xfs_messages.h: Added handle to pioctl msg.

Thu Feb 19 02:47:52 1998  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* xfs/bsd/syscalls.c, arlad/message.c: VIOC_FILE_CELL_NAME.

	* xfs/bsd/xfs_vnodeops.c(xfs_mkdir): Send right message and 
	save us a panic

	* include/kafs.h: Added more pioctl calls.

	* appl/vos.c: Added to option to query a specific server in vos exa
	and added options -host, -cell and -noauth.

	* arlad/arla.c: begining for sysname in -t mode.

	* arlad/cell.c: Ask diffrent vldb-server each time.

Thu Feb 19 06:05:43 1998  Assar Westerlund  <assar@sics.se>

	* include/kafs.h: added

	* arlad/fcache.c: re-wrote

	* arlad/volcache.c: re-wrote

	* arlad/messages.c (VIOC_AFS_SYSNAME): remove
	(afsstatus2xfs_attr): fix
	(xfs_message_*): updated

	* arlad/inter.c (getrights, checkright): commented out, I didn't
 	bother to fix them now.
	(cm_lookup): add test for `@sys'
	(cm_remove, cm_link): commented out

	* arlad/fbuf.c: remove #undef HAVE_MMAP and make the code compile.

	* arlad/conn.c: re-wrote

	* arlad/cred.c: re-wrote

	* arlad/cmcb.c (RXAFSCB_InitCallBackState): do something

	* arlad/cell.c: rename all functions to cell_
	(cell_num2name): new function
	fix fopen format strings
	removed all locks (sorry Love)

	* arlad/arla.c: Use `tmpce'
	(arla_{conn,vol,cred,fcache}_status): new functions

	* arlad/adir.c (adir_lookup): update to new fcache-interface.  use
 	CredCacheEntry.  don't handle @sys
	(adir_readdir): update to new fcache-interface.  use CredCacheEntry

	* ydr/output.c: add copyright
	(gen1): make TIN arguments `const'

	* xfs/bsd/Makefile.in (CFLAGS): add `-Wno-unused'

	* xfs/bsd/xfs_node.c (xfs_attr2vattr): set `va_blocksize' to a
 	reasonable value.

	* util/hash.c (hashtabnew): check malloc return value at correct
 	place.

	* arlad/Makefile.in: more includes link with libraries in correct
 	order

	* makesnap: don't hardcode cvsbin and CVSROOT

Thu Feb 12 01:38:21 1998  Assar Westerlund  <assar@sics.se>

	* ydr/output.c: include rx.h

	* ydr/main.c: does it have to be this hairy to run a simple cpp
 	portably?

	* xfs/solaris/xfs_node.c (new_xfs_node): use correct set of
 	attributes

	* xfs/include/xfs_message.h: moved xfs_msg_node and related
 	defintions here from xfs/*/xfs/xfs_node.h

	* lwp/q.c: renamed {ins,rem}que to lwp_\1

	* arlad/irix-subr.c: new file

	* aclocal.m4: stolen BASH_CHECK_DEV_FD from bash

	* configure.in: Add testing for /dev/fd.
	correct gcc test.
	stub support for irix.

Wed Feb 11 02:18:51 1998  Assar Westerlund  <assar@sics.se>

	* lib/roken/{snprintf.c,mini_inetd.c,getarg.c}: merged in newer
 	code.

	* configure.in: moved util and ydr from subdirs to AC_OUTPUT

1998-02-10  Per Andersson  <ppan@joker.cntw.com>

	* INSTALL: Changed sunos(4) instructions to match current version

Tue Feb 10 02:52:51 1998  Assar Westerlund  <assar@sics.se>

	* lwp: renamed process.s -> process.S

	* aclocal.m4(AC_GROK_TYPE): test for ktypes.h

	* xfs/sunos/Makefile.in: rewrote and vpath-ed.

	* xfs/sunos: updated to changes elsewhere.

	* arlad/arla_local.h: use <dirent.h> xor <sys/dir.h>

	* arlad/afs_dir.h: rename PAGESIZE -> AFS_PAGESIZE

	* include/bits.c: test for ktypes.h

	* configure.in: test for ktypes.h

	* include/{bits.c,Makefile.in}: generate atypes.h

	* xfs/solaris: new directory

	* arlad/solaris-subr.c: new file

	* ydr/lex.l: handle more kinds of #-lines

	* rxkad/Makefile.in: work-around for stupid solaris make

	* rxdef/Makefile.in: remove BSD/GNU-special and use explicit rules
 	instead.

	* rx/Makefile.in: work-around for stupid solaris make

	* lwp/iomgr.c: add <fcntl.h>

	* lwp/Makefile.in: more magic for preprocessing and assembling
 	process.s

	* arlad/sunos-subr.c (fcacheentry2xfsnode, conv_dir): update to
 	new signatures

	* arlad/conn.c (markasdown): don't initialize `d' in declaration

	* Makefile.in: add include to SUBDIRS

	* configure.in: replace @CANONICAL_HOST@
	add solaris
	check for -lsocket, -lnsl and -lresolv
	generate Makefile in include
	
Tue Feb  3 16:16:42 1998  Love Hörnquist-Åstrand  <lha@e.kth.se>

	* util/hash.c(hashjpw): Some typecasting to save the world.

	* lib/roken/snprint.c: Removed #if 0

	* configure.in: Added check for gcc and -Wall

Fri Jan 30 19:58:51 1998  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* arlad/{conn.c,fcache.c,volcache.c}: Fixed conn locking.

Wed Jan 28 05:43:44 1998  Artur Grabowski  <art@stacken.kth.se>

	* Cleaned up most of the warnings in arlad, lwp, rx* and some other
	  small things.

	* lwp: ANSI-prototypes.

	* rx: ANSI-prototypes. Indentation, cleanup

Wed Jan 28 01:00:00 1998 Niklas Hallqvist <nh@stacken.kth.se>

	* BSDmake compatibility

	* Build from local libsl
	
Thu Jan 22 22:13:57 1998  Magnus Holmberg  <mho@stacken.kth.se>

	* xfs/include/xfs_message.h: Argh! Whoever came up with the bright
 	idea of having userland xfs_message_receive() and kernel
 	xfs_message_receive() have the same name and share the same
 	prototype?

	* xfs/include/xfs_message.h, configure.in, acconfig.h:
	Gross hack to support both old and new VFS.

Wed Jan 21 12:52:44 1998  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs_inodeops.c (xfs_close): use XFS_{READ,WRITE}

	* xfs/bsd/xfs_vnodeops.c (xfs_close): use XFS_{READ,WRITE}.
  	always call cm_close, independent of the dirty flag.  arlad needs
 	to now how many processes have this file open.

	* arlad/inter.c(cm_close): use XFS_READ & c:o

	* xfs/include/xfs_message.h: introduced flags:
 	XFS_{READ,WRITE,...}

Wed Jan 21 03:54:15 1998  Magnus Holmberg  <mho@stacken.kth.se>

	* xfs/openbsd2.3:
		VFS Lite2 changes.
		Merged from .../xfs/bsd.
		-Wall.

Mon Jan 19 03:30:53 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* arlad/*-subr.c, arlad/messages.c: Merged xfs_attr stuff into messages.c

	* Changed linux xfs to use xfs_attr and changed everything to include
	xfs/include/xfs_message.h

Mon Jan 19 04:46:36 1998  Assar Westerlund  <assar@sics.se>

	* xfs/include/xfs_message.h: add ID. remove old junk

	* xfs/include/xfs_attr.h (XA_SET_*): Use correct field name.
	(xfs_file_type): fix typo

	* xfs/bsd/xfs_node.c (vattr2xfs_attr, xfs_attr2vattr): new
 	functions

Sun Jan 18 12:19:26 1998  Assar Westerlund  <assar@sics.se>

	* xfs/bsd/Makefile.in (MODULE): use `mv -f'
	(unload): correct symbol is `xfs_mod'

	* arlad/fcache.c (writefile): don't send the length of data in the
 	stream.
	
Sun Jan 18 23:57:11 1998  Love H-Åstrand <lha@foo.ksk.sala.se>

	* xfs/bsd/bin/startarla.in: a startscript, using autoconf.

	* xfs/bsd/xfs_dev.c(xfs_devclose): Make sure we dont unmount a
	not mounted filesystem.
	
Sun Jan 18 12:19:26 1998  Assar Westerlund  <assar@sics.se>

	* arlad/conn.c (getconnection): restructured.  Make all
 	unauthenticated connections with cred == 0.  Try to add an
 	unauthenticated connection at the same time as a authenticated
 	one.  This is used when receiving and breaking callbacks.

	* arlad/conn.h (ConnCacheEntry): add `securityclass'

	* xfs/bsd/bin/mount_xfs.c: DTRT with __progname and err*

	* xfs/bsd/Makefile.in (unload): use modunload

	* arlad/*-subr.c: no need to specify cachedir.

	* arlad/fcache.c: allow specification of cachedir

	* arlad/arla.c (main): specify cachedir when calling initfcache

	* Makefile.in: clean and simplify

	* xfs/bsd/xfs_dev.c: use = instead of bcopy

Sun Jan 18 15:14:58 CET 1998  Love H-Åstrand <lha@foo.ksk.sala.se>

	* Added configure option --with-arlacachedir

Sun Jan 18 01:20:45 1998  Love H-Åstrand <lha@foo.ksk.sala.se>

	* arla/cafe-au-lait.c: Added new file.

	* Added target install and made arla/cell.c use prefix for
	CellServDB and ThisCell.
	
	* xfs/bsd/xfs_dev.c(xfs_uninstall_device): Fixed unload bug for
	net|open-bsd

	* xfs/bsd/xfs_vfs_ops.c: Fixed kernel panic for net|openbsd, 
	it may work now. Tried to fix it for freebsd too.

Thu Jan 15 23:24:52 1998  Magnus Holmberg  <mho@stacken.kth.se>

	* xfs/openbsd2.3/xfs_vnodeops.c: Fixed arguments to vnode
 	functions to match new vfs.

Thu Jan 15 06:10:37 1998  Assar Westerlund  <assar@sics.se>

	* configure.in: test for symorder.  use xfs/bsd

	* xfs/bsd: new unified bsd xfs-module

Thu Jan 15 01:14:35 1998  Love Hornquist-Astrand  <lha@foo.ksk.sala.se>

	* xfs/openbsd/xfs_vnodeops.c: Added use of XFS_ANONYMOUSID when we
	dont have a cred. Setting pag_t.pag to 0 is a bad idea, since we
	use uid when the user doesn't have a pag...

Thu Jan 15 00:52:16 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* xfs/linux/xfs_vfsops.c: Made xfs_put_inode tell arla when an
 	inode goes inactive

	* arlad/fcache.c: Hopefully more correct locking

Tue Jan 13 23:10:03 1998  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c (openfile): changed to return error and fd as
 	parameter.

	* arlad/Makefile.in: use @LIB_readline@

	* configure.in: stolen editline-tests from krb4

	* aclocal.m4: stolen AC_FIND_FUNC_NO_LIBS from krb4

	* arlad/arla.c: junked lots of old code. 
	wrote a new simple command-line mode for `-t'.

	* arlad/cmcb.c (RXAFSCB_Probe, RXAFSCB_InitCallBackState,
 	RXAFSCB_CallBack): print the IP-address

	* arlad/Makefile.in: renamed arla -> arlad. 
	link with sl and related libraries

	* configure.in: make sure we have a working version of autoconf
 	don't create any xfs-makefiles if we have a unsupported OS

1998-01-13  Per Andersson  <ppan@joker.cntw.com>

	* Arladaemons name changed to 'arlad' in INSTALL

Tue Jan 13 19:23:10 1998  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* Added sl and editline

	* Added pag support for net/open-bsd

	* Added libroken

Mon Jan 12 23:12:15 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* arlad/messages.c,xfs/{linux,openbsd,freebsd}:
	Moved to pag authentication, added set sysname,
	added set pag in linux

Mon Jan 12 00:59:55 1998  Magnus Ahltorp  <magnus@dike.aladdin.se>

	* xfs/linux/xfs_syscalls.c: Added set pag.

Sun Jan 11 05:14:44 1998  Assar Westerlund  <assar@sics.se>

	* rxkad/rxk_crpt.c: resurrect bswap and conditionalize it on
 	EFF_NTOHL

	* configure.in: use AC_FUNC_NTOHL

	* aclocal.m4 (AC_FUNC_NTOHL): new macro

	* ydr: added support for the 'multi' keyword

Sun Jan 11 00:19:46 1998  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* xfs/openbsd/xfs_locl.h: Added prototype for xfs_get_pag and
 	added som include files (removed those include files all over)

	* xfs/openbsd/xfs_vfsops.c: Added the type of fs to the
 	mp->mnt_stat struct

	* xfs/openbsd/xfs_syscalls.c: Added pag support

	* xfs/openbsd/xdeb.h: Added XDEBSYS

	* xfs/openbsd/xfs_dev.c(xfs_devclose): Lock the mointpoint when 
	freeing the xfsnodes

Sat Jan 10 04:21:31 1998  Assar Westerlund  <assar@sics.se>

	* arlad/{bsd,linux,sunos}-subr.c (conv_dir): don't ReleaseReadLock

	* arlad/fcache.c: allow reuse of the cache files

	* arlad/messages.c (xfs_message_getroot): use `cm_getattr'

	* arlad/inter.c (cm_getattr): return real_fid as a parameter.

	* arla/thash.[ch], arla/vlstr.h: removed.

	* ydr/output.c (generate_server_switch): write prototype to header
 	file.

	* lwp/Makefile.in: add mips/irix

	* arlad/volcache.c: clean-up:
	cell -> int32_t
	const-ize
	
	* arlad/ports.c (initports): use the official IANA names and
 	enable the code.

	* arlad/{linux,sunos,bsd}-subr.c (write_dirent): const-ize

	* arlad/conn.c: all cells are int32_t

	* arlad/cell.c: all cells are int32_t

	* arlad/cmcb.c: clean-up

	* arlad/adir.c (afs_lookup): return int.  removed old code.
  	clean-up.

	* lwp/Makefile.in: fix ranlib

	* arlad/cell.c: restructured a tiny bit and added some (void)

	* arlad/fcache.c (getroot): return error code.  changed all callers.

	* arlad/kernel.c: `struct fd_set' should be `fd_set'

	* include/config.h.in: removed

	* xfs/openbsd2.3/xfs_vfsops.c (xfs_mount): replaced VOP_UNLOCK by
 	vput

	* xfs/openbsd/xfs_vfsops.c (xfs_mount): do vput instead of
 	VOP_UNLOCK.

Fri Jan  9 21:32:54 1998  Assar Westerlund  <assar@sics.se>

	* configure.in: test for header files used by fs

Fri Jan  9 20:55:05 1998  Robert Burgess  <rb@bobby.stacken.kth.se>

	* appl/fs.{c,h}: added

Fri Jan  9 18:29:28 1998  Assar Westerlund  <assar@sics.se>

	* xfs/*/xfs/xfs_node.h: define xfs_attr

	* xfs/linux/xfs/attr.h: xfs_attr must be a type and not a struct.

	* bin/umount_xfs.c: does not work.  replaced with the
 	openbsd-version.

	* arlad/kernel.c: new file with generic kernel interface code.

	* arlad/{bsd,sunos,linux}-subr.c: OS-specific functions
	
	* arlad/messages.c: new file with the generic message code.
	
	* conf/CellServDB: A recent version.
	
Fri Jan  9 17:23:08 1998  Love H-Astrand  <lha@ksk.sala.se>

	* Added milko/aefs: Added Äckligt fs, and cleaned up

	* configure: Removed

Fri Jan  9 17:25:21 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* arlad/linux-messages.c: getattr and creds fixed

Fri Jan  9 13:53:50 1998  Artur Grabowski  <art@squit.stacken.kth.se>

	* xfs/openbsd: cleanup

	* xfs/openbsd: add flags to free_all_xfs_nodes to allow forced unmount

Fri Jan  9 12:17:20 1998  Artur Grabowski  <art@squit.stacken.kth.se>

	* Made the definite move of mount_xfs and other binaries into
	xfs/@sys/bin

Fri Jan  9 05:23:13 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* arlad/adir.c: Moved pointer dereference to after initialization
 	of the pointer

1998-01-08  Per Andersson  <ppan@joker.cntw.com>

	* Added very preliminary installation instructions in ./INSTALL

Thu Jan  8 11:05:40 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* arlad/fbuf.c: Truncate file before close

	* arlad/inter.c, arlad/fcache.c: Made cm_lookup handle EACCES

Thu Jan  8 03:28:55 1998  Assar Westerlund  <assar@sics.se>

	* arlad/fcache.c: changed getfile and getattr to return an error
	code.  fixed all callers.

	* lwp/preempt.c: ifdef SA_NODEFER

	* ydr/lex.l: always print error messages with `error_message'.
	use global `filename'.
 	be careful when setting `filename' from cpp-lines

	* ydr/types.h: add TINOUT

	* ydr/parse.y: add INOUT and int

	* ydr/output.c (encode_symbol): add default catch-all.
	add handling of INOUT.
	rename `result' -> `_result'
	
	* ydr/lex.l: add INOUT

	* rxdef/Makefile.in (CLIENTLIB, SERVERLIB): run ranlib.
	(clean): remove more files.

	* rx/rx_queue.h: renamed _Q() to _RX_QUEUE(): it conflicts with _Q
 	from <ctype.h>

	* configure, include/config.h.in: regenerated

	* configure.in: remove rxgen

	* rxdef/Makefile.in: add more file types to ydr rule

	* lwp/preempt.c, lwp/iomgr.c: use RETSIGTYPE

	* arlad/volcache.c: use `u_int32_t' for volumes.

	* arlad/fcache.c (writefile): fix sprintf call.

	* configure.in: add AC_TYPE_SIGNAL

	* arlad/msg.c: removed

Wed Jan  7 19:54:57 1998  Love H-Astrand  <lha@ksk.sala.se>

	* arlad/*.xg, arlad/common.h: Removed them, then live in rxdef/ now

Wed Jan  7 10:00:25 1998  Magnus Ahltorp  <magnus@dike.aladdin.se>

	* xfs/linux/Makefile: removed

	* xfs/linux/Makefile.in: Added

Wed Jan  7 07:40:02 1998  Artur Grabowski  <art@squit.stacken.kth.se>

	* xfs: mount_xfs and umount_xfs moved from openbsd to xfs/bin

	* xfs/bin: new mount_xfs with argument parsing and correct syntax

Wed Jan  7 05:31:16 1998  Artur Grabowski  <art@squit.stacken.kth.se>

	* xfs/openbsd/mount_xfs.c: mount_xfs mow mounts with fstype "xfs"
	and not from command-line

Tue Jan  6 07:03:38 1998  Artur Grabowski  <art@squit.stacken.kth.se>

	* appl/vos.c: new command-interface for vos

Tue Jan  6 05:22:13 1998  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* arlad/inter.c(cm_setattr): Using error from writeattr()

	* arlad/fcache.c(writeattr): Using the error we got back from 
	RXAFSStoreStatus()

	* xfs/openbsd/Makefile.in: Added -e to modload

Tue Jan  6 05:06:40 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* arlad/adir.c: Added @sys support

	* arlad/linux-messages.c: Added putdata, putattr, create,
 	pioctl. Cleaned up a lot.

	* xfs/linux/xfs_syscalls.c: First real version

	* xfs/linux/xfs_inodeops.c: Added open, read, readdir, readlink,
 	followlink

	* xfs/linux/xfs_dev.c: Added xfs_message_wakeup_data

Tue Jan  6 04:16:53 1998  Artur Grabowski  <art@squit.stacken.kth.se>

	* fixed xfs/openbsd/umount_xfs and compilation problems with mount
	and umount

Mon Jan  5 17:30:41 1998  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* xfs/openbsd/mod.c: Dont need the diffence between net and open,
 	use modload -e

	* arlad/fcache.c: Fixed bug that made arla write the old length of
 	the file

	* xfs/openbsd/xfs_node.c: Fixed long filename, and added a one
 	entry cache for them.

	* xfs/openbsd/xfs_dev.c: Added some really ugly workarounds for
 	differences between *BSD

Mon Jan  5 05:10:41 1998  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* xfs/openbsd/mount_xfs.c: More errorchecking and removed compat
 	junk
	
Sun Jan  4 22:30:37 1998  Love Hörnquist-Åstrand  <lha@stacken.kth.se>

	* */*/*: Removed all (?) reference to u_long cred and started to
	use pag_t cred. Dont know how much vill break.

	* xfs/openbsd/xfs/xfs_message.h: added xfs_cred and pag_t

Sat Jan  3 21:51:56 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* xfs/linux/xfs_syscalls.c: Added

	* xfs/linux/xfs_inodeops.c: Released inode after use

Sat Jan  3 20:24:37 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* xfs/linux/xfs_cache.c: Added

	* xfs/linux/xfs_node.c: Added cache purging in
 	free_all_xfs_nodes()

	* xfs/linux/xfs_common.h: Cleaned up and changed syntax for xfs_free

	* xfs/linux/xfs_common.c, xfs/linux/xfs_dev.c,
	xfs/linux/xfs_node.c: Changed syntax for xfs_free

	* xfs/linux/xfs_inodeops.c, xfs/linux/xfs_message.c: Changed to xfs_cache

	* xfs/linux/xfs_vfsops.c: Added xfs_put_inode

Sat Jan  3 08:37:08 1998  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* arlad/bsd-messages.c(xfs_message_create): New function

	* arlad/inter.c(cm_close): Fixed flags semantics

	* arlad/fcache.c(writefile): Fix AFSStoreStatus mask

	* xfs/openbsd/xfs/xfs_message.h: Added flag to struct
 	xfs_message_putdata, so we know what to do.

	* arlad/bsd-messages.c: Implemented xfs_message_putdata()

	* xfs/openbsd/xfs_vnodeops.c(xfs_close, xfs_fsync): Added writesupport

Sat Jan  3 05:27:51 1998  Assar Westerlund  <assar@sics.se>

	* xfs_message.c: merge in changes from ../openbsd

	* xfs_vnodeops.c (xfs_read): panic if cache vnode == NULL

	* arlad/bsd-messages.c (xfs_message_getnode,xfs_message_getattr):
 	mask XFS_DATA_MASK from `msg.node.tokens'

Sat Jan  3 00:55:46 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* arlad/inter.c: Changed cm_getattr to check for the correct rights

	* xfs/linux/xfs_inodeops.c: Fixed return value from xfs_lookup

Fri Jan  2 23:34:22 1998  Love Hörnquist-Åstrand  <e96_lho@e.kth.se>

	* xfs/openbsd/xfs_message.c(xfs_message_invalidnode): Fixed tokens
 	in xfsnode

Fri Jan  2 20:46:03 1998  Assar Westerlund  <assar@sics.se>

	* xfs_vnodeops.c: mrege in changes from ../openbsd

	* arlad/bsd-messages.c (vattr2afsstorestatus): remove mask

Fri Jan  2 20:47:20 1998  Love Hörnquist-Åstrand  <e96_lho@e.kth.se>

	* xfs/openbsd/xfs_vnodeops.c: Fixed xfs_write()

	* arlad/bsd-messages.c: Added vattr2afsstorestatus() and cleaned up

	* arlad/arla_local.h: Added vattr2afsstorestatus() defines

Fri Jan  2 12:47:20 1998  Love Hörnquist-Åstrand  <e96_lho@e.kth.se>

	* xfs/openbsd/xfs_vnodeops.c: putattr support working when ATTR
 	not opened RW

	* arlad/inter.c (cm_setattr): Return error message if writeattr fail

	* arlad/fcache.h: Fixed writeattr call

	* arlad/fcache.c: Adding support for chmod

	* arlad/arla_local.h: Added {fs,vldb}.cs.c to get prototypes,
	and fixed the error that was discoved

Fri Jan  2 04:27:06 1998  Assar Westerlund  <assar@sics.se>

	* arlad/cmcb.c (RXAFSCB_CallBack): handle the case of there not
 	being enough callbacks.

Fri Jan  2 03:42:43 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* arlad/linux-messages.c: Made getnode and getroot work

	* xfs/linux/xfs_inodeops.c: Added xfs_lookup

	* xfs/linux/xfs_message.c: Fixed inode number bug

Thu Jan  1 22:53:15 1998  Assar Westerlund  <assar@sics.se>

	* rx/Makefile.in: removed all xdr*

	* rx/rx_misc.c: remove xdr.h and use malloc/free instead of
 	mem_alloc/mem_free

	* ydr/Makefile.in: bsd-make compatible

Thu Jan  1 19:13:40 1998  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* xfs/linux/xfs_dev.c: Fixed some inits.

Thu Jan  1 17:31:08 1998  Assar Westerlund  <assar@sics.se>

	* arlad/arla.c (main): fix call to conv_dir

Wed Dec 31 18:17:15 1997  Love H-Astrand  <lha@ksk.sala.se>

	* milko/ss2fs/file.c: Bugfixes, not done

	* milko/mutil/dirpage.c: Moved to here

	* milko/mutil/fdrxop.c: Added file

Wed Dec 31 13:11:01 1997  Love H-Astrand  <lha@ksk.sala.se>

	* milko/ss2fs/ss2dir.c: Added file
	
Wed Dec 31 00:30:07 1997  Assar Westerlund  <assar@sics.se>
	
	* xfs/xfs_message.h (xfs_message_wakeup_data): added

	* xfs_dev.c (xfs_message_wakeup_data): copied from ../openbsd

	* Makefile.in: removed duplicate ydr

	* rx/rx_pkt.c (rxi_ReadPcket): use a sensible length test.

	* rx/rx_null.h: prototypize
 	rxnull_New{Server,Client}SecurityObject

	* xfs/xfs_message.h (xfs_message_pioctl): add `outsize' add some
 	prototypes

	* arlad/cred.h: only include <des.h> and <krb.h> iff KERBEROS

	* arlad/conn.c (getconnection): ifdef KERBEROS for krbdata

	* arlad/bsd-messages.c (xfs_message_pioctl): (VIOCSETTOK,
 	VIOCUNLOG): ifdef KERBEROS

	* arlad/arla.c (get_cred): ifdef KERBEROS.

	* arlad/Makefile.in: use autoconf'd RXKAD_LIBS

	* configure.in: set RXKAD_LIBS

	* util/fnameutil.c (dirname): return "." for local files.

	* ydr/output.c (init_generate): include the same set of headers in
 	all generated .c-files.

	* lwp/Makefile.in: separate cpu vs OS definitions

Tue Dec 30 22:08:55 1997  Magnus Ahltorp  <map@lroken.stacken.kth.se>

	* xfs/linux/xfs_inodeops.c: Added
	
	* xfs/linux/xfs_node.c: Inode values now based on xfs_node
 	pointer. Some more functions ported.

	* xfs/linux/xfs_message.c: Initial linux port

Tue Dec 30 21:11:01 1997  Love H-Astrand  <lha@ksk.sala.se>

	* milko/ss2fs/file.c: Added even more junk

	* rxdef/Makefile.in: Removed that common.h link, using -I

Mon Dec 29 17:23:25 1997  Assar Westerlund  <assar@sics.se>

	* util/fnameutil.c (dirname): new function

Fri Dec 26 22:54:12 1997  Love H-Astrand  <lha@ksk.sala.se>

	* configure.in: Added ufs01fs & co

	* milko/ss2fs: Added

	* milko/ufs01fs: Added

	* milko: Cleaned up and started to migrate in ss2fs

Wed Dec 24 03:25:51 1997  Magnus Ahltorp <map@hefaistos.abc.se>

	* xfs/linux: Added nfs like allocation of inodes

	* xfs/linux/xfs/attr.h, arlad/linux-messages.c: Added xfs_attr

Mon Dec 22 12:38:26 1997  Love H-Astrand  <lha@ksk.sala.se>

	* ydr/lex.l: We now recognise {u_,}int{16,32}_t

Sun Dec 21 10:30:42 1997  Love H-Astrand  <lha@ksk.sala.se>

	* Makefile.in: Added rxdef

Fri Dec 19 05:08:24 1997  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* xfs/openbsd/xfs_dev.c: Added wakedup_data function in xfs end

	* arlad/fcache.c: Added sysname

	* xfs/openbsd/xfs/xfs_message.h: Added wakedup_data function and
 	struct

	* xfs/openbsd/xfs_syscalls.c: Started adding of sysname

	* arlad/volcache.c: Added VOLCACHEADDDYNAMIC

Wed Dec 17 08:39:02 1997  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* TODO: Fixed getcwd() ?

	* arlad/bsd-messages.c: Added error checking and fixed error msg

	* arlad/arla_local.h: Added debuggingmacro

	* Makefile.in: Changed to ydr

	* arlad/fcache.c: getcwd & ydr

	* arlad/bsd-messages.c: Working pwd, there is still bugs in
 	there...

1997-12-10  Love Hornquist-Astrand  <lha@foo.ksk.sala.se>

	* arlad/inter.c: Made tokens support more sane

	* xfs/openbsd/*: Added support for NetBSD

Tue Dec  9 03:38:52 1997  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* arlad/inter.c: cm_open(): Not quite ready yet.

	* arlad/inter.c: Added test för datausedp;

Mon Dec  8 20:52:09 1997  Assar Westerlund  <assar@sics.se>

	* arlad/bsd-messages.c (afsstatus2vattr): use VNOVAL
	(xfs_message_getnode): cleanup

	* configure.in: test for more header files.

	* ydr: new version.

Thu Dec  4 14:51:05 1997  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* TODO: Added vos and rxdef

Sat Nov 29 02:18:57 1997  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* appl/vos.c: listvol does not work, yet

	* appl/vos.c: Almost working, just lacking CellServDB parsing

	* appl/arlalib.c: Added more junk

Fri Nov 28 17:00:17 1997  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* appl/vos.c: More working code

	* appl/arlalib.c: First version

Tue Nov 25 20:45:20 1997  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* rxgen/main.c: Fixed configure test for CPP

Wed Nov 19 13:03:58 1997  Love Hornquist-Astrand  <lha@foo.ksk.sala.se>

	* milko/dirpage.c: Added 

	* milko/inodedb.c: Added 

	* milko/diskio.c: Made more usable

Tue Nov 18 23:54:11 1997  Magnus Ahltorp  <map@stacken.kth.se>

	* configure.in: Fixed bug that turned off kerberos default

Tue Nov 18 06:13:17 1997  Magnus Ahltorp  <map@stacken.kth.se>

	* Added support for different include and lib paths in kerberos.
	Clean up configure.

Sat Nov 15 15:31:24 1997  Love H-Astrand  <lha@jenny.ksk.sala.se>

	* lwp/lwp.c: Added support for posix signals, added RCSID()

	* lwp/preempt.c: Added support for posix signals

	* lwp/lwp.h: Added check for posix-signals

	* acconfig.h: Added check for posix-signals

	* configure.in: Added check for sys/ioccom.h

	* arla/Makefile.in: Added @CFLAGS@
	
Sat Nov 15 11:41:33 1997  Magnus Ahltorp  <map@stacken.kth.se>

	* configure.in, Makefile.in: Added support for conditional
	build of rxkad

Fri Nov 14 09:36:20 1997  Magnus Ahltorp  <map@stacken.kth.se>

	* configure.in: Cleaned up and added messages

Fri Nov 14 08:54:26 1997  Magnus Ahltorp  <map@stacken.kth.se>

	* configure.in: Added support for --with-krb4.

	* acconfig.h: Removed superfluous #define KERBEROS
	
Thu Nov 13 05:42:30 1997  Artur Grabowski  <art@stacken.kth.se>

	* xfs/openbsd/xfs_node.c: Fixed the removing of vnodes from the
 	list of all vnodes in the fs. :)

Wed Nov 12 22:00:28 1997  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* arlad/volcache.c: Added gc

Wed Nov 12 04:40:46 1997  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* arlad/conn.c: Added gc

	* arlad/bsd-messages.c: Added check for invalid rpc calls

	* arlad/cred.c: Made a cred_remove() remove all connection in the
 	connection cache too.

	* arlad/bsd-messages.c: Cleaned up the code.

	* arlad/conn.c: Added support to remove a connection from the
 	connection cache, we still dont gc.

	* util/hash.c: Added hashtabcleantab()

Mon Nov 10 01:11:38 1997  Assar Westerlund  <assar@sics.se>

	* added lots of copyrights.

	* lib/rxkad: updated

	* acconfig.h: -DKERBEROS

	* xfs/freebsd/xfs/xfs_message.h: added pioctl

Sun Nov  9 19:16:25 1997  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* arlad/cred.h: Cleanup, added support to clean tokens based on
 	uid.

	* xfs/openbsd/xfs_syscalls.c: Added support for VIOCUNLOG

	* xfs/openbsd/xfs/xfs_message.h: Added uid to struct
 	xfs_message_pioctl, in some magic way we should support PAGs too.

	* arlad/bsd-messages.c: Added support for VIOCUNLOG

Sun Nov  9 17:25:27 1997  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* xfs/openbsd/xfs/xfs_message.h: Added xfs_message_pioctl

	* xfs/openbsd/kafs.h: Added

	* xfs/openbsd/xfs_syscalls.c: Added VIOCSETTOK

	* arlad/bsd-messages.c: Working cred

Sat Nov  8 19:58:46 1997  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* arlad/cred.c: Added putkrb4cred()

Fri Nov  7 20:57:09 1997  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* rx/rx_user.c: Removed rx warning messages

	* arlad/conn.c: After 24h hacking, working rxkad !

Thu Nov  6 22:28:33 1997  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* arlad/arla.c: Added kerberos support, not working, yet.

	* arlad/Makefile.in: Added support for rxkad, assume krb4 world

	* Makefile.in: Added rxkad

	* arlad/cred.h: Fixed.

	* arlad/cred.c: Fixed some more

Thu Nov  6 18:05:59 1997  Artur Grabowski  <art@bobby.stacken.kth.se>

	* arlad/bsd-kernel.c: fixed exit on error from device.

Thu Nov  6 17:34:27 1997  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* arlad/arla.c: Init credcache

	* arlad/conn.c: Added support for rxkad

Thu Nov  6 17:34:27 1997  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* arlad/cred.h: Made it buildable and spell checked.

	* arlad/cred.c: Made it buildable.

Thu Nov  6 17:31:09 1997  Artur Grabowski  <art@bobby.stacken.kth.se>

	* xfs/openbsd/xfs_vfsops.c: fixed the releasing of vnodes.

	* xfs/openbsd/xfs_vnodeops.c: cleaned up.

	* Learned to use ChangeLog. (hopefully)

Thu Nov  6 02:38:20 1997 Love Hornquist-Astrand  <lha@foo.ksk.sala.se>

	* arlad/cred.h: Added 
	
	* arlad/cred.c: Added

	* milko/diskio.c: Started to read the inode instead of makeing up data.

	* milko/build_a_inode.c: more features
	
Tue Nov  4 03:03:03 1997  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* rxkad/*.[ch]: s/int32/int32_t/g

	* configure.in: Added some more tests.

	* rxkad/Makefile.in: Living in a krb4 work, assar will shot me.

	* aclocal.m4: Added checks for types (int32 & co)

Sun Nov  2 17:24:22 1997  Assar Westerlund  <assar@sics.se>

	* xfs_vnodeops.c (xfs_data_valid): set `msg.tokens'
	(xfs_lookup): copy name to `msg' correctly

	* xfs_vfsops.c (xfs_root): set `msg.cred'

	* xfs_node.c (free_xfs_node): reset data

	* xfs_message.c (xfs_message_installdata): unlock the cache vnode
 	after lookup

	* xfs_dev.c (xfs_message_rpc): copy back from temporary memory to
 	`message'

	* arlad/inter.c (cm_open): set enty->tokens correctly

	* arlad/Makefile.in: use `test -h' instead of `test -L'

Sat Nov  1 02:06:18 1997  Love H-Astrand  <lha@ksk.sala.se>

	* arlad/Makefile.in: Fixed so we can build in another directory
 	then src

        * aclocal.m4: Added
	
Thu Oct 30 01:46:51 1997  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* configure.in: Fixed linux include stuff

	* arlad/linux*: Added linux specific files

	* configure.in: Added milko.

	* milko/Makefile.in: Fixed for merging into arla-tree

Wed Oct 29 22:52:15 1997  Assar Westerlund  <assar@sics.se>

	* arlad/volcache.c (findvolname, findvolid): check for getvolname
 	returning an error

Sun Oct 26 17:59:11 1997  Magnus Ahltorp  <map@wakko.stacken.kth.se>

	* xfs/linux/xfs_common.c: Linuxified

Sat Oct 25 19:01:45 1997  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* lwp/lwp.c: Ansified

	* lwp/iomgr.c: Ansified
	
Sat Oct 25 17:05:21 1997  Assar Westerlund  <assar@sics.se>

	* xfs/freebsd: use mp->mnt_vnodelist instead of xfsp->nodes

	* xfs/freebsd/Makefile.in: new autoconf'ed makefile

Sat Oct 25 15:53:31 1997  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* lwp/Makefile.in: Grrrr gcc -E är dum.

	* Makefile.in: Added rx and rxgenbuilding

	* lwp/Makefine.in: Added support for multippel processors
	
Sat Oct 25 15:48:38 1997  Assar Westerlund  <assar@sics.se>

	* xfs/linux/xfs: new files

Sat Oct 25 14:23:45 1997  Love Hornquist-Astrand  <lha@stacken.kth.se>

	* configure.in: Removed some configure.in's

Sat Oct 25 14:15:11 1997  Magnus Ahltorp  <map@wakko.stacken.kth.se>

	* xfs/linux/xfs_dev.c: Merged in the real file and adopted it to
 	Linux

Sat Oct 25 05:46:29 1997  Magnus Ahltorp  <map@stacken.kth.se>

	* xfs/linux/xfs_dev.c: Moved device stuff here 

	* xfs/linux/super.c: Working filesystem

Fri Oct 24 18:33:36 1997  Magnus Ahltorp  <map@stacken.kth.se>

	* xfs/linux/super.c: Almost working empty filesystem.

Fri Oct 24 17:20:40 1997  Assar Westerlund  <assar@sics.se>

	* rx/Makefile.in: replaced junk makefile with a new one

	* arlad/Makefile.in: much clean-up and improvements

	* Makefile.in: much clean-up and improvements

	* configure.in: much clean-up and improvements

	* xfs/Makefile.in: stub makefile

	* lib/util/ip.[ch]: resurrected

	* lib/lwp/q.c: resurrected
	

