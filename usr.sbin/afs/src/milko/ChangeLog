2001-01-01  Love  <lha@stacken.kth.se>

	* fs/fsprocs.c: (RXAFS_FetchACL): add dummy call to i2nlist() to
	return numbers when pts-server is down
	(RXAFS_Link): dummy implement, not enabled
	
	* vldb/vldbserver.c(main): pass realm to network_init().

2000-12-29  Tomas Olsson  <tol@stacken.kth.se>

	* appl/sked/sked.c ({vol{create,show,ls},salvage}_cmd):
	Handle vicep* in other places than /
	* lib/voldb/voldb_locl.h Makefile.in vol.c:
	Handle vicep* in other places than /
	* lib/dpart/dpart.[ch]: Handle vicep* in other places than /
	* fs/fileserver.c (main): use the given realm, new arg partdir,
	place to look for vicep*
	(sigusr1): look in the right place for vicepa
	* pts/ptserver.c (main): use the given realm
	* fs/fsprocs.c (RXAFS_StoreACL): return correct values
	* lib/vld/vld.c (vld_create_volume): no default rights for
	anonymous

2000-12-10  Love  <lha@stacken.kth.se>

	* appl/perf/perf.c: return somewhat more sane error-codes in the
	callbackserver

2000-12-05  Love  <lha@stacken.kth.se>

	* lib/mlog/Makefile.in: added $(srcdir)/../../..
	
2000-12-04  Love  <lha@stacken.kth.se>

	* lib/ropa/ropa.c (ropa_getcallback): if we fail to probe the
	client, whine and return a bogus callback
	(update_callback_time): new, update a backback
	(update_callback): use update_callback_time().

2000-12-01  Tomas Olsson  <tol@stacken.kth.se>

	* fs/fsprocs.c (*): always give a real mnode as arg when calling
	vld_modify_vnode()
	* lib/vld/vld.c (*ent_to_fetchstatus): new format w/ volume_handle
	(*): set fetchstatus more correctly, use new *ent_to_fetchstatus

2000-11-25  Love  <lha@stacken.kth.se>

	* lib/ropa/ropa.c: first shot at threadsafeness
	
2000-10-08  Tomas Olsson  <tol@stacken.kth.se>

	* appl/sked/sked.c (volcreate_cmd): parse partition name correctly

2000-10-03  Love  <lha@stacken.kth.se>

	* **/*.[chly]: Removed advertising clause.

2000-10-02  Assar Westerlund  <assar@sics.se>

	* lib/vld/vld.c (vld_check_rights): always look at the node itself
	if it's a directory
	* lib/vld/mnode.h: remove VOLOP_PARENT

2000-09-29  Tomas Olsson  <tol@stacken.kth.se>

	* pts/ptserver.c (addtogroup): avoid duplicates
	* bos/bosserver.c: check both serverfile and bos.conf
	* appl/sked/sked.c (main): make logging work
	* fs/fsprocs.c
 	(RXAFS_{FetchData,FetchStatus,StoreData,CreateFile}): log
 	calleraccess on return
	* fs/fileserver.c (main): use ropa_init() the new way
	* lib/ropa/ropa.h: update prototype for ropa_init()
	* lib/ropa/ropa.c: keep connections to clients and reuse,
	added hashtable to keep track of ccpairs
	(ropa_init): new interface w/ htabsizes & #ccpairs

2000-09-29  Love  <lha@stacken.kth.se>

	* pts/pr.c (PR_NameToID,PR_IDToName): print [in]len
	* pts/*.c: change to log_log, clean up
	* bos/bosserver.c: remove unused variables
	
2000-09-15  Mattias Amnefelt  <mattiasa@e.kth.se>

	* pts/ptserver.c (find_first_free): Use deleted entries
	* pts/ptserver.c (listelements): don't include own id when 
	  PR_ListElements

2000-09-15  Tomas Olsson  <tol@stacken.kth.se>

	* lib/mlog/mlog.c (mlog_loginit): use the supplied method

2000-09-06  Tomas Olsson  <tol@stacken.kth.se>

	* fs/fsprocs.c (removenode): return error if dirp doesn't match
	actual node type
	* bos/bosserver.c: somewhat closer to working condition
	* bos.conf: closer to current format
	
2000-09-04  Love  <lha@stacken.kth.se>

	* pts/ptserver.c: remove some warnings usr log_log
	
2000-09-03  Love  <lha@stacken.kth.se>

	* bos/bosprocs.c (AddSUser, DeleteSUser): add some content
	(*): re-indent

2000-09-02  Love  <lha@stacken.kth.se>

	* bos/bosprocs.c: added missing functions

2000-08-24  Love  <lha@stacken.kth.se>

	* fs/fileserver.c: update code to new mlog_log_set_level
	* lib/mlog/mlog.c: new log_log
	
2000-08-21  Tomas Olsson  <tol@stacken.kth.se>

	* pts/ptserver.c (localize_name): use strlcpy
	* fs/connsec.c (fs_connsec_anonymous): added - set up anonymous	CPS
	(fs_connsec_createconn): use fs_connsec_anonymous() when auth fails
	* lib/vld/vld.c (super_user): check if member of
 	system:administrators
	* lib/ropa/ropa.c (client_update_interfaces): ntohl() is no longer
 	needed

2000-08-17  Tomas Olsson  <tol@stacken.kth.se>

	* vldb/vldbserver.c (VL_GetEntryByIDN): local variable to save
 	const arg voltype
	* pts/pr.c (PR_{NameToID,NewEntry,INewEntry}): use localize_name()
 	to get well formatted name
	(PR_IDToName): check args
	(PR_{ListElements,GetCPS}): use new listelements()
	* pts/ptserver.h: new proto for listelements() added
 	localize_name()
	* pts/ptserver.c: add & use debug functions
	(localize_name): added
	(addtogroup,removefromgroup): use prentry.count, make sure no
	holes in entrylists
	(listelements): new bool arg, use prentry.count, add own & if arg
	set default ids
	* lib/vld/vld.c (vld_create_volume): less wild default privileges
	(super_user): always return 0
	(vld_check_rights): check rights, don't make everything up
	* lib/vld/salvage.c: more unsigned
	* lib/vld/vld.h: more unsigned
	* lib/vld/mnode.h: use unsigned instead of long for flags
	* lib/ropa/ropa.c (find_client): fix typo
	(client_update_interfaces): use ntohl() on hidden elements in
	struct from peer 
	(ropa_init): get & save debuglevel for later use
	(debug_print_callbacks): don't iterate if MDEBROPA not set i debuglevel
	* fs/fsprocs.c (check_ss_bits): set mask appropriately when
 	creating
	* fs/connsec.c (get_conn): use netinit_client_getcred()
	(fs_connsec_nametoid): better handling of connection to ptserver, retry
	(fs_connsec_createconn): send full principal to PR_NameToID
	* lib/msecurity/netinit.c (server_get_cred): rename to
 	netinit_client_getcred(), try harder to get ticket
	(network_init): get our own ticket file
	(netinit_getrealm): added
	* lib/msecurity/netinit.h: rename server_get_cred() to
 	netinit_client_getcred() add netinit_getrealm()
	* appl/perf/perf.c (do_bulkstat): fix typo
	* README: myhost instead of localhost

2000-08-12  Mattias Amnefelt  <mattiasa@e.kth.se>

	* pts/pr.c: added body for PR_ListElements, PR_AddToGroup and
	PR_RemoveFromGroup
	* pts/ptserver.c: added update_entry, listelements, addtogroup and 
	removefromgroup
	* pts/ptserver.h: added listselements, addtogroup and 
	removefromgroup

2000-08-11  Mattias Amnefelt  <mattiasa@e.kth.se>

	* lib/msecurity/msecurity/msecurity.c: use $prefixed configdir for 
	superuserlist

2000-08-10  Love  <lha@stacken.kth.se>

	* lib/vld/vld.c (vld_storestatus_to_dent): permit s[gu]id binaries
	(vld_modify_vnode): dont assert admin

	* fs/fsprocs.c (RXAFS_{MakeDir,CreateFile}): check storestatus
	(RXAFS_Symlink): pass on storestatus from caller after checking it
	(check_ss_bits): check storestatus bit from user.
	(StoreData,StoreStatus): call check_ss_bits

2000-08-10  Tomas Olsson  <tol@stacken.kth.se>

	* lib/vld/vld.c (vld_modify_vnode): get fetchstatus after
 	modifying

	* lib/vld/mnode.c (mnode_find): save node in lru
	(mnode_free): better handling of bad nodes, save node in lru
	(mnode_remove): remove node from lru before adding it again

	* lib/ropa/ropa.c: more logging, use debug_print_callbacks() and
 	print_callback_sub()
	(break_ccpair): check cc->li for NULL before listdel
	(ropa_drop_callback): no error if arg-lists have different lengths
	(heapcleaner): cowardly avoid error, leave list handling to break_ccpair()

	* fs/fsprocs.c (RXAFS_FetchData): more logging, return nothing on
 	weird offset
	(RXAFS_StoreData): handle strange strange filelength arg more nicely, more logging
	(RXAFS_{CreateFile,GiveUpCallbacks,GetRootVolume,GetTime}): more logging

2000-07-24  Tomas Olsson  <tol@stacken.kth.se>

	* lib/ropa/ropa.c: improve debug formatting

	* fs/fsprocs.c (StoreData): log offset and length
	(removenode): use new vld_adjust_linkcount(), vld_modify_vnode()
	(RXAFS_{CreateFile,Rename,Symlink}): use vld_modify_vnode() to update size
	(RXAFS_MakeDir): use new vld_adjust_linkcount(), vld_modify_vnode()

	* lib/vld/mdir.c (mdir_{creat,remove,mkdir}): use mnode_update_size()

	* lib/vld/mnode.h: added mnode_update_size(),
 	mnode_update_size_cached()

	* lib/vld/mnode.c: added mnode_update_size(),
 	mnode_update_size_cached() (moved from vld.c)

	* lib/vld/vld.h: remove vld_update_size(),
 	vld_update_size_cached() vld_adjust_linkcount() now takes an mnode

	* lib/vld/vld.c (vld_create_entry): set DataVersion to current
 	time
	(vld_adjust_linkcount): take the mnode as arg, update it properly too
	(vld_update_size, vld_update_size_cached): renamed and moved to mnode.c
	(vld_{fent,dent}_to_fetchstatus): use mnode_update_size_cached()
	(vld_modify_vnode): use only non-null arguments, update DataVersion & Length

	* lib/msecurity/netinit.c (network_init): don't overwrite cached
 	realm

2000-07-24  Love  <lha@stacken.kth.se>

	* fs/fsprocs.c (RXAFS_StoreACL): break callback
	(RXAFS_Rename): break new parent is needed, don't break child

2000-07-22  Love  <lha@stacken.kth.se>

	* appl/sked/sked.c: more userfriendly, prime for hash, debug
	example.

	* lib/voldb/voldb.c (voldb_del_entry): remove bogus assert
	* lib/voldb/vol.c (vol_create): gc unused variable, don't remove
	the file when failing to store data.
	* lib/voldb/vdb_flat.c (vdbflat_del_entry):L remove bugus assert,
	reset even more values.

	* lib/vld/vld.c: use already defined macros, fix some bugs.
	* lib/vld/salvage.c: use already defined macros, fix some bugs.

2000-07-21  Love  <lha@stacken.kth.se>

	* bos/*: move out bosserver proc

	* appl/sked/Makefile.in: include debugging
	* appl/sked/sked.c: Added salvage command, fixed debugging

	* include/mdebug.h: more debug stuff
	
	* lib/voldb/voldb.c:(voldb_get_volume): remove bogus assert

	* lib/dpart/dpart.[ch]: (dp_parse): new function
	(dp_getpart): new function
	(dp_create): make work for large partitions

	* fs/fsrv_locl.h: include <salvage.h>
	* fs/fileserver.c:move logging stuff, salvage rename, unsigned printing
	* fs/Makefile.in: remove salvage.c
	* fs/salvage.c: move to lib/vld

	* lib/vld/debug.c: moved mdebug stuff here.
	* lib/vld/salvage.[ch]: move here from fs/, made it work
	* lib/vld/Makefile.in: move salvage.c here from fs/salvage.c
        make it work even more
	* lib/vld/Makefile.in: Added salvage.c

2000-07-16  Love  <lha@stacken.kth.se>

	* pts/ptserver.c: removed unused stuff, added more static's, redid
	opening of db.
	* lib/voldb/voldb.c (voldb_get_entry): make it work for TYPE_LINK
	(voldb_get_volume): new function to fetch volume-number
	* lib/voldb/voldb.h (voldb_get_volume): new function to fetch
	volume-number

2000-07-15  Tomas Olsson  <tol@stacken.kth.se>

	* lib/ropa/ropa.h: add ropa_drop_callbacks() new interface for
 	ropa_break_callback()
	* lib/ropa/ropa.c: logging stuff
	(break_ccpair): delete from callback´s ccpairs
	(break_callback): new argument break_own, break own callback only if set
	(ropa_break_callback): new arg break_own, don´t return if unknown client
	(ropa_drop_callbacks): added.
	* fs/fsprocs.c (RXAFS_StoreData): don´t check offset/len, more
 	logging, break callback
	(RXAFS_StoreStatus): break callback
	(removenode, RXAFS_CreateFile): break callback for directory as well
	(RXAFS_Rename): use afs_dir_p(), break callbacks
	(RXAFS_Symlink): more logging, break callback for directory, set mode bits correctly
	(RXAFS_Makedir): callbacks handling
	(RXAFS_GiveUpCallBacks): use ropa_drop_callbacks()
	* lib/ropa/Makefile.in: -I for mlog, mdebug
	* include/mdebug.h: add MDEBROPA
	* fs/fileserver.c: add --debug=ropa, MDEBROPA
	* appl/sked/sked.c (volls_cmd): make it almost work

2000-07-02  Tomas Olsson  <tol@stacken.kth.se>

	* README: add some info about -cell
	* lib/dpart/dvol.c: unused, removed
	* lib/ropa/ropa.h: new ropa_break_callback() prototype
	* lib/ropa/ropa.c (*): define & use ROPA_MTU
	(callbacks_cmp): return 0 only when equal
	(client_update_interfaces): also consider host-IP from call
	(client_init): call client_update_interfaces() new way
	(ropa_getcallback): call client_update_interfaces() new way,
			fix callback-list handling
	(ropa_break_callback): reorder arguments
	
2000-06-24  Love  <lha@stacken.kth.se>

	* lib/ropa/ropa.c (clear_addr): clear a address
	(client_deref): don't memset client.addr[]
	(client_update_interfaces): use clear_addr

2000-06-24  Harald Barth  <haba@pdc.kth.se>

	* README: spell
	* lib/ropa/ropa.c: port in ropa_client structure is in network
	byte order and therefore no conversion when calling
	rx_NewConnection.
	* fs/fileserver.c: Added flag for forced salvage
	* README: more info about starting servers

Fri Jun 23 21:06:29 2000  Tomas Olsson  <tol@pizza.stacken.kth.se>

	* lib/ropa/ropa.c, lib/vld/vld.c: NULL test
	* lib/voldb/voldb.c, lib/voldb/voldb.h: make afs_dir_p work

Thu Jun 22 17:21:06 2000  Tomas Olsson  <tol@pizza.stacken.kth.se>

	* lib/vld/vld.c (vld_create_entry): clean up on error
	(vld_set_onode, vld_adjust_linkcount, vld_open_vnode,
	vld_modify_vnode, vld_put_acl, vld_remove_node): use afs_dir_p()
	(vld_create_volume): don't close fd again
	(vld_register_vol_type): fix check

	* lib/voldb/voldb.c: rewrite conversion routines
	(voldb_init): fix typo
	(voldb_close): don't close fd again

	* lib/voldb/voldb.h: added afs_dir_p()

	* lib/voldb/vdb_flat.c (vdbflat_init): more sane checks & cleanup
 	on error
	(vdbflat_close): close fd.
	(vdbflat_extend_db): fix sanity checks
	(vdbflat_del_entry): fix checks

	* vldb/vled.c: include limits.h

	* bos/bosserver.c: added BOZO_SetStatus()

2000-06-05  Love  <lha@s3.kth.se>

	* lib/ropa/ropa.c (client_update_interfaces): don't memset that
	wildly
	(clients_hash_ip): remove somewhat bogus assert
	(client_query): move assert here
	* bos/bosserver.c: update to new ydr code
	* appl/perf/perf.c: update to new cb code
	
2000-06-04  Magnus Ahltorp  <ahltorp@nada.kth.se>

	* fs/connsec.c: (fs_connsec_idtoname): handle null error strings

2000-06-02  Magnus Ahltorp  <ahltorp@nada.kth.se>

	* fs/salvage.c: volume numbers are unsigned

	* lib/voldb/vol.c (vol_create): set inUse and destroyMe

	* lib/vld/vld.h: transactions

	* lib/vld/vld.c: transactions

	* fs/volprocs.c: added transactions

	* fs/fsprocs.c (fs_init_req): Check busy

	* fs/fileserver.c (main): set progname
	
2000-05-27  Love  <lha@s3.kth.se>

	* lib/ropa/ropa.c (heapcleaner): remove the ccpair from the
	callback's list of callbacks
	(struct ropa_ccpair): cb_li, pointer to li on callback
	(add_client): store where the cc is stored in the callbacks list
	of cc's
	(break_ccpairs): remove the ccpair from the callback's list of
	callbacks

	* bos/kconf.[ch]: files stolen and changed from ej (that stole
	them from heimdal)

	* lib/ropa/ropa.c: removed borken paranoia, new paranoia, extended
	paranoia, fixed bugs, made it almost work.

	* include/mdebug.h (MDEBFS): added
	
	* lib/vld/mnode.c (mnode_cmp): made it work
	(mnode_remove): new function, remove a node from the cache

	* fs/salvage.c: fix logging, fix multiple parents, fix logging to
	wrong level

	* fs/fsprocs.c (*): added some simple debugging, make directory
	operations more paranoid of the input vnode, make removal
	operations clean mnode cache
	(rm,rmdir,mv)

	* fs/fileserver.c (milko_deb_units): added fs debuglevel
	
	* appl/perf/perf.c (cmcb_init): made static

2000-05-25  Love  <lha@s3.kth.se>

	* vldb/vled.c (*): update to new vldb_print_entry
	* vldb/vldb_locl.h (vldb_print_entry): update prototype
	* vldb/vl_db.c (vldb_print_entry): long version with
	server-addresses

	* lib/vld/common.c: local_opaque2ino: don't export
	
	* lib/msecurity/netinit.c (server_get_cred): more type
	
	* README: expand even more
	
2000-05-24  Harald Barth  <haba@puffin.pdc.kth.se>

	* README: Explain afs@REALM principal better

2000-05-02  Tomas Olsson  <tol@fredrika-bremer.stacken.kth.se>

	* appl/perf/perf.c (do_createfilecontent): update to new StoreData

2000-05-01  Tomas Olsson <tol@stacken.kth.se>

	* arla/milko/fs/fsprocs.c: (RXAFS_FetchACL): return negative ACL:s
	as well
	(RXAFS_BulkStatus): immediate return if vld_check_rights() fails

2000-05-01  Magnus Ahltorp  <ahltorp@nada.kth.se>

	* vldb/vldbserver.c: Spellfix, (main): call set_progname

2000-04-30  Assar Westerlund  <assar@sics.se>

	* fs/fsprocs.c (RXAFS_StoreData): update to new StoreData
	* fs/fsprocs.c: update fdir_changefid.  adapt.

2000-04-28  Love  <lha@s3.kth.se>

	* lib/vstatus/vstatus.c (vstatus_print_onode): unconfuse printing
	of o->data

2000-03-20  Love  <lha@s3.kth.se>

	* lib/ropa/ropa.c (callback_ref): use the right list
	
2000-03-19  Love  <lha@s3.kth.se>

	* fs/fileserver.c(usage): print usage in gnu-style too

2000-03-09  Love  <lha@s3.kth.se>

	* lib/vld/vld.c: (vld_open_vnode): get cached test right.
	(iter_vol): typecast to right struct

	* fs/salvage.c: more paranoia
	
2000-03-06  Love  <lha@s3.kth.se>

	* lib/vld/vld.c (iter_vol): ref volumes during call to `func'

	* fs/salvage.c (tree_connectvity): make volume-db's uptodate,
	don't free volume, since it isn't ref:ed

	* lib/vld/vld.c (vld_iter_vol): pass the right argument

2000-03-05  Love  <lha@s3.kth.se>

	* */*: mlogging and some basic salvager

	* include/mdebug.h: debug constants for milko

	* lib/mlog/mlog.[ch]: logging subsystem

2000-03-04  Love  <lha@s3.kth.se>

	* lib/voldb/{voldb.c,vdb_flat.c}: use only mmap, change who is
	resonsible for writing down header to disk.

	* lib/vld/vld.c(vld_create_volume): close is done in VOLOP(close)
	(vld_check_right): stop permitting the client to do anything when
	ptserver is down.

	* appl/sked/sked.c: restructure due to changes in voldb/vldb

2000-02-27  Love  <lha@s3.kth.se>

	* vldb/vled.c: some more edlike functionallity, added print,
	backup and search

	* vldb/vldbserver.c (*): some cleaning

2000-02-22  Love  <lha@s3.kth.se>

	* lib/voldb/vdb_flat.c: added prototypes

	* lib/vld/vld.h: added prototypes

	* lib/vld/vld.c: added prototypes

	* lib/vld/glue.c (add_entry): added special handling for files

	* lib/vld/fvol.h: added fvol_offset2opaque

	* lib/vld/fvol.c: clear out the most obvious bugs

	* lib/ropa/ropa.h: update ropa_getcallback added some missing
	prototypes

	* lib/ropa/ropa.c: clear out the most obvious bugs

	* fs/fsprocs.c (*): fix arguments for ropa_getcallback

2000-02-19  Love  <lha@s3.kth.se>

	* fs/fileserver.c: init LWP since ropa needs it

	* fs/fsprocs.c: remove old traces of ropa, and small bug fixes

	* lib/msecurity/netinit.c: Try also afs.realm@REALM

	* lib/vld: Moved the [sf]vol stuff here

	* lib/vld/vld.[ch]: add vld_set_onode

	* dumbclient/*: replaced by perf

1999-11-03  Love  <lha@s3.kth.se>

	* vldb/vldbserver.c (main): move port initlization later.
	(open_db): added what filed we failed to open.
	(vldbserver_create): add what database we are creating.

	* appl/bootstrap/boot-strap.sh.in: Add support for the
	pts, vldb and srvtab creation.

	* vldb/vldbserver.c (*): break out the creating of the database
	and opening of it, add a flag to make that you tell the server to
	explicit only create the database.

	* pts/ptserver.c (*): break out the creating of the database and
	opening of it, add a flag to make that you tell the server to
	explicit only create the database.

	* appl/sked/sked.c (*): create a global varibale interactivep and
	a macro INTER_RETURN() and start to use it. This enables us to
	give a sane exit-code when running in command-line-mode.

	* appl/bootstrap: Added shellscript to bootstrap

	* fs/fsprocs.c (RXAFS_BulkStatus): first implemtation using mnode
	interface XXX

	* lib/vld/vld.c (vld_create_entry): if directory, set acl
	(vld_create_entry): memset acl, add dummy entry for anonymous

	* lib/voldb/voldb.c (voldb_pretty_print_dir): more pretty
	printing.

	* pts/pr.c (PR_IDToName): when failed to find name in database
	print number instead of the empty string.

	* lib/voldb/Makefile.in: added vstatus

	* fs/fsprocs.c (RXAFS_{Symlink,MakeDir,CreateFile}): use new
	vld_create_entry()
	* fs/Makefile.in: added vstatus

	* lib/vstatus/vstatus.h: Added wrapper #ifdef/#endif
	(vstatus_print_onode): new function.

	* lib/vstatus/vstatus.c (vstatus_print_onode): new function.

	* lib/voldb/voldb.h: Added <vstatus.h> Removed <vstat.h>

	* lib/voldb/voldb.c (voldb_flush): let the lower layer do the
	flush
	(*print_print*): again print the onode_opaque

	* lib/voldb/vdb_flat.c (*): changed how we find where to write the
	bits
	(*): removed #if 0 code, and finally fixed some bugs.

	* lib/svol/Makefile.in (INCLUDES): add
	-I$(srcdir)/../../lib/vstatus

	* appl/sked/sked.c (show_volume): print vnode

	* appl/sked/Makefile.in (INCLUDES): add
	-I$(srcdir)/../../lib/vstatus

	* lib/vld/vld.h (vld_create_entry): changed signature.

	* lib/vld/vld.c (vld_create_entry): changed parent fid to a mnode
	to be able to copy the acl when its a dir.

1999-11-02  Love  <lha@s3.kth.se>

	* fs/Makefile.in(INCLUDES): Add ../lib/vstatus
	
	* appl/sked/sked.c: don't print inode numbers.

	* lib/vld/vld.c(*): converted fully to opaque

	* lib/svol/svol.c: random fixes to make it build

	* lib/voldb/voldb.h: Add <vstat.h>

	* lib/voldb/vdb_flat.c (*): Added length pointers.

	* lib/voldb/Makefile.in (INCLUDES): add ../vstatus

	* lib/voldb/voldb_internal.h (voldb_type): make del_entry right
	type.

	* lib/svol/svol.c: use opaque

	* lib/voldb/voldb.c (voldb_get_size): new function.  don't print
	the opaque structure.

	* lib/voldb/voldb.h: use opaque structure.

	* lib/vstatus/vstatus.c: remove comment.

1999-11-02  Magnus Ahltorp  <map@stacken.kth.se>

	* fs/fsprocs.c (RXAFS_FetchACL): Implement
	(RXAFS_StoreACL): Implement
	(RXAFS_MakeDir): Inherit ACL from parent

	* fs/connsec.[ch] (fs_connsec_nametoid): Added
	(fs_connsec_idtoname): Added

	* pts/pr.c (PR_GetCPS): Authenticated user is always member of
	system:anyuser and system:authuser

	* pts/ptserver.c (prserver_init): Add system:anyuser and
	system:authuser when creating the database

	* lib/voldb/voldb.h: Move struct acl_entry out of the
	voldb_dir_entry struct

	* lib/vld/vld.[ch] (vld_create_volume): put "system:authuser rl"
	acl entry into root node
	(vld_check_rights): use msec, check negacl, check rights more
	correctly
	(vld_put_acl): Added

1999-10-24  Love  <lha@s3.kth.se>

	* lib/vld/vld.c (vld_db_uptodate): dont close fd's, any add
	comment why

	* lib/vld/vld.c (vld_db_uptodate): close fd's when needed, set
	pointer to NULL when failing, add comment about bringing volume
	offline

1999-10-23  Magnus Ahltorp  <map@stacken.kth.se>

	* lib/voldb/vdb_flat.c (vdbflat_put_acl): put acl at correct
	position

1999-10-22  Magnus Ahltorp  <map@stacken.kth.se>

	* fs/connsec.h: Remove fs_connsec_newconn

	* fs/connsec.c: Get CPS

	* lib/msecurity/msecurity.[ch] (sec_getname): Call with
	rx_connection instead of rx_call

	* pts/ptserver.c: Bring ptserver init up-to-date

	* pts/Makefile.in: Added MILKO_SYSCONFDIR

	* fs/Makefile.in: Added libacl and libptclient

	* fs/fsrv_locl.h: Include getarg.h

	* fs/fileserver.c (main): Added getarg support, removed connection
	creation routine

	* fs/fsprocs.c (RXAFS_Symlink): fd is not closed by fbuf_end

	* lib/msecurity/netinit.[ch] (server_get_cred): Added

1999-10-19  Magnus Ahltorp  <map@stacken.kth.se>

	* fs/fsprocs.c (*): pass around msec instead of prlist
	(fs_init_msec): get security context
	(RXAFS_FetchACL): return bogus acl
	(removenode): adjust correct link count, clear ep
	(RXAFS_*): return correct FetchStatus
	(RXAFS_Rename): handle move to existing files

	* fs/fsrv_locl.h: Added connsec.h

	* fs/fileserver.c (main): register connection {new, destroy}
	functions

	* fs/Makefile.in: Added connsec.o

	* lib/vld/mnode.h: Added struct fs_security_context

	* lib/vld/mdir.c (mdir_mkdir): update length

	* lib/vld/vld.h (vld_create_entry): pass around msec instead of prlist
	(vld_create_directory): remove prototype

	* lib/vld/vld.c (*): pass around msec instead of prlist
	(vld_set_author): add function
	(vld_create_entry): optionally return child mnode, set
	various status fields
	(vld_storestatus_to_?ent): don't update ServerModTime
	(vld_check_rights): change from bogus unix bits to correct
	afs access bits
	(vld_modify_vnode): don't assert on admin bits when only
	changing size, force setting of fs

	* fs/connsec.h: Added.
	* fs/connsec.c: Added.

1999-10-18  Magnus Ahltorp  <map@stacken.kth.se>

	* milko/lib/voldb/voldb.c: Updated comments.

1999-10-16  Magnus Ahltorp  <map@stacken.kth.se>

 	* milko/lib/voldb/voldb.[ch]: Added voldb_update_time.

1999-10-15  Love  <lha@s3.kth.se>

	* lib/vld/vld.c (vld_check_rights): remove over paranoid assert()

	* lib/voldb/voldb_internal.h (voldb_put_file): put file and not
	get.

	* lib/vld/vld.c (vld_create_entry): set type of e.

	* lib/vld/vld.[ch] (vld_check_accces): return errno instead of Bool

	* lib/vld/vld.c (vld_open_vnode): get getting data, remember to
	set flag.

	* lib/vld/vld.c (vld_update_size_cached,
	vld_{d,f,}ent_to_fetchstatus): assert on right things

	* lib/vld/vld.c (vld_open_vnode): use the voldb entry in n.

	* lib/vld/mnode.c (mnode_init): fixed common if (foo) bug

	* appl/sked/sked.c (main): init mnode support.

	* pts/pr.c: move <assert.h> to avoid collision with <rxkad.h>

	* lib/voldb/voldb_locl.h: added <fs.h>

	* lib/voldb/voldb_internal.h: inline some functions.

	* lib/voldb/voldb.h (*): merge voldb_get_{dir,file} to
	voldb_get_entry, added negative acl's

	* lib/voldb/voldb.c (*): merge voldb_get_{dir,file} to
	voldb_get_entry

	* lib/voldb/vdb_flat.c (*acl*): add negative acl

	* lib/vld/vld.c (*): new style mnode

	* lib/vld/Makefile.in: no more separate mdir, moved here instead

	* lib/svol/svol.c: printf mangleing and newstyle mnode

	* lib/msecurity/netinit.[ch] (network_init): request should return a
	int32_t

	* lib/msecurity/msecurity.c: move <assert.h> to avoid collition in
	<rxkad.h>

	* lib/Makefile.in (SUBDIRS): no more mdir

	* fs/fsrv_locl.h: Added <mdir.h>

	* fs/fsprocs.c (*): new style mnode

	* fs/Makefile.in: mdir have moved

	* appl/sked/sked.c: new mdir style, new mnode, disable ls command
	for now.

	* README: Random advice

1999-09-26  Love  <lha@s3.kth.se>

	* lib/vld/vld.h: clearified comment of backstores

	* README: we dont know anything about non-kth-krb telnet

	* lib/voldb/vdb_flat.c (vdbflat_del_entry): put data on freelist.

1999-09-25  Love  <lha@s3.kth.se>

	* README: Added comments about vld and voldb

	* fs/fsprocs.c (*): fbuf related bugs fixed.

	* fs/fileserver.c (sigusr1): exit with 2

	* lib/mdir/mdir.c: fix fbuf related bugs

	* lib/vstatus/vstat.xg (vstatus): add voldbtype

	* **.[ch]: adapt to new voldb structure

	* lib/voldb/*.[ch]: break out voldb flat to make possible to
	use diffrent types of voldb:s

1999-09-13  Love  <lha@s3.kth.se>

	* bos/boserver.c: 'add some more functionality (like (stupid)
	configfile and mailing when things die.

1999-09-10  Assar Westerlund  <assar@sics.se>

	* vldb/vldbserver.c: add --noauth

	* pts/ptserver.c: add --noauth

	* bos/bosserver.c: add --noauth

	* lib/msecurity/msecurity.h (sec_disable_superuser_check): add
 	prototype

	* lib/msecurity/msecurity.c (sec_disable_superuser_check): add
	(sec_superuser): check for disabled check
	(sec_add_superuser, sec_del_superuser): ifdef KERBEROS

	* lib/msecurity/netinit.c: handle !KERBEROS

	* vldb/ubikprocs.c: handle !KERBEROS

	* pts/pr.c: handle !KERBEROS

1999-08-08  Assar Westerlund  <assar@sics.se>

	* fs/fsprocs.c (RXAFS_BulkStatus): allocate StatArray and CBArray

1999-07-15  Assar Westerlund  <assar@sics.se>

	* pts/Makefile.in (LIBS): add kafs, to get krb_life_to_time :-(

	* fs/Makefile.in (LIBS): add kafs, to get krb_life_to_time :-(

	* bos/Makefile.in (LIBS): add kafs, to get krb_life_to_time :-(

	* dumbclient/Makefile.in (LIBS): add kafs, to get krb_life_to_time
 	:-(

1999-07-12  Magnus Ahltorp  <map@stacken.kth.se>

	* fs/volprocs.c: Added

1999-07-09  Marcus Sundberg  <mackan@stacken.kth.se>

	* appl/sked/Makefile.in, bos/Makefile.in, fs/Makefile.in,
	  pts/Makefile.in, vldb/Makefile.in: Add @PLWP_LIB_FLAGS@ when
	  linking with -llwp.

1999-07-04  Love  <lha@s3.kth.se>

	* lib/voldb/voldb.c (voldb_pretty_print_{dir,file}): print unique

	* appl/sked/sked.c (volls_cmd): implement
	(volvnode_cmd): fix off-by-1 error re to voldb

	* appl/sked/Makefile.in (INCLUDE): Add mdir

1999-07-04  Magnus Ahltorp  <map@it.kth.se>

	* fs/fsprocs.c: Update the size of the symlink file

1999-06-23  Love  <lha@s3.kth.se>

	* fs/fsprocs.c: use new vld_create_*

	* lib/voldb/voldb.h(voldb_{file,dir}_entry: reclain spare1

	* lib/voldb/voldb.c(voldb_new_entry): Add unique
	(voldb_{put,get}_{dir,file}): use unique

	* lib/vld/vld.c:(vld_create_{file,dirctory}: Add unique.

	* lib/svol/svol.c: Added <rx/rx.h>

1999-06-23  Assar Westerlund  <assar@sics.se>

	* fs/fsprocs.c (RXAFS_StoreData): call copyrx2fd correctly

1999-06-20  Assar Westerlund  <assar@sics.se>

	* fs/fsprocs.c (RXAFS_StoreData): return EINVAL instead of
 	asserting if given bad arguments

	* fs/fsprocs.c: de-mulify
	(RXAFS_FetchData): handle a_offset correctly

1999-06-10  Love  <lha@s3.kth.se>

	* appl/sked/sked.c: add <rx/rx.h> and <fbuf.h>, reset some vars

	* lib/vld/vld.c: (vld_create_directory): change place of . and
	.. to make it work

1999-06-09  Love  <lha@s3.kth.se>

	* lib/voldb/voldb.c: (voldb_del_entry): reset ino num,
	(voldb_pretty_print*): print ino in hex

	* README: Talk about CellServDB/ThisCell and run-tests

	* fs/fsprocs.c: use new vld_update_size_fbuf

	* lib/vld/vld.[ch]: vld_update_size -> \1_{fd,fbuf}

1999-06-07  Love  <lha@s3.kth.se>

	* bos/bosserver.c(main): use new network_kerberos_init.

	* vldb/vldbserver.c(main): use new network_kerberos_init.

	* lib/msecurity/Makefile.ini(DEFS): Add MILKO_SYSCONFDIR

	* lib/msecurity/netinit.c: (network_kerberos_init): use default if
	given a NULL

1999-05-30  Love  <lha@s3.kth.se>

	* fs/fsprocs.c (RXAFS_BulkStatus): the turn the < the right way,
	and reverse the previos patch

	* fs/fsprocs.c (RXAFS_BulkStat): only free volh if set

	* appl/sked/sked.c (*): Added new function volvnode that gives
	info about a volume (and the vnodes)

	* bos/bosserver.c: Added some comments

	* lib/vld/vld.c (*): start to use vol->flags.voldbp

	* lib/voldb/voldb.c (voldb_pretty_print_{file,dir}): new function
	(voldb_header_info): new function

	* fs/fsprocs.c (RXAFS_StoreData): return sane size
	(RXAFS_BulkStat) : XXX remove paranoid

	* bos/Makefile.in (DEFS) += MILKO_LIBEXECDIR

	* vldb/Makefile.in (DEFS) += MILKO_SYSCONFDIR

	* bos/bosserver.c (args) += added prefix
	(start_server) use prefix

	* vldb/vldbserver.c (vldbserver_init): Added arguemnt that tells
	where the vl_database is stored.
	(getargs) += prefix

	* Makefile.in(SUBDIRS): Added bos
	
	* bos/*: Added partial nonworking bosserver.

1999-05-29  Love  <lha@s3.kth.se>

	* fs/fsprocs.c (RXAFSStoreData,RXAFSFetchData): close fd after
	use.

1999-05-28  Love  <lha@s3.kth.se>

	* vldb/vldbserver.c: add option cell

	* fs/fsprocs.c(RXAFS_SymLink): Make it work (check if fil exist etc)

	* fs/fsprocs.c (RXAFS_SymLink): First version of symlink
	(RXAFS_CreateFile): Get right size of dir-node, remove child-node
	when failed to add direntry.
	(RXAFS_MakeDir): Get right size of parent-dir-node

	* lib/vld/vld.h(vld_create_file): add the type of entry
	(vld_[fd]ent_to_fetchstatus): use vld_update_size
	(vld_update_size): new function

	* lib/vld/vld.h (vld_create_file): add the type of entry
	(vld_update_size): new function

1999-05-25  Love  <lha@s3.kth.se>

	* lib/vld/vld.c (vld_storestatus_to_[fd]ent): use current time if
	SS_MODTIME isn't set

	* fs/fsrv_locl.h: <netinit.h> <msecurity.h> <ko.h>

	* pts/ptserver.c: remove common code and use network_init instead

	* vldb/vldbserver.c: remove common code and use network_init instead

	* fs/fileserver.c: remove common code and use network_init instead

	* fs/Makefile.in: msecurity

	* README: Kerberos comments

	* lib/msecurity/Makefile.in: Added netinit.[ch]

	* lib/msecurity/netinit.[ch]: Added, to start up a rxserver in a
	simple way.

1999-05-19  Love  <lha@s3.kth.se>

	* vldb/Makefile.in: gc, add msecurity,acl

	* vldb/vldbserver.c: Debugging, add sec_is_superuser()

	* lib/vld/vld.c (vld_create_directory,vld_create_file): use ino_t
	instead of int32_t

1999-05-18  Love  <lha@s3.kth.se>

	* vldb/vldbserver.c: break out of milko, start to use
	lib/ko/ports

	* lib/Makefile.in(SUBDIRS): add msecurity

	* pts/{pts.c,pr.c}: move to pts/, break out of milko.

	* lib/msecurity/msecurity.[ch]:move to milko/lib/msecurity, do
	kerberos patches, break out of milko

1999-05-17  Love  <lha@s3.kth.se>

	* Milko is dead, long live Milko

	* */*: Added filbunke - nnp-server-class fileserver

	* */*: FS releated things removed. vldb and pts things moved to
	separate directories.

1998-11-08  Love  <lha@s3.kth.se>

	* ontop_ff.xg: numacl.

	* ontop_subr.c: Dont loop twice in ontop_alloc_vnode if successful.

	* ontopfs.c: ontop_{fetch,store}acl

	* Makefile.in: added afsacl.

1998-11-05  Love  <lha@s3.kth.se>

	* ontopfs.c(ontop_init): run ontop_initworker().

	* ontop_subr.c: Added a thread that precreate vnodes when
	num(vnodes) of a volume gets low.

	* ontop_ff.xg(ontop_vnode): split free to oddfree and evenfree,
	add used

	* milko.c(main): Move init network to top.

1998-11-04  Love  <lha@s3.kth.se>

	* mbuf.c (malloc_create): do paranoid things about creation of a
	malloc_create.

	* ontop_subr.c: Breakout the creation of a vnode.

	* ontopfs.c (createentry): Update right vnode.
	(update_vnode): UnixModeBits & 0666
	(ontop_vnode2AFSStoreStatus): Add filetypebits by hand.
	
1998-10-22  Love  <lha@s3.kth.se>

	* fs.c (RXAFS_Link): Implement.

	* ontopfs.c: Use flags for createentry()/delete_entry().
	(ot_lookup): New function.
	(ontop_rename): Implement.
	(ontop_link): Implement.
	
	* ontop_subr.c: Use LinkCount when allocing and freeing vnodes.

	* README: Tell what filesystem might work.

1998-10-21  Love  <lha@s3.kth.se>

	* fileserver.h: Fixed prottypes for *link.

	* README: Fixed sentence about romedia.

	* ontopfs.c: (delete_entry): New common function for RemoveDir and
	RemoveFile.
	(ontop_removedir): Made use os delete_entry.
	(ontop_removefile): Implemeted using delete_entry().
	(create_entry): Fixed indenting bug.
	(ontop_symlink): Implemented.
	
	* fs.c: (RXAFS_RemoveFile): Implemented.
	(RXAFS_Rename): Implemented.
	(RXAFS_SymLink): Implemented.
	
1998-10-15  Love  <lha@s3.kth.se>

	* ontopfs.c: (ontop_putdate): Store file.
	(ontop_createfile): Implemented.
	(update_vnode): New function.
	(createentry): New function.
	(ontop_makedir): use createentry

	* ufsmedia.[ch]: Begining of code for FH support.

	* mbuf.h: Prototype for mbuf_resize().

	* mbuf.c: Implement reallen for malloced mbuf.

	* fs.c: Return more sane values for not implemented functions (EPERM).
	(RXAFS_CreateFile): Write downcall to fs-module.
	
	* filesystem.h: link and symlink.

	* fhget.[ch]: (fhtonum) and (numtofh): New functions

	* README: Added COMMENTS section.

	* Makefile.in: Clean out the autogenerated files.

1998-10-12  Love  <lha@s3.kth.se>

	* ontopfs.c: (ontop2afsrights) more bogus rights.
	(ontop_makedir): Free the right vnode.
	(ontop_removedir): new function (should use mdir_emptyp().

	* ontop_subr.c: Added function ontop_free_vnode() to free vnode.

	* mdir.[ch]: New function mdir_emptyp() that might work.

	* fs.c: Added code for ontop_removedir.

	* fileserver.h: Added prototypes/entries in struct filesystem for:
	storeacl, createfile, removefile, and fsrename.

	* README: Added note about filesystem.

1998-10-09  Love  <lha@s3.kth.se>

	* README: Added some text about the thingy.

	* ontop_subr.c: (ontop_store_types): add gotfh type.
	(openvnode): Open with fhget() if it exists.
	(ontop_create_vnode): If we have fhget() store the FH too.

	* ontop_ff.xg: changed ontop_vnode.storage to OPAQUE from VARRAY.

	* milko_locl.h: Add includefiles for fhget(), remove dbi.h forever.

	* milko.c: (main) Test if use have fh* with fhprobe().

	* fhget.[ch]: Stolen from arlad/fcache.c, and changed to fit milko

1998-10-07  Love  <lha@s3.kth.se>

	* ontopfs.c: Added support for mkdir.

1998-10-06  Love  <lha@s3.kth.se>

	* Got ontopfs to list . and .. for the first time.

	* Lost a bunch of entries in a disk-crash, maybe I should
	checkin the code a little bit more often.

1998-09-06  Love  <lha@s3.kth.se>

	* ufsmedia.c(ufs_putdata): - Added filelen and truncated file,
	- added check if fd is a directory.

	* fs.c: - Fixed prototype for RXAFS_Symlink.
	
	* fileserver.h: Added filelen to putdata.

1998-09-04  Love  <lha@s3.kth.se>

	* ontofs.c: Started to write the filesystem that will live
	on top of another.

1998-09-03  Love  <lha@s3.kth.se>

	* First time RDWR support, but stil lacking all dir-ops.
	
	* libmsys/t.c: Test program for milkosys.

	* db/t.c: Testprogram for dbi interface.

	* db/dbi.c: a generic db interface.

	* db/db.c: db interface to dbi.

	* vldbserver.c: New file, broke out of fs.

	* volcommon.c: New file, functions common from volser and fs.

	* volser.c: New server (to be able to fool vos).

	* service.h: Added more services.

	* ufsmedia.c: Added writesupport, still no auth.

	* fs.c: Added code for StoreStatus, StoreData and GetTime.

	* Makefile.in: Added some new files and targets.

	* libmsys/msys.c: Added findmilkosyscall() and istatpath().

1998-09-01  Love  <lha@s3.kth.se>

	* ufsmedia.c: Reworked bake_afsdir.

	* sys/modsys.c: Added a new subcall, istatpath.

1998-08-27  Love  <lha@s3.kth.se>

	* s/vldb.c/vldbserver.c/: Broke out of the generic server.
	Added dbi support.

	* db/db.h: A interface for the db interface.

	* db/dbi.[ch]: Added, a generic interface to databases.

1998-08-10  Love  <lha@s3.kth.se>

	* sys/msc.h: Added.

	* sys/modsys.c: Added, the FreeBSD milko-syscall.

	* libmsys/msys.h: Added, prototype.

	* libmsys/msys.c: Added, lib for the milkosyscall.

	* libmsys/t.c: Added, testprogram for the lib.

	* ufsmedia.c: Added, export your ufs filesystem. ro, no security.

	* volser.c: Added ufs_filesystemtest. (really need config-file)

	* vldb.c: Moved ipaddress (really need vldb &| config-file)

	* romedia.c: Const'ize.

	* milko_locl.h: Added a bunch of new headfiles.

	* mdir.c(mdir_mkdir): Made sure ret has a sane value.

	* mbuf.c(mcopybuf2rx): Fixed bugs.

	* fs.c: Cleaned up and fixed warnings.

	* fileserver.h: Added some more vop's and const'ized.

	* fileserver.c: Added FILESYSTEM_UFS

	* Makefile.in: cleaned up and and added FILESYSTEM_UFS

Mon Jul 13 21:37:28 1998  Assar Westerlund  <assar@sics.se>

	* dumbclient/Makefile.in: compat with stupid makes

	* Makefile.in: compat with stupid makes

1998-06-26  Love Hornquist-Astrand  <lha@junkyard.stacken.kth.se>

	* fs.c(RXAFS_FetchData): Fix NULL check.

	* romedia.c(rom_init): Don't open the database rw.
	(romi_getstatus): Parse input w/o sscanf()
	
	* volser.c(volser_init): Added static configation (need conffile soon)
	(volser_addVolume): Fix init
	
	* romedia.c,roindex.c: Added support for dates,
	no more 201450000 dates :(

	* mbuf.c: Added support for malloc mbufs.

	* Makefile.in: Fixed building and installing.

1998-06-20  Love  <lha@s3.kth.se>

	* disklayer.h: Dont know if this is enough.

1998-06-08  Love  <lha@s3.kth.se>

	* Added filserver.c

	* *.c: Started to use define FILESYSTEM_READONLY

	* volser.c (*): Fixes and bring uptodate.

