dnl	$OpenBSD: install,v 1.5 2010/02/12 21:33:29 otto Exp $
OpenBSDInstallPrelude

Booting the installation media:

The easiest way to boot into the OpenBSD installer is to copy the bsd.rd
installation kernel to the main Linux partition, and boot from it.

Assuming the installation kernel has been copied to /boot/bsd.rd on the
Linux system, at the PMON prompt, enter

    PMON> boot /dev/fs/ext2@wd0/boot/bsd.rd

on Lemote systems, and

    PMON> load /dev/fs/ext2@usbg0/boot/bsd.rd
    PMON> g

on Gdium systems, to boot the installation kernel.
dnl
dnl Alternatively, if your particular PMON flavour supports `fat' filesystems,
dnl you can boot the kernel from an usb key with:
dnl 
dnl    PMON> boot /dev/fs/fat@usb0:/bsd.rd

Netbooting the installation kernel can be done as well:

    PMON> ifaddr rtl0 <your ip>
    PMON> boot tftp://<server ip>/bsd.rd

(on Gdium systems, use a `load' command followed by `g' instead of `boot').

OpenBSDInstallPart2

OpenBSDInstallPart3(,"sd0 for USB storage, or wd0 for internal storage
	(either a disk drive or an SSD)")

OpenBSDInstallPart4

OpenBSDInstallMBRPart1

dnl not until we have boot blocks... and then we'll probably need to
dnl add text to mention the necessary little boot partition...
dnl OpenBSDInstallMBRPart2
	The fdisk(8) utility will be invoked to let you edit your MBR
	partitioning.  The current MBR partitions defined will be
	displayed and you will be allowed to modify them, and add new
	partitions.

	After your OpenBSD MBR partition has been setup, the real
	partition setup can follow.

OpenBSDInstallPart5({:-
	If you have left Linux partitions defined on the disk, these will
	usually show up as partition 'i', 'j' and so on.-:})

OpenBSDInstallPart6({:-CD-ROM, -:})

OpenBSDURLInstall

OpenBSDCDROMInstall

OpenBSDDISKInstall({:-"wdN" or -:},,{:-, Linux (ext2) or MS-DOS-:})

OpenBSDCommonInstall

dnl usb tape drives anyone?
dnl OpenBSDTAPEInstall
dnl
OpenBSDInstallWrapup

	As the OpenBSD/MACHINE port is very new, there is not yet a proper
	bootloader. In addition to these steps, you will need, for the time
	being, to copy the kernel image to the Linux partition and boot
	from it. This annoyance is being worked on and should disappear
	very soon.

	Lemote systems final steps:

		Lemote systems ship with a boot menu.  After the installation
		is complete, you should add an OpenBSD entry to the boot menu
		to be able to boot OpenBSD more easily.

		The boot menu contents are found in /boot/boot.cfg on the Linux
		partition. To add an OpenBSD entry, simply add a new entry in
		the file, such as:

		title OpenBSD
			kernel /dev/fs/ext2@wd0/boot/bsd
			args ""

		In the example above, /dev/fs/ext2@wd0/boot/bsd is the PMON
		path to the kernel image.

		You may make OpenBSD the default option by changing the
		``default'' line near the top of the file. The value on this
		line is the index of the default entry, starting at zero. So
		if you added the OpenBSD entry as the fourth entry in the
		file, it would become the default choice with:

		default 3

		The timeout until the default choice is selected, in seconds,
		can be modified on the ``timeout'' line.

		Note that using the boot menu currently disables root device
		discovery and kernel symbol loading. Therefore it may be
		more convenient to switch to the PMON prompt using 'c' and
		boot with the command

		    PMON> boot -k $bsd

		after having set the bsd variable to your boot path:

		    PMON> set bsd /dev/fs/ext2@wd0/boot/bsd

		On the Fuloong 2F, getting PMON to use the serial console
		is tricky, due to PMON bugs and design decisions made by
		Lemote.
		PMON's default serial speed is 115200, and OpenBSD will
		also use that speed. By default, it is possible to use
		serial input if no USB keyboard is attached. PMON will
		nevertheless display output its on the VGA display.
		To get full serial access, the first step is to boot
		into PMON> with both serial console and VGA display but
		no USB keyboard attached.
		You can type on the serial console, but output will be shown
		on the VGA display. Next enter the following
		commands:

		    PMON> set novga 1
		    PMON> set nokbd 1
		    PMON> set al ""
		    PMON> set ShowBootMenu no

		Then boot into linux and rename /boot/boot.cfg so that
		it does not get found by PMON. At the next reboot
		the Fuloong 2F will boot into the PMON
		prompt on the serial console.

	Gdium systems final steps:

		Gdium systems do not have a boot menu, and directly boot the
		system (Linux, by default).

		The path to the file booted by default is set in the `al'
		environment variable. To boot the bsd kernel on the G-Key
		by default, assuming it has been copied to /boot on the first
		ext3 partition, you can change it to:

		    PMON> set al /dev/fs/ext2@usbg0/boot/bsd

		Alternatively, you can disable autoboot by removing this
		variable:

		    PMON> unset al

OpenBSDCongratulations
